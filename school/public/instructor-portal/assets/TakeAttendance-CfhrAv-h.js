var p=(c,e,a)=>new Promise((n,o)=>{var u=d=>{try{r(a.next(d))}catch(h){o(h)}},t=d=>{try{r(a.throw(d))}catch(h){o(h)}},r=d=>d.done?n(d.value):Promise.resolve(d.value).then(u,t);r((a=a.apply(c,e)).next())});import{_ as A,r as _,f as S,g as T,c as f,b as i,F as b,h as I,i as C,o as m,t as k}from"./index-AeQZmwvi.js";const D=()=>{const e=document.cookie.split("; ").find(a=>a.startsWith("csrf_token="));return e?decodeURIComponent(e.split("=")[1]):""},P=(a,...n)=>p(void 0,[a,...n],function*(c,e={}){try{const o=D(),u=yield fetch(`/api/method/${c}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-Frappe-CSRF-Token":o},credentials:"include",body:JSON.stringify(e)}),t=yield u.json();if(!u.ok){const r=t.message||t.exc||"API request failed";return console.error(`API Error (${c}):`,r),{success:!1,error:r,message:r,exc:t.exc,data:null}}return{success:!0,data:t.message||t,message:t.message||"Operation completed successfully",error:null}}catch(o){return console.error(`Error in API call to ${c}:`,o),{success:!1,error:o.message,message:o.message||"API request failed",data:null}}}),F=c=>p(void 0,null,function*(){return yield P("school.al_ummah.api2.get_student_attendance_records",c)}),N={name:"Attendance",setup(){const c=C(),e=_([]),a=_([]),n=_(!0),o=_(null),u=()=>{try{const s=localStorage.getItem("user_details");s?o.value=JSON.parse(s):console.log("User details not found in localStorage.")}catch(s){console.error("Error loading user details:",s)}},t=()=>p(this,null,function*(){n.value=!0;try{const s=localStorage.getItem("attendance_data");if(s){const l=JSON.parse(s),v=(l==null?void 0:l.attendance)||[];v.length>0?(e.value=v,a.value=v.map(g=>g.student),console.log("Loaded attendance data from localStorage.")):(console.log("Attendance data is empty. Fetching from API..."),yield r(!0))}else console.log("Attendance data not found in localStorage. Fetching from API..."),yield r(!0)}catch(s){console.error("Error loading attendance data:",s),alert("Failed to load attendance data.")}finally{n.value=!1}}),r=(s=!1)=>p(this,null,function*(){try{const l=localStorage.getItem("selected_student_group");if(!l){alert("Student group information is missing.");return}const g=yield F({based_on:"Batch",student_group:l});if(!g||g.length===0){console.log("No attendance data found from API."),s&&alert("No attendance records found for the selected class."),e.value=[];return}localStorage.setItem("attendance_data",JSON.stringify({attendance:g})),console.log("Attendance data saved successfully."),e.value=g,a.value=g.map(y=>y.student)}catch(l){console.error("Error fetching and saving attendance data:",l),alert("Failed to fetch attendance data.")}}),d=s=>{a.value.includes(s)?a.value=a.value.filter(l=>l!==s):a.value=[...a.value,s]},h=()=>{c.push("/teacher-home")};return S(()=>{u()}),T(o,()=>{o.value&&t()}),{students:e,presentStudents:a,loading:n,userDetails:o,fetchAndSaveAttendanceData:r,togglePresent:d,navigateToTeacherHome:h}}},R={class:"container"},w={key:0,class:"loading"},x={key:1,class:"student-list"},E=["checked","onChange"],O={key:2,class:"no-students"},B={class:"buttons"};function J(c,e,a,n,o,u){return m(),f("div",R,[n.loading?(m(),f("div",w,e[2]||(e[2]=[i("div",{class:"spinner"},null,-1)]))):n.students.length>0?(m(),f("div",x,[i("ul",null,[(m(!0),f(b,null,I(n.students,t=>(m(),f("li",{key:t.student,class:"student-item"},[i("span",null,k(t.student_name),1),i("span",null,"Roll: "+k(t.group_roll_number),1),i("input",{type:"checkbox",checked:n.presentStudents.includes(t.student),onChange:r=>n.togglePresent(t.student)},null,40,E)]))),128))])])):(m(),f("div",O,e[3]||(e[3]=[i("p",null,"No students available",-1)]))),i("div",B,[i("button",{class:"btn cancel",onClick:e[0]||(e[0]=(...t)=>n.navigateToTeacherHome&&n.navigateToTeacherHome(...t))},"Cancel"),i("button",{class:"btn refresh",onClick:e[1]||(e[1]=(...t)=>n.fetchAndSaveAttendanceData&&n.fetchAndSaveAttendanceData(...t))},"Refresh")])])}const U=A(N,[["render",J],["__scopeId","data-v-328857cd"]]);export{U as default};
