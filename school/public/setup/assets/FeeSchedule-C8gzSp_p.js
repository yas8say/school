var je=Object.defineProperty,Ue=Object.defineProperties;var We=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var ce=(b,t,f)=>t in b?je(b,t,{enumerable:!0,configurable:!0,writable:!0,value:f}):b[t]=f,K=(b,t)=>{for(var f in t||(t={}))qe.call(t,f)&&ce(b,f,t[f]);if(de)for(var f of de(t))Qe.call(t,f)&&ce(b,f,t[f]);return b},X=(b,t)=>Ue(b,We(t));import{_ as re,r as T,c as O,j as _e,x as Z,o as d,a as c,b as e,t as a,F as k,l as A,i as v,y as Be,z,h as w,e as Je,A as Q,B as ie,f as ze,n as ue,C as R,D as He}from"./index-DrHiZmg-.js";/* empty css             */const Ye={class:"student-list-container"},Ke={class:"student-list-header"},Xe={class:"student-list-title"},Ze={class:"header-actions"},Re={class:"summary-stats"},$e={class:"stat-item"},et={class:"stat-value"},tt={class:"stat-item"},st={class:"stat-value"},lt={class:"stat-item"},nt={class:"stat-value"},ot={class:"bulk-actions"},at={class:"bulk-buttons"},dt=["onClick"],ct={class:"students-grid"},it={class:"student-basic-info"},ut={class:"student-avatar"},rt=["src"],_t={key:1,class:"avatar-placeholder"},ht={class:"student-details"},ft={class:"student-name"},mt={class:"student-roll"},gt={class:"student-id"},vt={key:0,class:"fee-categories-section"},St={class:"fee-categories-checkboxes"},bt={class:"checkbox-label"},pt=["checked","onChange"],yt={class:"category-info"},Ct={class:"category-name"},kt={class:"category-amount"},At={class:"student-selection-summary"},Ft={class:"summary-text"},xt={key:0,class:"no-selection-warning"},Et={key:1,class:"partial-selection-warning"},Dt={key:1,class:"no-categories-message"},wt={key:0,class:"empty-state"},Lt={__name:"StudentList",props:{studentGroup:{type:Object,required:!0,default:()=>({})},feeStructures:{type:Array,default:()=>[]},initialSelections:{type:Object,default:()=>({})}},emits:["save","close"],setup(b,{emit:t}){const f=b,n=t,y=T({}),C=O(()=>{const u=[];return f.feeStructures.forEach(r=>{r.components&&r.components.forEach(h=>{h.fees_category&&!u.find(m=>m.fees_category===h.fees_category)&&u.push({fees_category:h.fees_category,amount:h.amount,discount:h.discount,total:h.total})})}),u}),V=(u,r)=>{var h;return((h=y.value[u])==null?void 0:h.includes(r))||!1},I=(u,r,h)=>{y.value[u]||(y.value[u]=[]);const m=y.value[u];if(h)m.includes(r)||m.push(r);else{const E=m.indexOf(r);E>-1&&m.splice(E,1)}},l=u=>{var r;return((r=y.value[u])==null?void 0:r.length)||0},S=()=>Object.values(y.value).filter(u=>u.length<C.value.length).length,i=u=>{var r;(r=f.studentGroup.students)==null||r.forEach(h=>{I(h.student,u,!0)})},D=()=>{var u;(u=f.studentGroup.students)==null||u.forEach(r=>{y.value[r.student]=C.value.map(h=>h.fees_category)})},p=()=>{var u;(u=f.studentGroup.students)==null||u.forEach(r=>{y.value[r.student]=[]})},F=()=>{y.value={}},N=()=>{var r;const u={};(r=f.studentGroup.students)==null||r.forEach(h=>{const m=h.student,E=y.value[m]||[],q=C.value.map(j=>j.fees_category).filter(j=>!E.includes(j));q.length>0&&(u[m]=q)}),n("save",u)},H=u=>u?u.startsWith("http")||u.startsWith("//")?u:u.startsWith("/")?window.location.origin+u:`${window.location.origin}/${u.replace(/^\//,"")}`:null,J=u=>u?u.split(" ").map(r=>r.charAt(0)).join("").toUpperCase().substring(0,2):"?",U=u=>{u.target.style.display="none"},P=()=>{var u;if(f.initialSelections&&Object.keys(f.initialSelections).length>0&&Object.values(f.initialSelections).some(h=>Array.isArray(h)&&h.length>0)){y.value=JSON.parse(JSON.stringify(f.initialSelections));return}y.value={},(u=f.studentGroup.students)==null||u.forEach(r=>{y.value[r.student]=C.value.map(h=>h.fees_category)})};return _e(()=>{P()}),Z(()=>f.initialSelections,u=>{u&&Object.keys(u).length>0&&P()},{deep:!0}),Z(()=>f.studentGroup,()=>{P()},{deep:!0}),Z(()=>f.feeStructures,()=>{Be(()=>{P()})},{deep:!0}),(u,r)=>{var h;return d(),c("div",Ye,[e("div",Ke,[e("h3",Xe,a(b.studentGroup.name)+" - Fee Category Selection",1),e("div",Ze,[e("button",{onClick:N,class:"save-button"}," Save Selections "),e("button",{onClick:r[0]||(r[0]=m=>u.$emit("close")),class:"close-button"}," Close ")])]),e("div",Re,[e("div",$e,[r[1]||(r[1]=e("span",{class:"stat-label"},"Total Students:",-1)),e("span",et,a(((h=b.studentGroup.students)==null?void 0:h.length)||0),1)]),e("div",tt,[r[2]||(r[2]=e("span",{class:"stat-label"},"Fee Categories:",-1)),e("span",st,a(C.value.length),1)]),e("div",lt,[r[3]||(r[3]=e("span",{class:"stat-label"},"Students with Exceptions:",-1)),e("span",nt,a(S()),1)])]),e("div",ot,[r[4]||(r[4]=e("h4",{class:"bulk-actions-title"},"Bulk Actions",-1)),e("div",at,[(d(!0),c(k,null,A(C.value,m=>(d(),c("button",{key:m.fees_category,onClick:E=>i(m.fees_category),class:"bulk-category-button"}," Select "+a(m.fees_category)+" for All ",9,dt))),128)),e("button",{onClick:D,class:"bulk-category-button"}," Select All Categories for All "),e("button",{onClick:p,class:"bulk-clear-button"}," Clear All Selections "),e("button",{onClick:N,class:"bulk-save-button"}," Save Selections ")])]),e("div",ct,[(d(!0),c(k,null,A(b.studentGroup.students,m=>(d(),c("div",{key:m.student,class:"student-card"},[e("div",it,[e("div",ut,[m.student_image?(d(),c("img",{key:0,src:H(m.student_image),alt:"Student",class:"avatar-image",onError:U},null,40,rt)):(d(),c("div",_t,a(J(m.student_name)),1))]),e("div",ht,[e("h4",ft,a(m.student_name),1),e("p",mt,"Roll No: "+a(m.group_roll_number),1),e("p",gt,a(m.student),1)])]),C.value.length>0?(d(),c("div",vt,[r[6]||(r[6]=e("h5",{class:"fee-categories-title"},"Select Fee Categories",-1)),e("div",St,[(d(!0),c(k,null,A(C.value,E=>{var W;return d(),c("div",{key:E.fees_category,class:"fee-category-checkbox"},[e("label",bt,[e("input",{type:"checkbox",checked:V(m.student,E.fees_category),onChange:q=>I(m.student,E.fees_category,q.target.checked),class:"category-checkbox"},null,40,pt),r[5]||(r[5]=e("span",{class:"checkbox-custom"},null,-1)),e("span",yt,[e("span",Ct,a(E.fees_category),1),e("span",kt,"â‚¹"+a((W=E.total)==null?void 0:W.toLocaleString()),1)])])])}),128))]),e("div",At,[e("span",Ft," Selected: "+a(l(m.student))+"/"+a(C.value.length)+" categories ",1),l(m.student)===0?(d(),c("span",xt," (No fee categories selected) ")):l(m.student)<C.value.length?(d(),c("span",Et," ("+a(C.value.length-l(m.student))+" excluded) ",1)):v("",!0)])])):(d(),c("div",Dt,r[7]||(r[7]=[e("p",null,"No fee categories available",-1)])))]))),128))]),!b.studentGroup.students||b.studentGroup.students.length===0?(d(),c("div",wt,r[8]||(r[8]=[e("p",{class:"empty-message"},"No students found in this group",-1)]))):v("",!0),e("div",{class:"actions-footer"},[e("button",{onClick:N,class:"save-button"}," Save Fee Category Selections "),e("button",{onClick:F,class:"clear-button"}," Clear All ")])])}}},Gt=re(Lt,[["__scopeId","data-v-6d7455a4"]]),Tt={name:"FeeScheduleCreator",components:{StudentList:Gt},setup(){const b=T(!1),t=T(""),f=T(""),n=T(null),y=T(null),C=T({}),V=T(!1),I=T(null),l=T({}),S=T([{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annually"},{value:"Annually",label:"Annually"},{value:"Term-Wise",label:"Term-Wise"}]),i=T({selected_class:"",student_group:""}),D=z({url:"school.al_ummah.api3.get_classes",auto:!0,onSuccess:s=>{console.log("Classes loaded:",s)},onError:s=>{var o;t.value=((o=s.messages)==null?void 0:o[0])||"Failed to load classes",console.error("Error loading classes:",s)}}),p=z({url:"school.al_ummah.api5.get_fee_structures_for_selection",onSuccess:s=>{console.log("Fee structures loaded:",s),s&&s.success&&s.fee_structures&&s.fee_structures.forEach(o=>{o.selected=!1,o.selected_fee_plan=E(o.name)||"",o.feeSchedules=[],o.selected_fee_plan&&j(o)})},onError:s=>{var o;t.value=((o=s.messages)==null?void 0:o[0])||"Failed to load fee structures",console.error("Error loading fee structures:",s)}}),F=z({url:"school.al_ummah.api5.get_student_groups",onSuccess:s=>{console.log("Student groups loaded:",s),s&&s.success&&s.student_groups&&s.student_groups.forEach(o=>{o.selected=!0,l.value[o.name]||(l.value[o.name]={})})},onError:s=>{var o;t.value=((o=s.messages)==null?void 0:o[0])||"Failed to load student groups",console.error("Error loading student groups:",s)}}),N=z({url:"school.al_ummah.api5.create_and_submit_fee_schedules_with_invoices",method:"POST",onSuccess:s=>{b.value=!1,y.value=null,n.value=s,f.value=s.message,t.value="",console.log("Fee schedules and invoices created:",s)},onError:s=>{var o;b.value=!1,y.value=null,t.value=((o=s.messages)==null?void 0:o[0])||"Failed to create fee schedules and invoices",console.error("Error creating fee schedules:",s)}}),H=O(()=>p.data&&p.data.success&&p.data.fee_schedules_count||0),J=O(()=>D.data||[]),U=O(()=>p.data&&p.data.success?p.data.fee_structures:[]),P=O(()=>F.data&&F.data.success?F.data.student_groups:[]),u=O(()=>U.value.filter(s=>s.selected&&s.selected_fee_plan&&s.feeSchedules&&s.feeSchedules.length>0)),r=O(()=>u.value.length),h=O(()=>P.value.filter(s=>s.selected)),m=O(()=>i.value.selected_class&&r.value>0&&h.value.length>0);function E(s){const o=s.toLowerCase();return o.includes("monthly")?"Monthly":o.includes("quarterly")?"Quarterly":o.includes("semi-annually")||o.includes("semi annually")?"Semi-Annually":o.includes("annually")||o.includes("annual")?"Annually":o.includes("term")||o.includes("term-wise")?"Term-Wise":""}function W(s){return{Monthly:12,Quarterly:4,"Semi-Annually":2,Annually:1,"Term-Wise":3}[s]||1}function q(s,o){const _=W(o);return parseFloat((s/_).toFixed(2))}function j(s){if(!s.selected_fee_plan)return;const o=s.total_amount,_=s.selected_fee_plan,g=he(_,o);s.feeSchedules=g.map(x=>X(K({},x),{selected:!0,due_date:x.due_date||me()}))}function he(s,o){const _=new Date,g=[],M={Monthly:{frequency:12,gap:1},Quarterly:{frequency:4,gap:3},"Semi-Annually":{frequency:2,gap:6},Annually:{frequency:1,gap:12},"Term-Wise":{frequency:3,gap:4}}[s];if(!M)return[];const G=o/M.frequency;for(let L=1;L<=M.frequency;L++){const B=new Date(_);B.setMonth(_.getMonth()+M.gap*L),g.push({due_date:$(B),amount:parseFloat(G.toFixed(2))})}return g}function fe(s,o,_=null){if(_){const M=new Date(_),G=M.toLocaleDateString("en-US",{month:"long"}),L=M.getFullYear();return{Monthly:`${G} ${L}`,Quarterly:`Quarter ${Math.floor(o/3)+1} - ${G} ${L}`,"Semi-Annually":o===0?`First Half - ${G} ${L}`:`Second Half - ${G} ${L}`,Annually:`Annual Fee - ${L}`,"Term-Wise":`Term ${o+1} - ${G} ${L}`}[s]||`${G} ${L} - Installment ${o+1}`}return{Monthly:["January","February","March","April","May","June","July","August","September","October","November","December"][o]||`Month ${o+1}`,Quarterly:`Quarter ${o+1}`,"Semi-Annually":o===0?"First Half":"Second Half",Annually:"Annual Fee","Term-Wise":`Term ${o+1}`}[s]||`Installment ${o+1}`}function me(){const s=new Date;return s.setDate(s.getDate()+30),$(s)}function $(s){const o=s.getFullYear(),_=String(s.getMonth()+1).padStart(2,"0"),g=String(s.getDate()).padStart(2,"0");return`${o}-${_}-${g}`}function ge(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not set"}function ve(){i.value.student_group="",n.value=null,f.value="",t.value="",C.value={},l.value={},i.value.selected_class?(p.update({params:{program:i.value.selected_class}}),p.reload()):p.data=null}function Se(s){s.selected?s.selected&&!s.selected_fee_plan&&(s.selected_fee_plan=E(s.name)||"",s.selected_fee_plan&&j(s)):(s.selected_fee_plan="",s.feeSchedules=[]),r.value>0&&!F.data&&ee()}function be(s){s.selected_fee_plan?j(s):s.feeSchedules=[]}function ee(){i.value.selected_class&&(F.update({params:{program:i.value.selected_class}}),F.reload())}function pe(s){C.value=X(K({},C.value),{[s]:!C.value[s]})}function ye(){U.value.forEach(s=>{s.selected=!0,s.selected_fee_plan||(s.selected_fee_plan=E(s.name)||"",s.selected_fee_plan&&j(s))}),r.value>0&&ee()}function Ce(){U.value.forEach(s=>{s.selected=!1,s.selected_fee_plan="",s.feeSchedules=[]})}function ke(){P.value.forEach(s=>{s.selected=!0})}function Ae(){P.value.forEach(s=>{s.selected=!1})}function Fe(s){s.feeSchedules&&s.feeSchedules.forEach(o=>{o.selected=!0})}function xe(s){s.feeSchedules&&s.feeSchedules.forEach(o=>{o.selected=!1})}function te(s){const o=J.value.find(_=>_.name===s);return o?o.program_name||o.name:s}function Ee(s){const o=S.value.find(_=>_.value===s);return o?o.label:s}function se(s){return s.feeSchedules?s.feeSchedules.filter(o=>o.selected).length:0}function le(){return u.value.reduce((s,o)=>s+se(o),0)}function ne(){const s=[];return u.value.forEach(o=>{o.components&&o.components.forEach(_=>{s.includes(_.fees_category)||s.push(_.fees_category)})}),s}function Y(s){const o=s.total_students||0,_=l.value[s.name]||{},g=ne();if(g.length===0)return o;const x=Object.keys(_).filter(M=>(_[M]||[]).length===g.length).length;return o-x}function oe(){return h.value.reduce((s,o)=>s+Y(o),0)}function De(){let s=0;return h.value.forEach(o=>{const _=o.total_students||0,g=Y(o);s+=_-g}),s}function we(s){const o=l.value[s.name];return o&&Object.keys(o).length>0}function Le(s){const o=l.value[s.name];if(!o)return 0;let _=0;return Object.values(o).forEach(g=>{_+=g.length}),_}function ae(){let s=0;return h.value.forEach(o=>{const _=l.value[o.name];_&&Object.values(_).forEach(g=>{s+=g.length})}),s}function Ge(){return u.value.reduce((s,o)=>s+(o.total_amount||0),0)}function Te(s){var x;if(!s)return{};const o={},_=ne(),g=l.value[s.name]||{};return(x=s.students)==null||x.forEach(M=>{const G=M.student,L=g[G]||[],B=_.filter(Ve=>!L.includes(Ve));o[G]=B}),console.log("ðŸŽ¯ Initial selections for",s.name,":",o),o}function Ie(s){I.value=s,V.value=!0}function Me(s){if(I.value){const o=I.value.name;l.value[o]=s,console.log(`ðŸ’¾ Saved fee category exceptions for ${o}:`,s),console.log("ðŸ“Š Total students with exceptions:",Object.keys(s).length)}V.value=!1}function Ne(s){console.log("Selection changed:",s)}function Pe(){if(!m.value)return;b.value=!0,t.value="",f.value="",n.value=null;const s=u.value.map(g=>({fee_structure_name:g.name,fee_plan:g.selected_fee_plan,due_dates:g.feeSchedules.filter(x=>x.selected).map(x=>x.due_date)})),o=h.value.map(g=>g.name),_={};h.value.forEach(g=>{const x=l.value[g.name];x&&Object.keys(x).length>0&&(_[g.name]=x)}),y.value={class:te(i.value.selected_class),fee_structures:u.value.map(g=>g.name).join(", "),student_groups:o.join(", "),total_students:oe(),schedule_count:le(),excluded_categories:ae()},N.submit({fee_structures:s,student_groups:o,student_exceptions:_})}function Oe(){i.value={selected_class:"",student_group:""},n.value=null,t.value="",f.value="",y.value=null,C.value={},l.value={},V.value=!1,I.value=null,p.data=null,F.data=null}return _e(()=>{console.log("Fee Schedule Creator mounted")}),{processing:b,errorMessage:t,successMessage:f,results:n,feePlans:S,formData:i,processingDetails:y,expandedStructures:C,showStudentList:V,selectedStudentGroup:I,classesResource:D,feeStructuresResource:p,studentGroupsResource:F,createFeeSchedulesResource:N,classesList:J,feeStructuresList:U,studentGroupsList:P,selectedStructures:u,selectedStructuresCount:r,selectedStudentGroups:h,isFormValid:m,feeSchedulesCount:H,onClassChange:ve,onStructureSelectionChange:Se,onFeePlanChange:be,toggleStructureDetails:pe,selectAllStructures:ye,deselectAllStructures:Ce,selectAllGroups:ke,deselectAllGroups:Ae,selectAllSchedules:Fe,deselectAllSchedules:xe,extractFeePlanFromName:E,getInstallmentCount:W,calculateInstallmentAmount:q,getScheduleDescription:fe,getClassName:te,getFeePlanLabel:Ee,getSelectedSchedulesCount:se,getTotalSchedulesCount:le,getTotalStudents:oe,getTotalExcludedStudents:De,getTotalExcludedCategories:ae,getSelectedStudentsCount:Y,getExcludedCategoriesCount:Le,hasFeeCategoryExceptions:we,getTotalAmount:Ge,formatScheduleDate:ge,openStudentList:Ie,handleStudentListSave:Me,handleStudentListSelectionChange:Ne,getInitialSelections:Te,createFeeSchedulesAndInvoices:Pe,resetForm:Oe}}},It={class:"enrollment-container"},Mt={class:"scroll-view-content"},Nt={key:0,class:"modal-overlay"},Pt={class:"loading-modal"},Ot={key:0},Vt={key:1,class:"modal-overlay fullscreen-modal"},jt={class:"modal-content fullscreen-content scrollable-content"},Ut={class:"form-card"},Wt={key:0,class:"message error"},qt={key:1,class:"message success"},Qt={class:"form-section"},Bt={class:"form-grid"},Jt={class:"form-group required"},zt=["disabled"],Ht=["value"],Yt={key:0,class:"field-hint"},Kt={key:0,class:"info-note"},Xt={class:"note-content"},Zt={key:2,class:"form-section"},Rt={class:"selection-controls"},$t=["disabled"],es=["disabled"],ts={class:"selection-count"},ss={class:"table-container-wrapper"},ls={class:"preview-table fee-structures-table"},ns={class:"status-cell"},os=["onUpdate:modelValue","disabled","onChange"],as={class:"fee-structure-info"},ds={class:"fee-structure-name"},cs={class:"fee-structure-meta"},is={key:0},us=["onUpdate:modelValue","disabled","onChange"],rs=["value"],_s={class:"total-amount"},hs={class:"actions"},fs=["onClick","disabled"],ms={key:0,class:"fee-structure-expanded-details"},gs={class:"fee-structure-details-section"},vs={class:"subsection-title"},Ss={class:"details-grid"},bs={class:"detail-item"},ps={class:"value"},ys={class:"detail-item"},Cs={class:"value"},ks={key:0,class:"detail-item"},As={class:"value"},Fs={class:"detail-item"},xs={class:"value"},Es={key:0,class:"components-section"},Ds={class:"components-table"},ws={class:"installment-calculation"},Ls={key:0},Gs={key:1,class:"text-muted"},Ts={key:0,class:"form-section"},Is={class:"subsection-title"},Ms={class:"schedule-controls"},Ns=["onClick","disabled"],Ps=["onClick","disabled"],Os={class:"selection-count"},Vs={class:"table-container-wrapper"},js={class:"preview-table"},Us={class:"status-cell"},Ws=["onUpdate:modelValue","disabled"],qs=["onUpdate:modelValue","disabled"],Qs={class:"schedule-description"},Bs={key:3,class:"form-section"},Js={class:"selection-controls"},zs=["disabled"],Hs=["disabled"],Ys={class:"selection-count"},Ks={class:"table-container-wrapper"},Xs={class:"preview-table"},Zs={class:"status-cell"},Rs=["onUpdate:modelValue","disabled"],$s={key:0,class:"exceptions-badge"},el={class:"actions"},tl=["onClick","disabled"],sl={key:0,class:"summary-stats"},ll={class:"stat-item"},nl={class:"stat-value info"},ol={class:"stat-item"},al={class:"stat-value valid"},dl={class:"stat-item"},cl={class:"stat-value warning"},il={key:4,class:"summary-section"},ul={class:"summary-grid"},rl={class:"summary-item"},_l={class:"value"},hl={class:"summary-item"},fl={class:"value"},ml={class:"summary-item"},gl={class:"value"},vl={class:"summary-item"},Sl={class:"value"},bl={class:"summary-item"},pl={class:"value"},yl={class:"summary-item"},Cl={class:"value"},kl={class:"summary-item highlight"},Al={class:"value"},Fl={class:"selected-structures-in-summary"},xl={class:"structures-summary-grid"},El={class:"structure-summary-header"},Dl={class:"structure-name-plan"},wl={class:"structure-title"},Ll={class:"fee-plan-tag"},Gl={class:"structure-amounts"},Tl={class:"total-amount"},Il={class:"schedule-count"},Ml={class:"structure-components-summary"},Nl={class:"component-name"},Pl={class:"component-breakdown"},Ol={key:0},Vl={key:0,class:"schedule-preview"},jl={class:"schedule-dates"},Ul={key:0,class:"more-schedules"},Wl={class:"form-actions"},ql=["disabled"],Ql={class:"button-content"},Bl={key:0,class:"spinner"},Jl=["disabled"],zl={key:2,class:"form-card summary-card"},Hl={class:"message success"},Yl={class:"section-title"},Kl={class:"table-container-wrapper"},Xl={class:"preview-table"},Zl={class:"actions"},Rl=["href"],$l={class:"form-section"},en={class:"table-container-wrapper"},tn={class:"preview-table"},sn={key:0,class:"document-links"},ln=["href"],nn={key:0,class:"more-documents"},on={key:1,class:"document-links"},an=["href"],dn={key:0,class:"more-documents"},cn={key:2},un={class:"actions"},rn={key:0,class:"status-badge success"},_n={key:1,class:"status-badge error"},hn={class:"form-actions"};function fn(b,t,f,n,y,C){var I;const V=ze("StudentList");return d(),c("div",It,[e("div",Mt,[t[62]||(t[62]=e("div",{class:"header"},[e("h1",{class:"title"},"Create Fee Schedules & Invoices"),e("p",{class:"subtitle"},"Generate fee schedules and sales invoices for students")],-1)),n.processing?(d(),c("div",Nt,[e("div",Pt,[t[16]||(t[16]=e("div",{class:"loading-spinner"},null,-1)),t[17]||(t[17]=e("h3",{class:"loading-title"},"Processing Fee Schedules & Invoices",-1)),t[18]||(t[18]=e("p",{class:"loading-description"}," Please wait while we create fee schedules and generate invoices for all students. This may take a few minutes depending on the number of students. ",-1)),n.processingDetails?(d(),c("div",Ot,[t[15]||(t[15]=e("h4",null,"Processing Details",-1)),e("div",null,[e("div",null,[t[11]||(t[11]=e("strong",null,"Fee Structures:",-1)),w(" "+a(n.processingDetails.fee_structures),1)]),e("div",null,[t[12]||(t[12]=e("strong",null,"Student Groups:",-1)),w(" "+a(n.processingDetails.student_groups),1)]),e("div",null,[t[13]||(t[13]=e("strong",null,"Total Students:",-1)),w(" "+a(n.processingDetails.total_students),1)]),e("div",null,[t[14]||(t[14]=e("strong",null,"Total Schedules:",-1)),w(" "+a(n.processingDetails.schedule_count),1)])])])):v("",!0),t[19]||(t[19]=e("div",null,[e("div",{class:"spinner"}),w(" Creating fee schedules and invoices... ")],-1))])])):v("",!0),n.showStudentList?(d(),c("div",Vt,[e("div",jt,[Je(V,{"student-group":n.selectedStudentGroup,"fee-structures":n.selectedStructures,"initial-selections":n.getInitialSelections(n.selectedStudentGroup),onSave:n.handleStudentListSave,onClose:t[0]||(t[0]=l=>n.showStudentList=!1)},null,8,["student-group","fee-structures","initial-selections","onSave"])])])):v("",!0),e("div",Ut,[t[54]||(t[54]=e("h2",{class:"form-title"},"Fee Schedule Configuration",-1)),n.errorMessage?(d(),c("div",Wt,[t[20]||(t[20]=e("strong",null,"Error:",-1)),w(" "+a(n.errorMessage),1)])):v("",!0),n.successMessage?(d(),c("div",qt,[t[21]||(t[21]=e("strong",null,"Success:",-1)),w(" "+a(n.successMessage),1)])):v("",!0),e("div",Qt,[t[27]||(t[27]=e("h3",{class:"section-title"},"Basic Information",-1)),e("div",Bt,[e("div",Jt,[t[23]||(t[23]=e("label",null,"Class/Program",-1)),Q(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.formData.selected_class=l),class:"picker",disabled:n.classesResource.loading||n.processing,onChange:t[2]||(t[2]=(...l)=>n.onClassChange&&n.onClassChange(...l))},[t[22]||(t[22]=e("option",{value:""},"Select Class/Program",-1)),(d(!0),c(k,null,A(n.classesList,l=>(d(),c("option",{key:l.name,value:l.name},a(l.program_name||l.name),9,Ht))),128))],40,zt),[[ie,n.formData.selected_class]]),n.classesResource.loading?(d(),c("span",Yt,"Loading classes...")):v("",!0)])]),n.formData.selected_class&&n.feeSchedulesCount>0?(d(),c("div",Kt,[t[26]||(t[26]=e("div",{class:"note-icon"},"â„¹ï¸",-1)),e("div",Xt,[t[24]||(t[24]=e("strong",null,"Note:",-1)),t[25]||(t[25]=w(" This program already has ")),e("strong",null,a(n.feeSchedulesCount),1),w(" fee schedule"+a(n.feeSchedulesCount>1?"s":"")+" created for the current academic year. Creating new schedules will add to the existing ones. ",1)])])):v("",!0)]),n.formData.selected_class&&n.feeStructuresList.length?(d(),c("div",Zt,[t[38]||(t[38]=e("h3",{class:"section-title"},"Select Fee Structures",-1)),e("div",Rt,[e("button",{onClick:t[3]||(t[3]=(...l)=>n.selectAllStructures&&n.selectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,$t),e("button",{onClick:t[4]||(t[4]=(...l)=>n.deselectAllStructures&&n.deselectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,es),e("span",ts,a(n.selectedStructuresCount)+" of "+a(n.feeStructuresList.length)+" selected ",1)]),e("div",ss,[e("table",ls,[t[30]||(t[30]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Fee Structure")]),e("th",null,[e("div",{class:"header-label"},"Fee Plan")]),e("th",null,[e("div",{class:"header-label"},"Total Amount")]),e("th",{width:"80px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.feeStructuresList,l=>{var S;return d(),c("tr",{key:l.name,class:ue({"selected-row":l.selected})},[e("td",ns,[Q(e("input",{type:"checkbox","onUpdate:modelValue":i=>l.selected=i,disabled:n.processing,class:"custom-checkbox",onChange:i=>n.onStructureSelectionChange(l)},null,40,os),[[R,l.selected]])]),e("td",null,[e("div",as,[e("div",ds,a(l.name),1),e("div",cs,[w(a(l.program)+" â€¢ "+a(l.academic_year)+" ",1),l.academic_term?(d(),c("span",is,"â€¢ "+a(l.academic_term),1)):v("",!0)])])]),e("td",null,[Q(e("select",{"onUpdate:modelValue":i=>l.selected_fee_plan=i,class:"table-select",disabled:n.processing||!l.selected,onChange:i=>n.onFeePlanChange(l)},[t[28]||(t[28]=e("option",{value:""},"Select Plan",-1)),(d(!0),c(k,null,A(n.feePlans,i=>(d(),c("option",{key:i.value,value:i.value},a(i.label),9,rs))),128))],40,us),[[ie,l.selected_fee_plan]])]),e("td",null,[e("div",_s," â‚¹"+a((S=l.total_amount)==null?void 0:S.toLocaleString()),1)]),e("td",hs,[e("button",{class:ue(["details-button",{expanded:n.expandedStructures[l.name]}]),onClick:i=>n.toggleStructureDetails(l.name),disabled:n.processing},t[29]||(t[29]=[e("span",{class:"icon"},"â–¼",-1),w(" Details ")]),10,fs)])],2)}),128))])])]),(d(!0),c(k,null,A(n.feeStructuresList,l=>{var S;return d(),c("div",{key:l.name+"_details"},[n.expandedStructures[l.name]?(d(),c("div",ms,[e("div",gs,[e("h4",vs,"Fee Structure Details - "+a(l.name),1),e("div",Ss,[e("div",bs,[t[31]||(t[31]=e("span",{class:"label"},"Total Amount:",-1)),e("span",ps,"â‚¹"+a((S=l.total_amount)==null?void 0:S.toLocaleString()),1)]),e("div",ys,[t[32]||(t[32]=e("span",{class:"label"},"Academic Year:",-1)),e("span",Cs,a(l.academic_year),1)]),l.academic_term?(d(),c("div",ks,[t[33]||(t[33]=e("span",{class:"label"},"Academic Term:",-1)),e("span",As,a(l.academic_term),1)])):v("",!0),e("div",Fs,[t[34]||(t[34]=e("span",{class:"label"},"Selected Fee Plan:",-1)),e("span",xs,a(n.getFeePlanLabel(l.selected_fee_plan)||"Not selected"),1)])]),l.components&&l.components.length?(d(),c("div",Es,[t[36]||(t[36]=e("h5",{class:"subsubsection-title"},"Fee Components",-1)),e("div",Ds,[e("table",null,[t[35]||(t[35]=e("thead",null,[e("tr",null,[e("th",null,"Fee Category"),e("th",null,"Amount"),e("th",null,"Discount"),e("th",null,"Total"),e("th",null,"Installment Calculation")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.components,i=>{var D,p,F,N;return d(),c("tr",{key:i.fees_category},[e("td",null,a(i.fees_category),1),e("td",null,"â‚¹"+a((D=i.amount)==null?void 0:D.toLocaleString()),1),e("td",null,a(i.discount)+"%",1),e("td",null,"â‚¹"+a((p=i.total)==null?void 0:p.toLocaleString()),1),e("td",ws,[l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(d(),c("span",Ls," â‚¹"+a((F=i.total)==null?void 0:F.toLocaleString())+" Ã· "+a(n.getInstallmentCount(l.selected_fee_plan))+" months = â‚¹"+a((N=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:N.toLocaleString()),1)):(d(),c("span",Gs,"Full amount"))])])}),128))])])])])):v("",!0)]),l.selected_fee_plan&&l.feeSchedules&&l.feeSchedules.length?(d(),c("div",Ts,[e("h4",Is,"Fee Schedule Distribution - "+a(l.name),1),e("div",Ms,[e("button",{onClick:i=>n.selectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Select All ",8,Ns),e("button",{onClick:i=>n.deselectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,Ps),e("span",Os,a(n.getSelectedSchedulesCount(l))+" of "+a(l.feeSchedules.length)+" schedules selected ",1)]),e("div",Vs,[e("table",js,[t[37]||(t[37]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Due Date")]),e("th",null,[e("div",{class:"header-label"},"Amount")]),e("th",null,[e("div",{class:"header-label"},"Description")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.feeSchedules,(i,D)=>{var p;return d(),c("tr",{key:D},[e("td",Us,[Q(e("input",{type:"checkbox","onUpdate:modelValue":F=>i.selected=F,disabled:n.processing,class:"custom-checkbox"},null,8,Ws),[[R,i.selected]])]),e("td",null,[Q(e("input",{type:"date","onUpdate:modelValue":F=>i.due_date=F,disabled:n.processing,class:"table-input"},null,8,qs),[[He,i.due_date]])]),e("td",null,"â‚¹"+a((p=i.amount)==null?void 0:p.toLocaleString()),1),e("td",Qs,a(n.getScheduleDescription(l.selected_fee_plan,D,i.due_date)),1)])}),128))])])])])):v("",!0)])):v("",!0)])}),128))])):v("",!0),n.selectedStructuresCount>0&&n.studentGroupsList.length?(d(),c("div",Bs,[t[43]||(t[43]=e("h3",{class:"section-title"},"Select Student Groups",-1)),e("div",Js,[e("button",{onClick:t[5]||(t[5]=(...l)=>n.selectAllGroups&&n.selectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,zs),e("button",{onClick:t[6]||(t[6]=(...l)=>n.deselectAllGroups&&n.deselectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,Hs),e("span",Ys,a(n.selectedStudentGroups.length)+" of "+a(n.studentGroupsList.length)+" groups selected ",1)]),e("div",Ks,[e("table",Xs,[t[39]||(t[39]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Student Group")]),e("th",null,[e("div",{class:"header-label"},"Total Students")]),e("th",null,[e("div",{class:"header-label"},"Selected Students")]),e("th",{width:"100px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.studentGroupsList,l=>(d(),c("tr",{key:l.name},[e("td",Zs,[Q(e("input",{type:"checkbox","onUpdate:modelValue":S=>l.selected=S,disabled:n.processing,class:"custom-checkbox"},null,8,Rs),[[R,l.selected]])]),e("td",null,a(l.name),1),e("td",null,a(l.total_students),1),e("td",null,[w(a(n.getSelectedStudentsCount(l))+" / "+a(l.total_students)+" ",1),n.getSelectedStudentsCount(l)<l.total_students?(d(),c("span",$s," ("+a(l.total_students-n.getSelectedStudentsCount(l))+" excluded) ",1)):v("",!0)]),e("td",el,[e("button",{onClick:S=>n.openStudentList(l),class:"edit-button",disabled:n.processing}," Edit Students ",8,tl)])]))),128))])])]),n.selectedStudentGroups.length>0?(d(),c("div",sl,[e("div",ll,[t[40]||(t[40]=e("span",{class:"stat-label"},"Selected Groups",-1)),e("span",nl,a(n.selectedStudentGroups.length),1)]),e("div",ol,[t[41]||(t[41]=e("span",{class:"stat-label"},"Total Students",-1)),e("span",al,a(n.getTotalStudents()),1)]),e("div",dl,[t[42]||(t[42]=e("span",{class:"stat-label"},"Excluded Students",-1)),e("span",cl,a(n.getTotalExcludedStudents()),1)])])):v("",!0)])):v("",!0),n.isFormValid?(d(),c("div",il,[t[53]||(t[53]=e("h3",{class:"section-title"},"Summary",-1)),e("div",ul,[e("div",rl,[t[44]||(t[44]=e("span",{class:"label"},"Class:",-1)),e("span",_l,a(n.getClassName(n.formData.selected_class)),1)]),e("div",hl,[t[45]||(t[45]=e("span",{class:"label"},"Fee Structures:",-1)),e("span",fl,a(n.selectedStructuresCount)+" structures",1)]),e("div",ml,[t[46]||(t[46]=e("span",{class:"label"},"Student Groups:",-1)),e("span",gl,a(n.selectedStudentGroups.length)+" groups",1)]),e("div",vl,[t[47]||(t[47]=e("span",{class:"label"},"Total Students:",-1)),e("span",Sl,a(n.getTotalStudents()),1)]),e("div",bl,[t[48]||(t[48]=e("span",{class:"label"},"Excluded Students:",-1)),e("span",pl,a(n.getTotalExcludedStudents()),1)]),e("div",yl,[t[49]||(t[49]=e("span",{class:"label"},"Total Schedules:",-1)),e("span",Cl,a(n.getTotalSchedulesCount()),1)]),e("div",kl,[t[50]||(t[50]=e("span",{class:"label"},"Total Amount:",-1)),e("span",Al,"â‚¹"+a((I=n.getTotalAmount())==null?void 0:I.toLocaleString()),1)])]),e("div",Fl,[t[52]||(t[52]=e("h4",{class:"subsection-title"},"Selected Fee Structures",-1)),e("div",xl,[(d(!0),c(k,null,A(n.selectedStructures,l=>{var S;return d(),c("div",{key:l.name,class:"structure-summary-card"},[e("div",El,[e("div",Dl,[e("h5",wl,a(l.name),1),e("span",Ll,a(n.getFeePlanLabel(l.selected_fee_plan)),1)]),e("div",Gl,[e("span",Tl,"â‚¹"+a((S=l.total_amount)==null?void 0:S.toLocaleString()),1),e("span",Il,a(n.getSelectedSchedulesCount(l))+" schedules",1)])]),e("div",Ml,[(d(!0),c(k,null,A(l.components,i=>{var D,p;return d(),c("div",{key:i.fees_category,class:"component-summary"},[e("span",Nl,a(i.fees_category),1),e("span",Pl,[w(" â‚¹"+a((D=i.total)==null?void 0:D.toLocaleString())+" ",1),l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(d(),c("span",Ol," (â‚¹"+a((p=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:p.toLocaleString())+" Ã— "+a(n.getInstallmentCount(l.selected_fee_plan))+") ",1)):v("",!0)])])}),128))]),l.feeSchedules&&l.feeSchedules.filter(i=>i.selected).length>0?(d(),c("div",Vl,[t[51]||(t[51]=e("div",{class:"schedule-preview-title"},"Schedule:",-1)),e("div",jl,[(d(!0),c(k,null,A(l.feeSchedules.filter(i=>i.selected).slice(0,3),(i,D)=>(d(),c("span",{key:D,class:"schedule-date-tag"},a(n.formatScheduleDate(i.due_date)),1))),128)),l.feeSchedules.filter(i=>i.selected).length>3?(d(),c("span",Ul," +"+a(l.feeSchedules.filter(i=>i.selected).length-3)+" more ",1)):v("",!0)])])):v("",!0)])}),128))])])])):v("",!0),e("div",Wl,[e("button",{onClick:t[7]||(t[7]=(...l)=>n.createFeeSchedulesAndInvoices&&n.createFeeSchedulesAndInvoices(...l)),class:"enroll-button",disabled:!n.isFormValid||n.processing},[e("span",Ql,[n.processing?(d(),c("span",Bl)):v("",!0),w(" "+a(n.processing?"Processing...":`Create Fee Schedules for ${n.selectedStructuresCount} Structures`),1)])],8,ql),e("button",{onClick:t[8]||(t[8]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"reset-button",disabled:n.processing}," Reset Form ",8,Jl)])]),n.results&&n.results.success?(d(),c("div",zl,[t[61]||(t[61]=e("h2",{class:"form-title"},"Creation Results",-1)),e("div",Hl,[t[55]||(t[55]=e("strong",null,"Successfully Created!",-1)),w(" "+a(n.results.message),1)]),(d(!0),c(k,null,A(n.results.structure_results,l=>(d(),c("div",{key:l.fee_structure,class:"form-section"},[e("h3",Yl,"Fee Schedules Created - "+a(l.fee_structure),1),e("div",Kl,[e("table",Xl,[t[56]||(t[56]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Action")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.fee_schedules,S=>(d(),c("tr",{key:S},[e("td",null,a(S),1),e("td",Zl,[e("a",{href:`/app/fee-schedule/${S}`,target:"_blank",class:"primary-button",style:{padding:"0.5rem 1rem","font-size":"0.9rem","text-decoration":"none",display:"inline-block"}}," View ",8,Rl)])]))),128))])])])]))),128)),e("div",$l,[t[60]||(t[60]=e("h3",{class:"section-title"},"Invoice Results Summary",-1)),e("div",en,[e("table",tn,[t[59]||(t[59]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Students Processed"),e("th",null,"Created Documents"),e("th",null,"Actions")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.results.invoice_results,l=>(d(),c("tr",{key:l.fee_schedule},[e("td",null,a(l.fee_schedule),1),e("td",null,a(l.result.created_count)+"/"+a(l.result.total_students),1),e("td",null,[l.result.submitted_invoices&&l.result.submitted_invoices.length>0?(d(),c("div",sn,[t[57]||(t[57]=e("strong",null,"Invoices:",-1)),(d(!0),c(k,null,A(l.result.submitted_invoices.slice(0,3),S=>(d(),c("div",{key:S,class:"document-link"},[e("a",{href:`/app/sales-invoice/${S}`,target:"_blank",class:"link"},a(S),9,ln)]))),128)),l.result.submitted_invoices.length>3?(d(),c("div",nn," +"+a(l.result.submitted_invoices.length-3)+" more invoices ",1)):v("",!0)])):v("",!0),l.result.submitted_orders&&l.result.submitted_orders.length>0?(d(),c("div",on,[t[58]||(t[58]=e("strong",null,"Orders:",-1)),(d(!0),c(k,null,A(l.result.submitted_orders.slice(0,3),S=>(d(),c("div",{key:S,class:"document-link"},[e("a",{href:`/app/sales-order/${S}`,target:"_blank",class:"link"},a(S),9,an)]))),128)),l.result.submitted_orders.length>3?(d(),c("div",dn," +"+a(l.result.submitted_orders.length-3)+" more orders ",1)):v("",!0)])):v("",!0),!l.result.submitted_invoices&&!l.result.submitted_orders?(d(),c("div",cn," No documents created ")):v("",!0)]),e("td",un,[l.result.success?(d(),c("span",rn,"Success")):(d(),c("span",_n,"Failed"))])]))),128))])])])]),e("div",hn,[e("button",{onClick:t[9]||(t[9]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"success-button"}," Create Another "),e("button",{onClick:t[10]||(t[10]=l=>n.results=null),class:"secondary-button"}," Close Results ")])])):v("",!0)])])}const Sn=re(Tt,[["render",fn],["__scopeId","data-v-442c0cfb"]]);export{Sn as default};
