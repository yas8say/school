var te=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var G=(i,s,a)=>s in i?te(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,k=(i,s)=>{for(var a in s||(s={}))le.call(s,a)&&G(i,a,s[a]);if(q)for(var a of q(s))re.call(s,a)&&G(i,a,s[a]);return i},A=(i,s)=>ne(i,ae(s));var D=(i,s,a)=>new Promise((o,v)=>{var m=r=>{try{c(a.next(r))}catch(t){v(t)}},f=r=>{try{c(a.throw(r))}catch(t){v(t)}},c=r=>r.done?o(r.value):Promise.resolve(r.value).then(m,f);c((a=a.apply(i,s)).next())});import{_ as ie,r as y,G as de,c as j,C as B,j as ue,a as u,b as n,y as Y,A as P,F as L,l as w,t as p,i as g,q as ce,e as me,p as ge,f as x,o as d}from"./index-BhxGw4-h.js";import{S as ve}from"./StudentList-BCqS-FCQ.js";import{T as Se}from"./Toast-ubmoBs-Y.js";import"./StudentAvatar-CS1o3-Mh.js";const ye={name:"StudentsPage",components:{StudentList:ve,Toast:Se},setup(){const i=ge(),s=y(null),a=y(null),o=y(null),v=y(null),m=y([]),f=y([]),c=y([]),r=y([]),t=de({}),I=j(()=>m.value.map((e,l)=>({original:e,display:l===0?`${e} - Current Year`:e}))),U=j(()=>({name:o.value,students:r.value.map(e=>({student:e.student,student_name:e.student_name,group_roll_number:e.group_roll_number,student_image:e.student_image,address:e.address,mobile:e.mobile}))})),S={academicYears:{url:"school.al_ummah.api3.get_academic_years",params:{values:{}}},classes:{url:"school.al_ummah.api3.get_classes",params:{values:{}}},divisions:{url:"school.al_ummah.api3.get_divisions2",getParams:()=>({values:{classId:a.value,academicYear:s.value}})},students:{url:"school.al_ummah.api2.get_basic_student_list",getParams:()=>({student_group:o.value})},deleteStudents:{url:"school.al_ummah.api2.delete_students",method:"POST"}},E=e=>B({url:e.url,params:e.getParams?e.getParams():e.params,auto:e.auto!==!1,onSuccess:e.onSuccess,onError:e.onError}),O=E(A(k({},S.academicYears),{onSuccess:e=>{m.value=Array.isArray(e)?e:[],m.value.length>0&&(s.value=m.value[0])},onError:e=>{console.error("Error fetching academic years:",e),m.value=[]}})),F=E(A(k({},S.classes),{onSuccess:e=>{f.value=Array.isArray(e)?e:[]},onError:e=>{console.error("Error fetching classes:",e),f.value=[]}})),N=E(A(k({},S.divisions),{auto:!1,onSuccess:e=>{c.value=Array.isArray(e)?e:[],o.value=null},onError:e=>{console.error("Error fetching divisions:",e),c.value=[],o.value=null}})),h=E(A(k({},S.students),{auto:!1,onSuccess:e=>{if(r.value=Array.isArray(e)?e:[],console.log("ðŸ” COMPLETE Backend response analysis:"),r.value.length>0){const l=r.value[0];console.log("ðŸ” First student ALL fields:",l),console.log("ðŸ” Available fields:",Object.keys(l)),console.log("ðŸ” Address field:",l.address),console.log("ðŸ” Mobile field:",l.mobile),console.log("ðŸ” student_image field:",l.student_image)}r.value.length>0&&M(`Loaded ${r.value.length} students`)},onError:e=>{console.error("Error loading students:",e),r.value=[],C("Failed to load students. Please try again.")}})),J=B({url:S.deleteStudents.url,method:S.deleteStudents.method,auto:!1,onSuccess:e=>{h.reload(),e.success?M(`Successfully deleted ${e.deleted_count} student(s)`):e.errors&&e.errors.length>0&&C(`Deleted ${e.deleted_count} students with ${e.errors.length} errors: ${e.errors.join(", ")}`)},onError:e=>{var l;console.error("Error deleting students:",e),C(((l=e.messages)==null?void 0:l[0])||"Failed to delete students")}}),b=(e,l="success",_=6e3,R=[])=>{v.value&&v.value.showToast?v.value.showToast(e,l,_,R):console.log(`Toast: ${l} - ${e}`)},C=e=>{b(e,"error",8e3)},M=e=>{b(e,"success",5e3)},z=(e,l,_=null)=>{b(e,"warning",0,[{label:"Confirm",type:"primary",onClick:l,closeOnClick:!0},{label:"Cancel",type:"secondary",onClick:_||(()=>{}),closeOnClick:!0}])},H=()=>{a.value=null,o.value=null,c.value=[],T()},K=()=>{o.value=null,T(),a.value&&s.value?(N.update({params:S.divisions.getParams()}),N.reload()):c.value=[]},Q=()=>{T(),o.value&&V()},V=()=>{W()?(h.update({params:S.students.getParams()}),h.reload(),b("Loading students...","info",2e3)):C("Please select academic year, class, and division")},W=()=>{Object.assign(t,{});let e=!0;return s.value||(t.academicYear="Please select an academic year",e=!1),a.value||(t.className="Please select a class",e=!1),o.value||(t.divisionName="Please select a division",e=!1),e},T=()=>{Object.assign(t,{})},X=e=>{console.log("ðŸŽ¯ COMPLETE Student data being sent:",e);const l={student:e.student,student_name:e.student_name,group_roll_number:e.group_roll_number,student_image:e.student_image,address:e.address,mobile:e.mobile,student_group:U.value.name};console.log("ðŸ“¤ Navigation payload with ALL fields:",l);const _={studentId:e.student,studentData:JSON.stringify(l)};i.push({name:"EditStudent",query:_}).catch(R=>{console.error("âŒ Router navigation failed:",R);const oe=`/edit-student?studentId=${e.student}&studentData=${JSON.stringify(l)}`;window.location.href=oe})},Z=e=>D(this,null,function*(){const l=Array.isArray(e)?e:[e],_=`Are you sure you want to delete ${l.length} student(s)? This action cannot be undone.`;z(_,()=>D(this,null,function*(){try{J.submit({student_ids:l})}catch(R){C("Failed to delete students. Please try again.")}}),()=>{b("Deletion cancelled","info",3e3)})}),$=()=>{i.push({name:"AddStudent"})},ee=()=>{i.push({name:"UploadStudents"})},se=()=>{h.reload()};return ue(()=>{O.reload(),F.reload()}),{selectedAcademicYear:s,selectedClassName:a,selectedDivisionName:o,academicYears:m,classes:f,divisions:c,studentsList:r,selectionErrors:t,displayYears:I,currentStudentGroup:U,academicYearsResource:O,classesResource:F,divisionsResource:N,studentsResource:h,toastRef:v,onYearChange:H,onClassChange:K,onDivisionChange:Q,loadStudents:V,handleStudentClick:X,handleStudentDelete:Z,navigateToAdd:$,navigateToUpload:ee,refreshStudents:se}}},fe={class:"students-page"},_e={class:"page-header"},pe={class:"header-actions"},he={class:"selection-card"},be={class:"selection-grid"},Ce={class:"form-group required"},ke=["disabled"],Ae=["value"],Ee={key:0,class:"error-message"},Re={class:"form-group required"},Ne=["disabled"],Te=["value"],De={key:0,class:"error-message"},Ye={key:0,class:"form-group required"},Pe=["disabled"],Le=["value"],we={key:0,class:"error-message"},Ue={key:0,class:"loading-state"},Oe={key:1,class:"error-state"},Fe={key:3,class:"empty-state"},Me={class:"empty-actions"},Ve={key:4,class:"no-selection-state"};function qe(i,s,a,o,v,m){var r;const f=x("StudentList"),c=x("Toast");return d(),u("div",fe,[n("div",_e,[s[11]||(s[11]=n("h1",{class:"page-title"},"Student Management",-1)),n("div",pe,[n("button",{onClick:s[0]||(s[0]=(...t)=>o.navigateToUpload&&o.navigateToUpload(...t)),class:"action-button secondary-button"}," Upload Students "),n("button",{onClick:s[1]||(s[1]=(...t)=>o.navigateToAdd&&o.navigateToAdd(...t)),class:"action-button primary-button"}," Add New Student ")])]),n("div",he,[s[18]||(s[18]=n("h2",{class:"selection-title"},"Select Student Group",-1)),n("div",be,[n("div",Ce,[s[13]||(s[13]=n("label",null,"Academic Year",-1)),Y(n("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>o.selectedAcademicYear=t),class:"picker",onChange:s[3]||(s[3]=(...t)=>o.onYearChange&&o.onYearChange(...t)),disabled:o.academicYearsResource.loading},[s[12]||(s[12]=n("option",{value:null},"Select Academic Year",-1)),(d(!0),u(L,null,w(o.displayYears,t=>(d(),u("option",{key:t,value:t.original},p(t.display),9,Ae))),128))],40,ke),[[P,o.selectedAcademicYear]]),o.selectionErrors.academicYear?(d(),u("span",Ee,p(o.selectionErrors.academicYear),1)):g("",!0)]),n("div",Re,[s[15]||(s[15]=n("label",null,"Class / Program",-1)),Y(n("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>o.selectedClassName=t),class:"picker",onChange:s[5]||(s[5]=(...t)=>o.onClassChange&&o.onClassChange(...t)),disabled:!o.selectedAcademicYear||o.classesResource.loading},[s[14]||(s[14]=n("option",{value:null},"Select Class / Program",-1)),(d(!0),u(L,null,w(o.classes,t=>(d(),u("option",{key:t.name,value:t.name},p(t.name),9,Te))),128))],40,Ne),[[P,o.selectedClassName]]),o.selectionErrors.className?(d(),u("span",De,p(o.selectionErrors.className),1)):g("",!0)]),o.divisions.length>0?(d(),u("div",Ye,[s[17]||(s[17]=n("label",null,"Division / Student Group",-1)),Y(n("select",{"onUpdate:modelValue":s[6]||(s[6]=t=>o.selectedDivisionName=t),class:"picker",onChange:s[7]||(s[7]=(...t)=>o.onDivisionChange&&o.onDivisionChange(...t)),disabled:!o.selectedClassName||o.divisionsResource.loading},[s[16]||(s[16]=n("option",{value:null},"Select Division / Student Group",-1)),(d(!0),u(L,null,w(o.divisions,t=>(d(),u("option",{key:t.name,value:t.name},p(t.name),9,Le))),128))],40,Pe),[[P,o.selectedDivisionName]]),o.selectionErrors.divisionName?(d(),u("span",we,p(o.selectionErrors.divisionName),1)):g("",!0)])):g("",!0)])]),o.studentsResource.loading?(d(),u("div",Ue,s[19]||(s[19]=[n("p",null,"Loading students...",-1)]))):g("",!0),o.studentsResource.error?(d(),u("div",Oe,[n("p",null,"Error loading students: "+p(o.studentsResource.error),1),n("button",{onClick:s[8]||(s[8]=(...t)=>o.refreshStudents&&o.refreshStudents(...t)),class:"retry-button"}," Retry ")])):g("",!0),!o.studentsResource.loading&&!o.studentsResource.error&&o.studentsList.length>0?(d(),ce(f,{key:2,mode:"students","student-group":o.currentStudentGroup,onStudentClicked:o.handleStudentClick,onStudentsSelectedForDelete:o.handleStudentDelete,onRefresh:o.refreshStudents},null,8,["student-group","onStudentClicked","onStudentsSelectedForDelete","onRefresh"])):g("",!0),!o.studentsResource.loading&&!o.studentsResource.error&&((r=o.studentsList)==null?void 0:r.length)===0&&o.selectedDivisionName?(d(),u("div",Fe,[s[20]||(s[20]=n("p",{class:"empty-message"},"No students found in this group",-1)),n("div",Me,[n("button",{onClick:s[9]||(s[9]=(...t)=>o.navigateToAdd&&o.navigateToAdd(...t)),class:"action-button primary-button empty-action"}," Add First Student "),n("button",{onClick:s[10]||(s[10]=(...t)=>o.navigateToUpload&&o.navigateToUpload(...t)),class:"action-button secondary-button empty-action"}," Upload Students ")])])):g("",!0),!o.selectedDivisionName&&!o.studentsResource.loading?(d(),u("div",Ve,s[21]||(s[21]=[n("p",{class:"no-selection-message"},"Please select an academic year, class, and division to view students",-1)]))):g("",!0),me(c,{ref:"toastRef"},null,512)])}const Je=ie(ye,[["render",qe],["__scopeId","data-v-cc50a038"]]);export{Je as default};
