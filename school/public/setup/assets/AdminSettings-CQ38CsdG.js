var P=Object.defineProperty;var A=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var F=(c,r,o)=>r in c?P(c,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[r]=o,w=(c,r)=>{for(var o in r||(r={}))U.call(r,o)&&F(c,o,r[o]);if(A)for(var o of A(r))q.call(r,o)&&F(c,o,r[o]);return c};var N=(c,r,o)=>new Promise((p,x)=>{var l=i=>{try{b(o.next(i))}catch(u){x(u)}},a=i=>{try{b(o.throw(i))}catch(u){x(u)}},b=i=>i.done?p(i.value):Promise.resolve(i.value).then(l,a);b((o=o.apply(c,r)).next())});import{_ as I,z as W,r as v,C as O,c as V,q as j,x as G,a as m,b as t,t as _,g as J,l as $,D as K,v as D,h as R,i as M,n as Q,o as y}from"./index-BVhAGwWm.js";const X={class:"min-h-screen bg-gray-50 p-6"},Y={class:"max-w-4xl mx-auto"},Z={class:"bg-white rounded-lg shadow-md p-6"},ee={key:0,class:"flex justify-center py-8"},te={key:1,class:"text-center py-8"},se={class:"text-gray-600 mb-4"},oe={class:"mb-8"},ne={class:"flex items-center justify-between"},re={class:"relative inline-flex items-center cursor-pointer"},ae={class:"mb-8"},le={class:"flex items-center space-x-4"},ie={class:"flex items-center space-x-2"},ue={class:"text-sm text-gray-600"},de={key:0},ce={class:"font-medium text-gray-800"},ge={key:1,class:"text-gray-500"},ve={class:"mt-4 flex flex-wrap gap-2"},me={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg"},ye={class:"text-sm text-blue-700"},pe={class:"flex justify-end space-x-4 pt-6 border-t"},xe=["disabled"],be=["disabled"],fe={key:0,class:"mt-4 p-4 bg-green-100 text-green-700 rounded-lg border border-green-200"},_e={key:1,class:"mt-4 p-4 bg-red-100 text-red-700 rounded-lg border border-red-200"},he={__name:"AdminSettings",setup(c){const r={allow_instructors_modify_student:!1,session_expiry:"24:00"},o=W(w({},r)),p=v(w({},r)),x=v(""),l=v(24),a=v(0),b=v(!0),i=v(""),u=v(!1),f=v(""),g=v(""),C=s=>{if(!s)return{hours:24,minutes:0};const[e,n]=s.split(":").map(Number);return{hours:e||0,minutes:n||0}};O([l,a],()=>{o.session_expiry=`${l.value}:${a.value.toString().padStart(2,"0")}`});const k=V(()=>l.value+a.value/60),S=V(()=>o.allow_instructors_modify_student!==p.value.allow_instructors_modify_student||o.session_expiry!==p.value.session_expiry),E=s=>{const e=Math.floor(s);if(e<24)return`${e} hour${e!==1?"s":""}`;if(e<168){const n=Math.floor(e/24),d=e%24;return d===0?`${n} day${n!==1?"s":""}`:`${n} day${n!==1?"s":""} and ${d} hour${d!==1?"s":""}`}else if(e<8760){const n=Math.floor(e/168),d=Math.floor(e%168/24);return d===0?`${n} week${n!==1?"s":""}`:`${n} week${n!==1?"s":""} and ${d} day${d!==1?"s":""}`}else{const n=Math.floor(e/8760),d=Math.floor(e%8760/168);return d===0?`${n} year${n!==1?"s":""}`:`${n} year${n!==1?"s":""} and ${d} week${d!==1?"s":""}`}},h=(s,e)=>{l.value=s,a.value=e},H=j({url:"school.al_ummah.api3.fetch_admin_settings",onSuccess(s){if(console.log("Settings fetched successfully:",s),o.allow_instructors_modify_student=s.allow_instructors_modify_student===1,s.session_expiry){o.session_expiry=s.session_expiry,x.value=s.session_expiry;const e=C(s.session_expiry);l.value=e.hours,a.value=e.minutes}else o.session_expiry="24:00",x.value="24:00",l.value=24,a.value=0;p.value=w({},o),b.value=!1,i.value=""},onError(s){console.error("Error fetching settings:",s),b.value=!1,i.value=(s==null?void 0:s.message)||"Failed to load settings from server."}}),z=j({url:"school.al_ummah.api3.save_admin_settings",onSuccess(s){console.log("Settings saved successfully:",s),u.value=!1,p.value=w({},o),x.value=o.session_expiry,f.value="Settings saved successfully!",g.value="",setTimeout(()=>{f.value=""},5e3)},onError(s){console.error("Error saving settings:",s),u.value=!1,g.value=(s==null?void 0:s.message)||"Failed to save settings. Please try again.",f.value=""}}),B=()=>N(this,null,function*(){if(!S.value){g.value="No changes to save.";return}if(l.value<0||a.value<0||a.value>59){g.value="Hours cannot be negative and minutes must be between 0-59.";return}if(l.value===0&&a.value===0){g.value="Session expiry cannot be zero.";return}u.value=!0,f.value="",g.value="";try{yield z.submit({allow_instructors_modify_student:o.allow_instructors_modify_student,session_expiry:o.session_expiry})}catch(s){console.error("Error in save settings:",s),u.value=!1,g.value="An unexpected error occurred. Please try again."}}),L=()=>{Object.assign(o,p.value);const s=C(p.value.session_expiry);l.value=s.hours,a.value=s.minutes,f.value="",g.value=""},T=()=>{b.value=!0,i.value="",H.submit()};return G(()=>{console.log("Admin Settings component mounted, fetching settings..."),H.submit()}),(s,e)=>(y(),m("div",X,[t("div",Y,[e[19]||(e[19]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-800"},"Admin Settings"),t("p",{class:"text-gray-600 mt-2"},"Manage system configuration and permissions")],-1)),t("div",Z,[b.value?(y(),m("div",ee,e[8]||(e[8]=[t("div",{class:"spinner"},null,-1),t("span",{class:"ml-3 text-gray-700"},"Loading settings...",-1)]))):i.value?(y(),m("div",te,[e[9]||(e[9]=t("div",{class:"text-red-600 mb-4"},[t("svg",{class:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e[10]||(e[10]=t("h3",{class:"text-lg font-medium text-gray-800 mb-2"},"Failed to load settings",-1)),t("p",se,_(i.value),1),t("button",{onClick:T,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Retry ")])):(y(),m("form",{key:2,onSubmit:J(B,["prevent"])},[t("div",oe,[t("div",ne,[e[12]||(e[12]=t("div",null,[t("h3",{class:"text-lg font-medium text-gray-800 mb-2"}," Allow Instructors to modify Student data "),t("p",{class:"text-gray-600 text-sm"}," When enabled, instructors will have permission to edit and update student information ")],-1)),t("label",re,[$(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=n=>o.allow_instructors_modify_student=n),class:"sr-only peer"},null,512),[[K,o.allow_instructors_modify_student]]),e[11]||(e[11]=t("div",{class:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"},null,-1))])])]),t("div",ae,[e[16]||(e[16]=t("label",{for:"session_expiry",class:"block text-lg font-medium text-gray-800 mb-2"}," Session Expiry (HH:MM) ",-1)),e[17]||(e[17]=t("p",{class:"text-gray-600 text-sm mb-4"}," Set the duration after which user sessions will automatically expire in hours and minutes ",-1)),t("div",le,[t("div",ie,[$(t("input",{id:"hours",type:"number","onUpdate:modelValue":e[1]||(e[1]=n=>l.value=n),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Hours"},null,512),[[D,l.value,void 0,{number:!0}]]),e[13]||(e[13]=t("span",{class:"text-gray-600"},":",-1)),$(t("input",{id:"minutes",type:"number","onUpdate:modelValue":e[2]||(e[2]=n=>a.value=n),min:"0",max:"59",class:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Minutes"},null,512),[[D,a.value,void 0,{number:!0}]])]),t("div",ue,[k.value>0?(y(),m("div",de,[e[14]||(e[14]=R(" Equivalent to: ")),t("span",ce,_(E(k.value)),1)])):(y(),m("div",ge," Enter hours and minutes "))])]),e[18]||(e[18]=t("p",{class:"text-gray-500 text-xs mt-2"}," No maximum limit - set any duration as needed ",-1)),t("div",ve,[t("button",{type:"button",onClick:e[3]||(e[3]=n=>h(1,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 hour "),t("button",{type:"button",onClick:e[4]||(e[4]=n=>h(8,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 8 hours "),t("button",{type:"button",onClick:e[5]||(e[5]=n=>h(24,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 24 hours "),t("button",{type:"button",onClick:e[6]||(e[6]=n=>h(168,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 week "),t("button",{type:"button",onClick:e[7]||(e[7]=n=>h(720,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 month ")]),x.value?(y(),m("div",me,[t("p",ye,[e[15]||(e[15]=t("span",{class:"font-medium"},"Current setting:",-1)),R(" "+_(x.value)+" ("+_(E(k.value))+") ",1)])])):M("",!0)]),t("div",pe,[t("button",{type:"button",onClick:L,disabled:u.value,class:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Reset ",8,xe),t("button",{type:"submit",disabled:u.value||!S.value,class:Q(["px-8 py-3 rounded-lg font-medium transition-colors",u.value||!S.value?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"])},_(u.value?"Saving...":"Save Settings"),11,be)])],32))]),f.value?(y(),m("div",fe,_(f.value),1)):M("",!0),g.value?(y(),m("div",_e,_(g.value),1)):M("",!0)])]))}},Se=I(he,[["__scopeId","data-v-29b9337c"]]);export{Se as default};
