var ce=Object.defineProperty,me=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ae=(s,e,n)=>e in s?ce(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n,L=(s,e)=>{for(var n in e||(e={}))pe.call(e,n)&&ae(s,n,e[n]);if(ne)for(var n of ne(e))he.call(e,n)&&ae(s,n,e[n]);return s},G=(s,e)=>me(s,ge(e));var le=(s,e,n)=>new Promise((r,a)=>{var i=l=>{try{u(n.next(l))}catch(p){a(p)}},o=l=>{try{u(n.throw(l))}catch(p){a(p)}},u=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,o);u((n=n.apply(s,e)).next())});import{_ as O,o as d,a as c,b as t,y as _,z as k,A as X,F as S,l as C,t as m,i as v,H as ue,h as D,r as w,C as H,j as re,n as T,L as E,g as ie,c as W,x as R,d as de,G as fe,q as ve,v as be,e as ye,f as Se}from"./index-BhxGw4-h.js";/* empty css             */const Ce={props:{values:Object},computed:{email:{get(){return this.values.email},set(s){this.$emit("update-field",{field:"email",value:s})}},googleAppPassword:{get(){return this.values.googleAppPassword},set(s){this.$emit("update-field",{field:"googleAppPassword",value:s})}}},methods:{updateField(s,e){this.$emit("update-field",{field:s,value:e})}}},xe={class:"card"},_e={class:"field"},we={class:"field"};function ke(s,e,n,r,a,i){return d(),c("div",xe,[t("div",_e,[e[5]||(e[5]=t("label",null,"Email Address",-1)),_(t("input",{type:"email","onUpdate:modelValue":e[0]||(e[0]=o=>i.email=o),placeholder:"Enter your email address",onInput:e[1]||(e[1]=o=>i.updateField("email",o.target.value))},null,544),[[k,i.email]])]),t("div",we,[e[6]||(e[6]=t("label",null,"Google App Password",-1)),_(t("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=o=>i.googleAppPassword=o),placeholder:"Enter your Google app password",onInput:e[3]||(e[3]=o=>i.updateField("googleAppPassword",o.target.value))},null,544),[[k,i.googleAppPassword]])]),t("button",{onClick:e[4]||(e[4]=o=>s.$emit("submit-email"))},"Submit Email Account")])}const Te=O(Ce,[["render",ke],["__scopeId","data-v-a1f91314"]]),De={props:{values:Object},data(){return{selectedTerm:"",lastValidTermCount:0}},computed:{setAsCurrent:{get(){return this.values.setAsCurrent||!1},set(s){this.$emit("update-field",{field:"setAsCurrent",value:s})}},academicYear:{get(){return this.values.academicYear},set(s){this.$emit("update-field",{field:"academicYear",value:s})}},academicYearStart:{get(){return this.values.academicYearStart},set(s){this.$emit("update-field",{field:"academicYearStart",value:s})}},academicYearEnd:{get(){return this.values.academicYearEnd},set(s){this.$emit("update-field",{field:"academicYearEnd",value:s})}},numberOfTerms:{get(){return this.values.numberOfTerms},set(s){this.$emit("update-field",{field:"numberOfTerms",value:s})}}},methods:{handleNumberOfTermsChange(s){const e=parseInt(s.target.value);!isNaN(e)&&e>0?(this.numberOfTerms=e,this.lastValidTermCount=e,this.adjustTermsToMatchCount()):this.numberOfTerms=this.lastValidTermCount},incrementTerms(){this.numberOfTerms=parseInt(this.numberOfTerms)+1,this.adjustTermsToMatchCount()},decrementTerms(){this.numberOfTerms>1&&(this.numberOfTerms=parseInt(this.numberOfTerms)-1,this.adjustTermsToMatchCount())},adjustTermsToMatchCount(){const s=this.values.terms.length,e=this.numberOfTerms;if(e>s){const n=e-s,r=[...this.values.terms];for(let a=0;a<n;a++){const i=s+a+1,{startDate:o,endDate:u}=this.calculateTermDates(i,e);r.push({name:`Term ${i}`,startDate:o,endDate:u})}this.$emit("update-field-array",{field:"terms",value:r})}else if(e<s){const n=s-e,r=[...this.values.terms];r.splice(-n,n),this.$emit("update-field-array",{field:"terms",value:r})}},calculateTermDates(s,e){if(!this.academicYearStart||!this.academicYearEnd)return{startDate:"",endDate:""};const n=new Date(this.academicYearStart),i=(new Date(this.academicYearEnd)-n)/e,o=new Date(n.getTime()+i*(s-1)),u=new Date(n.getTime()+i*s-1),l=p=>p.toISOString().split("T")[0];return{startDate:l(o),endDate:l(u)}},formatDate(s){if(!s)return"";const e={year:"numeric",month:"short",day:"numeric"};return new Date(s).toLocaleDateString(void 0,e)},updateField(s,e){this.$emit("update-field",{field:s,value:e})},updateTermField(s,e,n){this.$emit("update-field-array",{field:"terms",index:s,subField:e,value:n})},addTerm(){const s={name:"",startDate:"",endDate:""};this.$emit("update-field-array",{field:"terms",value:[...this.values.terms,s]}),this.numberOfTerms=this.values.terms.length},removeTerm(s){const e=[...this.values.terms];e.splice(s,1),this.$emit("update-field-array",{field:"terms",value:e}),this.numberOfTerms=e.length},handleTermsInput(s){const e=parseInt(s.target.value);!isNaN(e)&&e>0?(this.numberOfTerms=e,this.lastValidTermCount=e,this.$emit("auto-create-terms")):this.numberOfTerms=this.lastValidTermCount},incrementTerms(){this.numberOfTerms=parseInt(this.numberOfTerms)+1,this.$emit("auto-create-terms")},decrementTerms(){this.numberOfTerms>1&&(this.numberOfTerms=parseInt(this.numberOfTerms)-1,this.$emit("auto-create-terms"))}},mounted(){this.lastValidTermCount=this.numberOfTerms||1}},Ae={class:"academic-year-form"},je={class:"form-grid"},Ne={class:"form-row"},Me={class:"form-group full-width required"},Fe={class:"form-row date-range-row"},Pe={class:"form-group required"},Be={class:"form-group required"},Ee={class:"form-row"},Le={class:"form-group full-width required"},Oe={class:"number-input-group"},Ie={class:"number-input-buttons"},Ue=["disabled"],Ye={key:0,class:"form-row"},Ge={class:"form-group full-width"},qe=["value"],Ve={class:"form-row"},We={class:"form-group full-width"},Re={class:"checkbox-label"},He={class:"terms-list"},Ke={class:"term-header"},ze={class:"section-title"},$e=["onClick"],Je={class:"term-body"},Qe={class:"form-group required"},Ze=["onUpdate:modelValue","placeholder","onInput"],Xe={class:"form-row term-dates-row"},et={class:"form-group required"},tt=["onUpdate:modelValue","onInput"],st={class:"form-group required"},ot=["onUpdate:modelValue","onInput"],it={class:"form-actions"};function rt(s,e,n,r,a,i){return d(),c("div",Ae,[e[26]||(e[26]=t("div",{class:"form-header"},[t("p",{class:"form-subtitle"}," Provide details about the academic year, its duration, and terms. ")],-1)),t("div",je,[t("div",Ne,[t("div",Me,[e[15]||(e[15]=t("label",{class:"form-label"},"Academic Year",-1)),_(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>i.academicYear=o),class:"input",placeholder:"e.g., 2023-2024",onInput:e[1]||(e[1]=o=>i.updateField("academicYear",o.target.value))},null,544),[[k,i.academicYear]])])]),t("div",Fe,[t("div",Pe,[e[16]||(e[16]=t("label",{class:"form-label"},"Start Date",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=o=>i.academicYearStart=o),class:"input",onInput:e[3]||(e[3]=o=>i.updateField("academicYearStart",o.target.value))},null,544),[[k,i.academicYearStart]])]),t("div",Be,[e[17]||(e[17]=t("label",{class:"form-label"},"End Date",-1)),_(t("input",{type:"date","onUpdate:modelValue":e[4]||(e[4]=o=>i.academicYearEnd=o),class:"input",onInput:e[5]||(e[5]=o=>i.updateField("academicYearEnd",o.target.value))},null,544),[[k,i.academicYearEnd]])])]),t("div",Ee,[t("div",Le,[e[18]||(e[18]=t("label",{class:"form-label"},"Number of Terms",-1)),t("div",Oe,[_(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=o=>i.numberOfTerms=o),class:"input number-input",placeholder:"e.g., 3",min:"1",onInput:e[7]||(e[7]=(...o)=>i.handleNumberOfTermsChange&&i.handleNumberOfTermsChange(...o))},null,544),[[k,i.numberOfTerms,void 0,{number:!0}]]),t("div",Ie,[t("button",{class:"number-input-btn minus-btn",onClick:e[8]||(e[8]=(...o)=>i.decrementTerms&&i.decrementTerms(...o)),disabled:i.numberOfTerms<=1,type:"button"}," âˆ’ ",8,Ue),t("button",{class:"number-input-btn plus-btn",onClick:e[9]||(e[9]=(...o)=>i.incrementTerms&&i.incrementTerms(...o)),type:"button"}," + ")])])])]),i.setAsCurrent?(d(),c("div",Ye,[t("div",Ge,[e[20]||(e[20]=t("label",{class:"form-label"},"Current Academic Term",-1)),_(t("select",{"onUpdate:modelValue":e[10]||(e[10]=o=>a.selectedTerm=o),class:"picker",onChange:e[11]||(e[11]=o=>i.updateField("selectedTerm",o.target.value))},[e[19]||(e[19]=t("option",{value:""},"-- Select a Term --",-1)),(d(!0),c(S,null,C(n.values.terms,(o,u)=>(d(),c("option",{key:u,value:o.name},m(o.name)+" ("+m(i.formatDate(o.startDate))+" - "+m(i.formatDate(o.endDate))+") ",9,qe))),128))],544),[[X,a.selectedTerm]])])])):v("",!0),t("div",Ve,[t("div",We,[t("label",Re,[_(t("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=o=>i.setAsCurrent=o),onChange:e[13]||(e[13]=o=>i.updateField("setAsCurrent",o.target.checked))},null,544),[[ue,i.setAsCurrent]]),e[21]||(e[21]=D(" Set as Current Academic Year "))])])])]),t("div",He,[(d(!0),c(S,null,C(n.values.terms,(o,u)=>(d(),c("div",{key:u,class:"term-card form-card"},[t("div",Ke,[t("h4",ze,"Term "+m(u+1),1),t("button",{class:"trash-icon",onClick:l=>i.removeTerm(u),title:"Remove term",type:"button"}," âœ• ",8,$e)]),t("div",Je,[t("div",Qe,[e[22]||(e[22]=t("label",{class:"form-label"},"Term Name",-1)),_(t("input",{type:"text","onUpdate:modelValue":l=>o.name=l,class:"input",placeholder:`e.g., Spring ${u+1}`,onInput:l=>i.updateTermField(u,"name",l.target.value)},null,40,Ze),[[k,o.name]])]),t("div",Xe,[t("div",et,[e[23]||(e[23]=t("label",{class:"form-label"},"Start Date",-1)),_(t("input",{type:"date","onUpdate:modelValue":l=>o.startDate=l,class:"input",onInput:l=>i.updateTermField(u,"startDate",l.target.value)},null,40,tt),[[k,o.startDate]])]),t("div",st,[e[24]||(e[24]=t("label",{class:"form-label"},"End Date",-1)),_(t("input",{type:"date","onUpdate:modelValue":l=>o.endDate=l,class:"input",onInput:l=>i.updateTermField(u,"endDate",l.target.value)},null,40,ot),[[k,o.endDate]])])])])]))),128))]),t("div",it,[t("button",{class:"primary-button",onClick:e[14]||(e[14]=(...o)=>i.addTerm&&i.addTerm(...o)),type:"button"},e[25]||(e[25]=[t("span",{class:"button-content"},[t("span",{class:"icon"},"+"),D(" Add Term ")],-1)]))])])}const nt=O(De,[["render",rt],["__scopeId","data-v-49e5e63d"]]),at={props:{values:Object,previousDataList:Array},emits:["update-field","use-previous-data"],setup(s,{emit:e}){const n=w(null),r=w(s.values.dontCreateClasses||!1),a=w(!1),i=w(""),o=H({url:"school.al_ummah.api3.get_previous_data",params:{values:{}},onSuccess:p=>{console.log("Previous data loaded successfully")},onError:p=>{console.error("Error fetching previous data:",p)}}),u=()=>{if(!n.value){console.warn("No data selected");return}e("use-previous-data",n.value),i.value=n.value.academicYear,a.value=!0,setTimeout(()=>{a.value=!1},5e3)},l=()=>{e("update-field",{field:"dontCreateClasses",value:r.value})};return re(()=>{(!s.previousDataList||s.previousDataList.length===0)&&o.reload()}),{selectedPreviousData:n,dontCreateClasses:r,showSuccessMessage:a,usedPreviousYear:i,previousDataResource:o,handleUsePreviousData:u,updateDontCreateClasses:l}}},lt={class:"card"},ut={key:0,class:"loading"},dt={key:1},ct={key:0,class:"success-message"},mt={class:"field"},gt=["value"],pt=["disabled"];function ht(s,e,n,r,a,i){return d(),c("div",lt,[r.previousDataResource.loading?(d(),c("div",ut,"Loading previous data...")):(d(),c("div",dt,[r.showSuccessMessage?(d(),c("div",ct," âœ“ Previous data from "+m(r.usedPreviousYear)+" has been successfully loaded ",1)):v("",!0),t("div",mt,[_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.selectedPreviousData=o)},[e[2]||(e[2]=t("option",{value:null},"Select a year",-1)),(d(!0),c(S,null,C(n.previousDataList,(o,u)=>(d(),c("option",{key:u,value:o},m(o.academicYear),9,gt))),128))],512),[[X,r.selectedPreviousData]])]),t("button",{onClick:e[1]||(e[1]=(...o)=>r.handleUsePreviousData&&r.handleUsePreviousData(...o)),disabled:!r.selectedPreviousData}," Use Previous Data ",8,pt)]))])}const ft=O(at,[["render",ht],["__scopeId","data-v-6de0caab"]]),Z={school:["Nursery","Jr KG","Sr KG","1st","2nd","3rd","4th","5th","6th","7th","8th","9th","10th"],college:["FY BSc-CS","SY BSc-CS","TY BSc-CS","Final Year BSc-CS","FY BCA","SY BCA","TY BCA","Final Year BCA","FY BSc-IT","SY BSc-IT","TY BSc-IT","Final Year BSc-IT","FY BBA","SY BBA","TY BBA","Final Year BBA","FY BCom","SY BCom","TY BCom","Final Year BCom","FY MSc-CS","SY MSc-CS","FY MBA","SY MBA","FY MCom","SY MCom"]},vt={"FY BSc-CS":["Programming in C","Discrete Mathematics","Computer Architecture","Operating Systems Basics","Digital Electronics"],"SY BSc-CS":["Data Structures","DBMS","Computer Networks","Web Technologies","Java Programming"],"TY BSc-CS":["Software Engineering","Computer Graphics","Information Security","Distributed Systems","Elective â€“ AI / ML / IoT"],"Final Year BSc-CS":["Cloud Computing","Advanced Algorithms","Data Warehousing & Mining","Project Work","Seminar"],"FY BCA":["Fundamentals of IT","Mathematics","C Programming","Business Communication","PC Software"],"SY BCA":["Data Structures","DBMS","Operating Systems","OOP with C++","Networking"],"TY BCA":["Web Development","Software Engineering","Java Programming","Computer Security","Mini Project"],"Final Year BCA":["Cloud Computing","Mobile App Development","Advanced Web Tech","Major Project","Internship"],"FY BSc-IT":["Basic Electronics","C Programming","Mathematics","IT Fundamentals","Web Design"],"SY BSc-IT":["OOP Java","DBMS","Networks","OS Concepts","Statistics"],"TY BSc-IT":["Software Engineering","Internet of Things","Cloud Computing","Cyber Security","Mini Project"],"Final Year BSc-IT":["Big Data","Advanced Security","Mobile Computing","Project Work","Seminar"],"FY BBA":["Business Management","Microeconomics","Business Mathematics","Marketing Principles","Communication Skills"],"SY BBA":["Human Resource Management","Finance Management","Organizational Behavior","Business Law","Operations Management"],"TY BBA":["International Business","Entrepreneurship","Research Methodology","Strategic Management","Taxation"],"Final Year BBA":["Project Work","Advanced HRM / Marketing / Finance","Business Ethics","Corporate Governance","Internship"],"FY BCom":["Financial Accounting","Business Economics","Mathematics & Statistics","Commerce","Business Communication"],"SY BCom":["Corporate Accounting","Cost Accounting","Business Law","Banking & Finance","Marketing"],"TY BCom":["Auditing","Taxation","Financial Management","E-Commerce","Business Environment"],"Final Year BCom":["Advanced Accounting","Corporate Finance","Research Project","GST & Auditing","Entrepreneurship"],"FY MSc-CS":["Advanced Algorithms","Advanced DBMS","Machine Learning Basics","Data Science with Python","Research Methodology"],"SY MSc-CS":["Deep Learning","Distributed Computing","Big Data Analytics","Cyber Security","Thesis"],"FY MBA":["Principles of Management","Managerial Economics","Accounting for Managers","Marketing Management","Organizational Behavior"],"SY MBA":["Financial Management","Business Analytics","Operations Research","Strategic Management","Major Project / Internship"],"FY MCom":["Managerial Accounting","Advanced Economics","Corporate Finance","Taxation Laws","Research Methods"],"SY MCom":["Advanced Auditing","International Finance","Business Analytics","Corporate Governance","Thesis / Project"]},bt={props:{values:Object},data(){return{isUpdatingClasses:!1,commonSubjectsList:[],commonDivisionsList:[],newCommonSubject:"",newCommonDivision:"",classesWithText:[],collegeProgramsSubjects:vt,programRefs:{},inputRefs:{},quickSelectDivisions:["A","B","C","D","E","F","G","H"],commonSubjects:["Math","Social Studies","Science","English","History","Geography","Physics","Chemistry","Biology","Computer","Civics","Hindi","Marathi","Arabic","Play"]}},computed:{institutionType:{get(){return this.values.selectedInstitution||"school"},set(s){this.updateField("selectedInstitution",s)}},allSingleGroup(){return this.classesWithText.length>0&&this.classesWithText.every(s=>s.isSingleGroup)},mappedProgramNames(){return Object.keys(this.collegeProgramsSubjects)}},watch:{"values.selectedInstitution":{immediate:!0,handler(s){s||this.updateField("selectedInstitution","school")}},"values.commonDivisions":{immediate:!0,handler(s){this.isUpdatingClasses||s&&s.length>0&&(this.commonDivisionsList=[...s],this.values.classes&&this.values.classes.length>0&&this.initializeClassesWithText(this.values.classes))}},"values.commonSubjects":{immediate:!0,handler(s){this.isUpdatingClasses||s&&s.length>0&&(this.commonSubjectsList=[...s],this.values.classes&&this.values.classes.length>0&&this.initializeClassesWithText(this.values.classes))}},"values.classes":{immediate:!0,deep:!0,handler(s){this.isUpdatingClasses||this.initializeClassesWithText(s)}},commonSubjectsList:{handler(s){this.$emit("update-field",{field:"commonSubjects",value:s}),this.updateAllClassesWithCommonData()},deep:!0},commonDivisionsList:{handler(s){this.$emit("update-field",{field:"commonDivisions",value:s}),this.updateAllClassesWithCommonData()},deep:!0}},created(){this.values.selectedInstitution||this.updateField("selectedInstitution","school"),this.values.commonSubjects&&this.values.commonSubjects.length>0?this.commonSubjectsList=[...this.values.commonSubjects]:this.commonSubjectsList=[],this.values.commonDivisions&&this.values.commonDivisions.length>0?this.commonDivisionsList=[...this.values.commonDivisions]:this.commonDivisionsList=[],this.values.classes&&this.values.classes.length>0&&this.initializeClassesWithText(this.values.classes)},mounted(){this.classesWithText.length===0&&!this.hasPreviousData()&&this.autoPopulatePrograms()},methods:{generateUniqueId(){return Math.random().toString(36).substr(2,9)+Date.now().toString(36)},updateField(s,e){this.$emit("update-field",{field:s,value:e})},classesMatchInstitutionType(){if(!this.classesWithText||this.classesWithText.length===0)return!1;const s=this.classesWithText.map(r=>r.className),e=Z[this.institutionType]||[];return s.some(r=>e.includes(r))},forceRefreshDisplay(){this.values.classes&&this.values.classes.length>0&&this.initializeClassesWithText(this.values.classes)},hasPreviousData(){return this.classesWithText.length===0?!this.values.classes||this.values.classes.length===0?!1:this.values.classes.some(e=>this.institutionType==="school"?Z.school.includes(e.className):this.institutionType==="college"?Z.college.includes(e.className):!1):!1},setInstitutionType(s){this.institutionType=s,this.classesWithText=[],this.$emit("update-field-array",{field:"classes",value:[]}),this.$nextTick(()=>{this.autoPopulatePrograms(),setTimeout(()=>{this.forceRefreshDisplay()},200)})},addCommonSubject(){this.newCommonSubject.trim()&&!this.commonSubjectsList.includes(this.newCommonSubject.trim())&&(this.commonSubjectsList.push(this.newCommonSubject.trim()),this.newCommonSubject="")},removeCommonSubject(s){this.commonSubjectsList.splice(s,1)},isCommonSubjectSelected(s){return this.commonSubjectsList.includes(s)},toggleCommonSubject(s){this.isCommonSubjectSelected(s)?this.removeCommonSubject(this.commonSubjectsList.indexOf(s)):(this.newCommonSubject=s,this.addCommonSubject())},addCommonDivision(){this.newCommonDivision.trim()&&!this.commonDivisionsList.includes(this.newCommonDivision.trim())&&(this.commonDivisionsList.push(this.newCommonDivision.trim()),this.newCommonDivision="")},removeCommonDivision(s){this.commonDivisionsList.splice(s,1)},isCommonDivisionSelected(s){return this.commonDivisionsList.includes(s)},toggleCommonDivision(s){this.isCommonDivisionSelected(s)?this.removeCommonDivision(this.commonDivisionsList.indexOf(s)):(this.newCommonDivision=s,this.addCommonDivision())},hasMappedSubjects(s){return this.mappedProgramNames.includes(s)},getMappedSubjects(s){return this.collegeProgramsSubjects[s]||[]},initializeClassesWithText(s){if(!s||s.length===0){this.classesWithText=[];return}this.classesWithText=s.map((e,n)=>{let r=[];return e.divisions&&e.divisions.length>0&&(r=e.divisions.filter(i=>{var p;let o="";typeof i=="object"&&i.divisionName?o=i.divisionName.split("-").slice(1).join("-"):typeof i=="string"&&(o=i.includes("-")?i.split("-").slice(1).join("-"):i);const u=this.commonDivisionsList.includes(o),l=(p=e.excludedCommonDivisions)==null?void 0:p.includes(o);return!(u&&!l)}).map(i=>typeof i=="object"&&i.divisionName?{divisionName:i.divisionName}:typeof i=="string"?{divisionName:i.includes("-")?i:`${e.className}-${i}`}:{divisionName:String(i)})),G(L({},e),{uniqueId:e.uniqueId||this.generateUniqueId(),subjectsText:"",divisionsText:"",specificSubjects:e.subjects?e.subjects.filter(i=>!this.commonSubjectsList.includes(i)):[],specificDivisions:r,isSingleGroup:e.isSingleGroup||!1,excludedCommonSubjects:e.excludedCommonSubjects||[],excludedCommonDivisions:e.excludedCommonDivisions||[]})})},getDivisionDisplayName(s,e){var r;if(console.log("ðŸ” getDivisionDisplayName called with:",s,`for class ${e}`),this.institutionType==="college"){if(typeof s=="object"&&s.divisionName){const a=s.divisionName.split("-");if(console.log("   ðŸ“¦ College object division parts:",a),a.length>1&&this.commonDivisionsList.includes(a[a.length-1])){const o=a[a.length-1];return console.log(`   âœ… Common division, returning: ${o}`),o}if(a.length>1&&((r=this.classesWithText[e])==null?void 0:r.className)&&s.divisionName.startsWith(this.classesWithText[e].className+"-")){const o=a[a.length-1];return console.log(`   âœ… Common division with prefix, returning: ${o}`),o}else return console.log(`   âœ… Custom division, returning: ${s.divisionName}`),s.divisionName}if(typeof s=="string"){const a=s.split("-");if(console.log("   ðŸ“¦ College string division parts:",a),a.length>1&&this.commonDivisionsList.includes(a[a.length-1])){const i=a[a.length-1];return console.log(`   âœ… Common string division, returning: ${i}`),i}return console.log(`   âœ… Custom string division, returning: ${s}`),s}}else{if(typeof s=="object"&&s.divisionName){const a=s.divisionName.split("-").slice(1).join("-");return console.log(`   ðŸ« School object division, returning: ${a}`),a||s.divisionName}if(typeof s=="string"){if(s.includes("-")){const a=s.split("-").slice(1).join("-");return console.log(`   ðŸ« School string division with dash, returning: ${a}`),a}return console.log(`   ðŸ« School string division without dash, returning: ${s}`),s}}const n=String(s);return console.log(`   â“ Fallback division, returning: ${n}`),n},addNewProgram(){const s={uniqueId:this.generateUniqueId(),className:"",subjects:[],divisions:[],specificSubjects:[],specificDivisions:[],isSingleGroup:!1,excludedCommonSubjects:[],excludedCommonDivisions:[]},e=[...this.classesWithText,s];this.emitUpdatedClasses(e),this.$nextTick(()=>{const n=this.inputRefs[s.uniqueId],r=this.programRefs[s.uniqueId];n&&n.focus(),r&&r.scrollIntoView({behavior:"smooth",block:"center"})})},removeProgram(s){const e=this.classesWithText.filter((n,r)=>r!==s);this.emitUpdatedClasses(e)},autoPopulatePrograms(){const s=Z[this.institutionType]||[];if(s.length===0)return;const e=s.map(n=>({uniqueId:this.generateUniqueId(),className:n,subjects:[],divisions:[],specificSubjects:[],specificDivisions:[],isSingleGroup:!1,excludedCommonSubjects:[],excludedCommonDivisions:[]}));this.classesWithText=e,this.emitUpdatedClasses(e,!0)},toggleAllSingleGroup(){const s=!this.allSingleGroup,e=this.classesWithText.map(n=>G(L({},n),{isSingleGroup:s}));this.emitUpdatedClasses(e)},handleSingleGroupChange(s){const e=[...this.classesWithText];e[s].isSingleGroup&&(e[s].specificDivisions=[],e[s].excludedCommonDivisions=[],e[s].divisionsText=""),this.emitUpdatedClasses(e)},addSpecificSubject(s){if(this.classesWithText[s].subjectsText.trim()){const e=[...this.classesWithText],n=this.classesWithText[s].subjectsText.trim();e[s].specificSubjects.includes(n)||e[s].specificSubjects.push(n),e[s].subjectsText="",this.emitUpdatedClasses(e)}},addProgramSubject(s,e){const n=[...this.classesWithText];n[s].specificSubjects.includes(e)||(n[s].specificSubjects.push(e),this.emitUpdatedClasses(n))},addAllMappedSubjects(s,e){const n=[...this.classesWithText];this.getMappedSubjects(e).forEach(a=>{n[s].specificSubjects.includes(a)||n[s].specificSubjects.push(a)}),this.emitUpdatedClasses(n)},removeSpecificSubject(s,e){const n=[...this.classesWithText];n[s].specificSubjects.splice(e,1),this.emitUpdatedClasses(n)},addSpecificDivision(s){if(this.classesWithText[s].divisionsText.trim()&&!this.classesWithText[s].isSingleGroup){const e=[...this.classesWithText],n=this.classesWithText[s].divisionsText.trim(),r=e[s].className||"Class",a=this.institutionType==="college"?n:`${r}-${n}`,i=e[s].specificDivisions.some(u=>this.getDivisionDisplayName(u,s)===n),o=this.commonDivisionsList.includes(n);!i&&!o&&e[s].specificDivisions.push({divisionName:a}),e[s].divisionsText="",this.emitUpdatedClasses(e)}},removeSpecificDivision(s,e){const n=[...this.classesWithText];n[s].specificDivisions.splice(e,1),this.emitUpdatedClasses(n)},updateClassName(s,e){const n=[...this.classesWithText],r=n[s].className;n[s].className=e,n[s].specificDivisions&&this.institutionType==="school"&&(n[s].specificDivisions=n[s].specificDivisions.map(a=>{if(typeof a=="object"&&a.divisionName&&a.divisionName.includes("-")){const i=a.divisionName.replace(`${r}-`,"");return{divisionName:`${e}-${i}`}}return a})),this.emitUpdatedClasses(n)},updateAllClassesWithCommonData(){const s=this.classesWithText.map(e=>G(L({},e),{specificSubjects:e.specificSubjects||[],specificDivisions:e.specificDivisions||[],excludedCommonSubjects:e.excludedCommonSubjects||[],excludedCommonDivisions:e.excludedCommonDivisions||[]}));this.emitUpdatedClasses(s)},isCommonSubjectExcluded(s,e){var r;return((r=this.classesWithText[s].excludedCommonSubjects)==null?void 0:r.includes(e))||!1},toggleExcludeCommonSubject(s,e){const n=[...this.classesWithText];n[s].excludedCommonSubjects||(n[s].excludedCommonSubjects=[]);const r=n[s].excludedCommonSubjects.indexOf(e);r>=0?n[s].excludedCommonSubjects.splice(r,1):n[s].excludedCommonSubjects.push(e),this.emitUpdatedClasses(n)},isCommonDivisionExcluded(s,e){var r;return((r=this.classesWithText[s].excludedCommonDivisions)==null?void 0:r.includes(e))||!1},toggleExcludeCommonDivision(s,e){const n=[...this.classesWithText];n[s].excludedCommonDivisions||(n[s].excludedCommonDivisions=[]);const r=n[s].excludedCommonDivisions.indexOf(e);r>=0?n[s].excludedCommonDivisions.splice(r,1):n[s].excludedCommonDivisions.push(e),this.emitUpdatedClasses(n)},emitUpdatedClasses(s,e=!1){if(this.isUpdatingClasses&&!e)return;this.isUpdatingClasses=!0;const n=s.map(r=>{if(r.isSingleGroup&&this.institutionType==="college")return{uniqueId:r.uniqueId,className:r.className,subjects:r.specificSubjects||[],divisions:[r.className],isSingleGroup:r.isSingleGroup,excludedCommonSubjects:[],excludedCommonDivisions:[],specificSubjects:r.specificSubjects||[],specificDivisions:[]};{const a=this.commonDivisionsList.filter(u=>{var l;return!((l=r.excludedCommonDivisions)!=null&&l.includes(u))}).map(u=>this.institutionType==="college"?{divisionName:`${r.className}-${u}`}:{divisionName:`${r.className}-${u}`}),i=(r.specificDivisions||[]).map(u=>typeof u=="string"?{divisionName:u}:u),o=[...a,...i];return{uniqueId:r.uniqueId,className:r.className,subjects:[...this.commonSubjectsList.filter(u=>{var l;return!((l=r.excludedCommonSubjects)!=null&&l.includes(u))}),...r.specificSubjects||[]],divisions:o,isSingleGroup:r.isSingleGroup,excludedCommonSubjects:r.excludedCommonSubjects||[],excludedCommonDivisions:r.excludedCommonDivisions||[],specificSubjects:r.specificSubjects||[],specificDivisions:r.specificDivisions||[]}}});this.$emit("update-field-array",{field:"classes",value:n}),this.classesWithText=s,setTimeout(()=>{this.isUpdatingClasses=!1},100)}}},yt={class:"bg-white shadow rounded-lg p-6 space-y-6"},St={class:"mb-6"},Ct={class:"flex space-x-4"},xt={key:0},_t={class:"flex flex-wrap items-center gap-2 p-2 border border-gray-300 rounded-md min-h-[42px]"},wt=["onClick"],kt={class:"quick-select mt-3"},Tt={class:"subject-grid grid grid-cols-3 gap-2"},Dt=["onClick"],At={class:"block text-sm font-medium text-gray-700 mb-1"},jt={class:"flex flex-wrap items-center gap-2 p-2 border border-gray-300 rounded-md min-h-[42px]"},Nt=["onClick"],Mt=["placeholder"],Ft={class:"quick-select mt-3"},Pt={class:"text-sm font-medium text-gray-700 mb-2"},Bt={class:"division-grid grid grid-cols-6 gap-2"},Et=["onClick"],Lt={class:"flex justify-between items-center mb-4"},Ot={class:"text-lg font-semibold text-gray-800"},It={key:1,class:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200"},Ut={class:"flex items-center gap-3 text-sm font-medium text-gray-700 cursor-pointer"},Yt={class:"relative"},Gt=["checked"],qt={key:0,class:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Vt={class:"overflow-x-auto"},Wt={class:"min-w-full text-sm text-left text-gray-700"},Rt={class:"bg-gray-100"},Ht={class:"px-4 py-2 font-medium"},Kt={class:"px-4 py-2 font-medium"},zt={class:"px-4 py-2 font-medium"},$t={class:"px-4 py-2"},Jt={class:"px-4 py-2"},Qt=["onUpdate:modelValue","onInput","placeholder"],Zt={class:"px-4 py-2 w-[300px]"},Xt={class:"flex flex-wrap gap-1 mb-1 min-h-[40px]"},es=["onClick"],ts=["onClick"],ss={class:"flex gap-2"},os=["onUpdate:modelValue","onKeydown","placeholder"],is=["onClick"],rs={key:0,class:"mt-2"},ns={class:"flex flex-wrap gap-1"},as=["onClick","disabled"],ls=["onClick"],us={class:"px-4 py-2"},ds={key:0,class:"mb-2"},cs={class:"flex items-center gap-2 text-xs text-gray-700 cursor-pointer"},ms={class:"relative"},gs=["onUpdate:modelValue","onChange"],ps={key:0,class:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},hs={class:"flex flex-wrap gap-1 mb-1 min-h-[40px]"},fs={key:0,class:"inline-flex items-center px-2 py-1 rounded-full bg-gray-200 text-gray-700 text-xs border border-gray-300 cursor-not-allowed"},vs=["onClick"],bs=["onClick"],ys={key:1,class:"flex gap-2"},Ss=["onUpdate:modelValue","onKeydown","placeholder"],Cs=["onClick"],xs={key:2,class:"mt-1"},_s={class:"px-4 py-2"},ws=["onClick"],ks={key:2,class:"text-center py-8 text-gray-500"};function Ts(s,e,n,r,a,i){return d(),c("div",yt,[t("div",St,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Institution Type",-1)),t("div",Ct,[t("button",{onClick:e[0]||(e[0]=o=>i.setInstitutionType("school")),class:T(["px-4 py-2 rounded-md transition-colors",i.institutionType==="school"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," ðŸ« School ",2),t("button",{onClick:e[1]||(e[1]=o=>i.setInstitutionType("college")),class:T(["px-4 py-2 rounded-md transition-colors",i.institutionType==="college"?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," ðŸŽ“ College ",2)])]),i.institutionType==="school"?(d(),c("div",xt,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Common Subjects for All Classes ",-1)),t("div",_t,[(d(!0),c(S,null,C(a.commonSubjectsList,(o,u)=>(d(),c("span",{key:u,class:"inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm"},[D(m(o)+" ",1),t("button",{onClick:l=>i.removeCommonSubject(u),class:"ml-1.5 text-blue-500 hover:text-blue-700"}," Ã— ",8,wt)]))),128)),_(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=o=>a.newCommonSubject=o),onKeydown:e[3]||(e[3]=E((...o)=>i.addCommonSubject&&i.addCommonSubject(...o),["enter"])),onBlur:e[4]||(e[4]=(...o)=>i.addCommonSubject&&i.addCommonSubject(...o)),placeholder:"Add subjects...",class:"flex-1 min-w-[100px] px-2 py-1 border-0 focus:ring-0 focus:outline-none"},null,544),[[k,a.newCommonSubject]])]),t("div",kt,[e[12]||(e[12]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Quick Select Subjects",-1)),t("div",Tt,[(d(!0),c(S,null,C(a.commonSubjects,o=>(d(),c("div",{key:o,class:T(["subject-card px-3 py-2 border rounded-md text-center cursor-pointer text-sm",{"bg-blue-100 border-blue-300":i.isCommonSubjectSelected(o),"bg-gray-50 hover:bg-gray-100":!i.isCommonSubjectSelected(o)}]),onClick:u=>i.toggleCommonSubject(o)},m(o),11,Dt))),128))])])])):v("",!0),t("div",null,[t("label",At,m(i.institutionType==="college"?"Common Student Groups for All Programs":"Common Divisions for All Classes"),1),t("div",jt,[(d(!0),c(S,null,C(a.commonDivisionsList,(o,u)=>(d(),c("span",{key:u,class:"inline-flex items-center px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm"},[D(m(o)+" ",1),t("button",{onClick:l=>i.removeCommonDivision(u),class:"ml-1.5 text-green-500 hover:text-green-700"}," Ã— ",8,Nt)]))),128)),_(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>a.newCommonDivision=o),onKeydown:e[6]||(e[6]=E((...o)=>i.addCommonDivision&&i.addCommonDivision(...o),["enter"])),onBlur:e[7]||(e[7]=(...o)=>i.addCommonDivision&&i.addCommonDivision(...o)),placeholder:i.institutionType==="college"?"Add common groups...":"Add common divisions...",class:"flex-1 min-w-[100px] px-2 py-1 border-0 focus:ring-0 focus:outline-none"},null,40,Mt),[[k,a.newCommonDivision]])]),t("div",Ft,[t("h3",Pt,m(i.institutionType==="college"?"Quick Select Common Groups":"Quick Select Common Divisions"),1),t("div",Bt,[(d(!0),c(S,null,C(a.quickSelectDivisions,o=>(d(),c("div",{key:o,class:T(["division-card px-3 py-2 border rounded-md text-center cursor-pointer text-sm",{"bg-green-100 border-green-300":i.isCommonDivisionSelected(o),"bg-gray-50 hover:bg-gray-100":!i.isCommonDivisionSelected(o)}]),onClick:u=>i.toggleCommonDivision(o)},m(o),11,Et))),128))])])]),t("div",Lt,[t("h3",Ot,m(i.institutionType==="college"?"Programs Overview":"Classes Overview"),1),t("button",{onClick:e[8]||(e[8]=(...o)=>i.addNewProgram&&i.addNewProgram(...o)),class:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors flex items-center gap-2"},[e[14]||(e[14]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)),D(" Add "+m(i.institutionType==="college"?"Program":"Class"),1)])]),i.institutionType==="college"?(d(),c("div",It,[t("label",Ut,[t("div",Yt,[t("input",{type:"checkbox",checked:i.allSingleGroup,onChange:e[9]||(e[9]=(...o)=>i.toggleAllSingleGroup&&i.toggleAllSingleGroup(...o)),class:"sr-only"},null,40,Gt),t("div",{class:T(["w-5 h-5 border-2 border-blue-500 rounded transition-all duration-200 flex items-center justify-center",i.allSingleGroup?"bg-blue-500 border-blue-500":"bg-white border-gray-300"])},[i.allSingleGroup?(d(),c("svg",qt,e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)]))):v("",!0)],2)]),e[16]||(e[16]=t("span",{class:"text-blue-800"},"Select All - Single Student Group (Uses Program Name)",-1))])])):v("",!0),t("div",Vt,[t("table",Wt,[t("thead",Rt,[t("tr",null,[e[17]||(e[17]=t("th",{class:"px-4 py-2 font-medium"},"#",-1)),t("th",Ht,m(i.institutionType==="college"?"Program Name":"Class Name"),1),t("th",Kt,m(i.institutionType==="college"?"Courses":"Subjects"),1),t("th",zt,m(i.institutionType==="college"?"Student Groups":"Divisions"),1),e[18]||(e[18]=t("th",{class:"px-4 py-2 font-medium"},"Actions",-1))])]),t("tbody",null,[(d(!0),c(S,null,C(a.classesWithText,(o,u)=>(d(),c("tr",{key:o.uniqueId,ref_for:!0,ref:l=>{a.programRefs[o.uniqueId]=l},class:"border-t hover:bg-gray-50"},[t("td",$t,m(u+1),1),t("td",Jt,[_(t("input",{type:"text","onUpdate:modelValue":l=>o.className=l,onInput:l=>i.updateClassName(u,l.target.value),ref_for:!0,ref:l=>{a.inputRefs[o.uniqueId]=l},class:"w-full px-3 py-2 border border-gray-300 rounded-md",placeholder:i.institutionType==="college"?"Program name...":"Class name..."},null,40,Qt),[[k,o.className]])]),t("td",Zt,[t("div",Xt,[i.institutionType==="school"?(d(!0),c(S,{key:0},C(a.commonSubjectsList,(l,p)=>(d(),c("span",{key:"common-"+p,class:T(["inline-flex items-center px-2 py-1 rounded-full text-xs",i.isCommonSubjectExcluded(u,l)?"bg-red-100 text-red-600":"bg-blue-50 text-blue-600"])},[D(m(l)+" ",1),t("button",{onClick:ie(b=>i.toggleExcludeCommonSubject(u,l),["stop"]),class:"ml-1 text-blue-500 hover:text-blue-700 text-xs"},m(i.isCommonSubjectExcluded(u,l)?"+":"Ã—"),9,es)],2))),128)):v("",!0),(d(!0),c(S,null,C(o.specificSubjects,(l,p)=>(d(),c("span",{key:"specific-"+p,class:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-800 text-xs"},[D(m(l)+" ",1),t("button",{onClick:b=>i.removeSpecificSubject(u,p),class:"ml-1 text-blue-500 hover:text-blue-700 text-xs"}," Ã— ",8,ts)]))),128))]),t("div",ss,[_(t("input",{type:"text","onUpdate:modelValue":l=>o.subjectsText=l,onKeydown:E(l=>i.addSpecificSubject(u),["enter"]),placeholder:i.institutionType==="college"?"Add course...":"Add subject...",class:"flex-1 px-2 py-1 border border-gray-300 rounded text-xs"},null,40,os),[[k,o.subjectsText]]),t("button",{onClick:l=>i.addSpecificSubject(u),class:"px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-xs"}," Add ",8,is)]),i.institutionType==="college"&&i.hasMappedSubjects(o.className)?(d(),c("div",rs,[t("div",ns,[(d(!0),c(S,null,C(i.getMappedSubjects(o.className),l=>(d(),c("button",{key:l,onClick:p=>i.addProgramSubject(u,l),disabled:o.specificSubjects.includes(l),class:T(["px-2 py-1 text-xs rounded border transition-colors",o.specificSubjects.includes(l)?"bg-blue-500 text-white border-blue-500 cursor-not-allowed":"bg-gray-100 hover:bg-gray-200 border-gray-300"])},m(o.specificSubjects.includes(l)?"âœ“ ":"+ ")+m(l),11,as))),128))]),i.hasMappedSubjects(o.className)&&i.getMappedSubjects(o.className).some(l=>!o.specificSubjects.includes(l))?(d(),c("button",{key:0,onClick:l=>i.addAllMappedSubjects(u,o.className),class:"mt-1 px-2 py-1 text-xs bg-green-500 text-white rounded hover:bg-green-600 transition-colors"}," Add All Subjects for "+m(o.className),9,ls)):v("",!0)])):v("",!0)]),t("td",us,[i.institutionType==="college"?(d(),c("div",ds,[t("label",cs,[t("div",ms,[_(t("input",{type:"checkbox","onUpdate:modelValue":l=>o.isSingleGroup=l,onChange:l=>i.handleSingleGroupChange(u),class:"sr-only"},null,40,gs),[[ue,o.isSingleGroup]]),t("div",{class:T(["w-4 h-4 border-2 border-blue-500 rounded transition-all duration-200 flex items-center justify-center",o.isSingleGroup?"bg-blue-500 border-blue-500":"bg-white border-gray-300"])},[o.isSingleGroup?(d(),c("svg",ps,e[19]||(e[19]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)]))):v("",!0)],2)]),e[20]||(e[20]=D(" Single Student Group "))])])):v("",!0),t("div",hs,[o.isSingleGroup&&i.institutionType==="college"?(d(),c("span",fs,[D(m(o.className)+" ",1),e[21]||(e[21]=t("span",{class:"ml-1 text-gray-500 text-xs"},"(Auto)",-1))])):v("",!0),o.isSingleGroup?v("",!0):(d(!0),c(S,{key:1},C(a.commonDivisionsList,(l,p)=>(d(),c("span",{key:"common-"+p,class:T(["inline-flex items-center px-2 py-1 rounded-full text-xs",i.isCommonDivisionExcluded(u,l)?"bg-red-100 text-red-600 border border-red-300":"bg-green-50 text-green-600"])},[D(m(l)+" ",1),t("button",{onClick:ie(b=>i.toggleExcludeCommonDivision(u,l),["stop"]),class:"ml-1 text-green-500 hover:text-green-700 text-xs"},m(i.isCommonDivisionExcluded(u,l)?"+":"Ã—"),9,vs)],2))),128)),o.isSingleGroup?v("",!0):(d(!0),c(S,{key:2},C(o.specificDivisions,(l,p)=>(d(),c("span",{key:"specific-"+p,class:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-800 text-xs"},[D(m(i.getDivisionDisplayName(l,u))+" ",1),t("button",{onClick:b=>i.removeSpecificDivision(u,p),class:"ml-1 text-green-500 hover:text-green-700 text-xs"}," Ã— ",8,bs)]))),128))]),o.isSingleGroup?v("",!0):(d(),c("div",ys,[_(t("input",{type:"text","onUpdate:modelValue":l=>o.divisionsText=l,onKeydown:E(l=>i.addSpecificDivision(u),["enter"]),placeholder:i.institutionType==="college"?"Add custom group...":"Add custom division...",class:"flex-1 px-2 py-1 border border-gray-300 rounded text-xs"},null,40,Ss),[[k,o.divisionsText]]),t("button",{onClick:l=>i.addSpecificDivision(u),class:"px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600 text-xs"}," Add ",8,Cs)])),o.isSingleGroup&&i.institutionType==="college"?(d(),c("div",xs,e[22]||(e[22]=[t("p",{class:"text-xs text-gray-500 italic"}," Student group is automatically set to program name and cannot be modified. ",-1)]))):v("",!0)]),t("td",_s,[t("button",{onClick:l=>i.removeProgram(u),class:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors",title:"Remove Program"},e[23]||(e[23]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,ws)])]))),128))])])]),a.classesWithText.length===0?(d(),c("div",ks,[t("p",null,"No "+m(i.institutionType==="college"?"programs":"classes")+" added yet.",1),t("button",{onClick:e[10]||(e[10]=(...o)=>i.addNewProgram&&i.addNewProgram(...o)),class:"mt-2 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors"}," Add Your First "+m(i.institutionType==="college"?"Program":"Class"),1)])):v("",!0)])}const Ds=O(bt,[["render",Ts],["__scopeId","data-v-49e44015"]]),As={name:"GradingSystem",emits:["update-field","grading-completed"],props:{values:{type:Object,required:!0}},setup(s,{emit:e}){var M,A,P,B;const n=w(((M=s.values.gradingSystem)==null?void 0:M.selectedOption)||""),r=w(((A=s.values.gradingSystem)==null?void 0:A.scaleName)||""),a=w(((P=s.values.gradingSystem)==null?void 0:P.previousScaleName)||""),i=w(((B=s.values.gradingSystem)==null?void 0:B.gradeData)||[{grade_code:"",threshold:"",description:""}]),o=w([]),u=w(null),l=w(!1),p=w(!1);let b=null;const j=W(()=>s.values.selectedInstitution||"school"),N=H({url:"school.al_ummah.api3.fetch_grading_scales",onSuccess:f=>{if(f.success&&(o.value=f.grading_scales||[],a.value)){const y=o.value.find(Y=>Y.name===a.value);y&&(u.value=y)}l.value=!1},onError:f=>{console.error("Error fetching grading scales:",f),l.value=!1}}),I=w([{value:"school",label:"School",description:"Comprehensive grading system suitable for K-12 schools",grades:[{grade_code:"A+",threshold:95,description:"Outstanding"},{grade_code:"A",threshold:90,description:"Excellent"},{grade_code:"B+",threshold:85,description:"Very Good"},{grade_code:"B",threshold:80,description:"Good"},{grade_code:"C+",threshold:75,description:"Above Average"},{grade_code:"C",threshold:70,description:"Average"},{grade_code:"D",threshold:60,description:"Below Average"},{grade_code:"F",threshold:0,description:"Fail"}]},{value:"college",label:"College/University",description:"Standard grading system for higher education",grades:[{grade_code:"A",threshold:90,description:"Excellent"},{grade_code:"B",threshold:80,description:"Good"},{grade_code:"C",threshold:70,description:"Satisfactory"},{grade_code:"D",threshold:60,description:"Pass"},{grade_code:"F",threshold:0,description:"Fail"}]}]),ee=W(()=>I.value),K=f=>f.value===j.value,V=W(()=>i.value.length>0&&i.value.every(f=>{var y;return((y=f.grade_code)==null?void 0:y.trim())&&U(f.threshold)})),te=W(()=>!r.value||!V.value),z=W(()=>{var f;return n.value==="previous"?!!a.value:n.value==="manual"?((f=r.value)==null?void 0:f.trim())&&V.value:!0});function se(){l.value=!0,N.fetch()}function oe(f){if(n.value=f,f==="manual"&&(u.value=null,i.value.length===1&&!i.value[0].grade_code)){const y=I.value.find(Y=>Y.value===j.value);y&&q(y)}x()}function $(){if(a.value){const f=o.value.find(y=>y.name===a.value);u.value=f||null}else u.value=null;x()}function q(f){i.value=JSON.parse(JSON.stringify(f.grades)),r.value||(r.value=`${f.label} Grading Scale`),x()}function J(){i.value.push({grade_code:"",threshold:"",description:""}),x()}function Q(f){i.value.length>1&&(i.value.splice(f,1),x())}function U(f){const y=parseFloat(f);return!isNaN(y)&&y>=0&&y<=100&&f!==""}function g(f){return f?new Date(f).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function h(){clearTimeout(b),b=setTimeout(x,300)}function x(){clearTimeout(b);const f=n.value==="manual"?i.value.map(y=>({grade_code:(y.grade_code||"").trim(),threshold:parseFloat(y.threshold)||0,description:(y.description||"").trim()})).filter(y=>y.grade_code&&!isNaN(y.threshold)):null;e("update-field",{field:"gradingSystem",value:{selectedOption:n.value,scaleName:r.value,previousScaleName:a.value,gradeData:f,selectedScaleData:u.value}})}function F(){n.value!==""&&(p.value=!0,!z.value)||(x(),e("grading-completed"))}return R(j,f=>{if(n.value==="manual"&&i.value.length===1&&!i.value[0].grade_code){const y=I.value.find(Y=>Y.value===f);y&&q(y)}}),re(()=>{if(se(),n.value==="manual"&&i.value.length===1&&!i.value[0].grade_code){const f=I.value.find(y=>y.value===j.value);f&&q(f)}x()}),{selectedOption:n,scaleName:r,previousScaleName:a,manualGrades:i,gradingScales:o,selectedScalePreview:u,loadingScales:l,instituteTypes:I,filteredInstituteTypes:ee,showValidation:p,hasValidManualGrades:V,hasManualValidationErrors:te,isFormValid:z,isRecommendedTemplate:K,selectOption:oe,onScaleSelect:$,applyTemplate:q,addGrade:J,removeGrade:Q,handleSubmit:F,debouncedUpdate:h,formatDate:g}}},js={class:"grading-system-container"},Ns={class:"mb-8"},Ms={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fs={class:"flex items-start space-x-4"},Ps={class:"flex-1"},Bs=["disabled"],Es=["value"],Ls={key:0,class:"mt-2 text-sm text-gray-500"},Os={key:1,class:"mt-2 text-sm text-gray-500"},Is={key:0,class:"mb-8"},Us={class:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden"},Ys={class:"px-6 py-4 border-b border-gray-200 bg-gray-50"},Gs={class:"text-lg font-semibold text-gray-800"},qs={class:"overflow-x-auto"},Vs={class:"w-full"},Ws={class:"bg-white divide-y divide-gray-200"},Rs={class:"px-6 py-4 whitespace-nowrap"},Hs={class:"text-sm font-medium text-gray-900"},Ks={class:"px-6 py-4 whitespace-nowrap"},zs={class:"text-sm text-gray-600"},$s={class:"px-6 py-4"},Js={class:"text-sm text-gray-500"},Qs={class:"px-6 py-3 bg-gray-50 border-t border-gray-200"},Zs={class:"text-xs text-gray-500"},Xs={key:1,class:"space-y-6"},eo={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},to=["onClick"],so={class:"flex items-center space-x-3"},oo={class:"font-medium text-gray-900"},io={class:"text-xs text-gray-500 mt-1"},ro={key:0,class:"mt-1"},no={class:"bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden"},ao={class:"px-6 py-4 border-b border-gray-200 bg-gray-50"},lo={class:"flex items-center justify-between"},uo={class:"overflow-x-auto"},co={class:"w-full"},mo={class:"bg-white divide-y divide-gray-200"},go={class:"px-6 py-4 whitespace-nowrap"},po=["onUpdate:modelValue"],ho={class:"px-6 py-4 whitespace-nowrap"},fo={class:"flex items-center space-x-2"},vo=["onUpdate:modelValue"],bo={class:"px-6 py-4"},yo=["onUpdate:modelValue"],So={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Co=["onClick","disabled"],xo={key:0,class:"text-center py-12"},_o={key:0,class:"p-4 bg-red-50 border border-red-200 rounded-lg"},wo={class:"mt-2 text-sm text-red-600 list-disc list-inside space-y-1"},ko={key:0},To={key:1};function Do(s,e,n,r,a,i){return d(),c("div",js,[e[28]||(e[28]=t("div",{class:"mb-8"},[t("p",{class:"text-gray-600"},"Configure your institution's grading system. This step is optional.")],-1)),t("div",Ns,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Select Grading System Option ",-1)),t("div",Ms,[t("div",{onClick:e[2]||(e[2]=o=>r.selectOption("previous")),class:T(["p-6 border-2 rounded-lg cursor-pointer transition-all duration-200",r.selectedOption==="previous"?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-300 bg-white hover:border-gray-400"])},[t("div",Fs,[e[13]||(e[13]=t("div",{class:"flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("div",Ps,[e[11]||(e[11]=t("h4",{class:"font-semibold text-gray-900 mb-2"},"Use Existing Grading Scale",-1)),e[12]||(e[12]=t("p",{class:"text-sm text-gray-600 mb-3"},"Select from previously created grading scales",-1)),_(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.previousScaleName=o),onChange:e[1]||(e[1]=(...o)=>r.onScaleSelect&&r.onScaleSelect(...o)),disabled:r.selectedOption!=="previous",class:T(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-3",{"bg-gray-100":r.selectedOption!=="previous"}])},[e[10]||(e[10]=t("option",{value:""},"Select a grading scale",-1)),(d(!0),c(S,null,C(r.gradingScales,o=>(d(),c("option",{key:o.name,value:o.name},m(o.grading_scale_name),9,Es))),128))],42,Bs),[[X,r.previousScaleName]]),r.loadingScales?(d(),c("div",Ls," Loading grading scales... ")):r.gradingScales.length===0?(d(),c("div",Os," No previous grading scales found ")):v("",!0)])])],2),t("div",{onClick:e[3]||(e[3]=o=>r.selectOption("manual")),class:T(["p-6 border-2 rounded-lg cursor-pointer transition-all duration-200",r.selectedOption==="manual"?"border-green-500 bg-green-50 ring-2 ring-green-200":"border-gray-300 bg-white hover:border-gray-400"])},e[14]||(e[14]=[de('<div class="flex items-start space-x-4" data-v-09b838a4><div class="flex-shrink-0 w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center" data-v-09b838a4><svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-09b838a4><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" data-v-09b838a4></path></svg></div><div class="flex-1" data-v-09b838a4><h4 class="font-semibold text-gray-900 mb-2" data-v-09b838a4>Create New Grading Scale</h4><p class="text-sm text-gray-600" data-v-09b838a4>Manually define your grading system</p></div></div>',1)]),2)])]),r.selectedOption==="previous"&&r.selectedScalePreview?(d(),c("div",Is,[t("div",Us,[t("div",Ys,[t("h5",Gs,"Preview: "+m(r.selectedScalePreview.grading_scale_name),1)]),t("div",qs,[t("table",Vs,[e[16]||(e[16]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Grade Code"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Threshold (%)"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description")])],-1)),t("tbody",Ws,[(d(!0),c(S,null,C(r.selectedScalePreview.grades,(o,u)=>(d(),c("tr",{key:o.grade_code,class:"hover:bg-gray-50 transition-colors"},[t("td",Rs,[t("div",Hs,m(o.grade_code),1)]),t("td",Ks,[t("div",zs,m(o.threshold)+"% and above",1)]),t("td",$s,[t("div",Js,m(o.description||"No description"),1)])]))),128))])])]),t("div",Qs,[t("div",Zs,m(r.selectedScalePreview.grade_count)+" grades â€¢ Updated "+m(r.formatDate(r.selectedScalePreview.modified)),1)])])])):v("",!0),r.selectedOption==="manual"?(d(),c("div",Xs,[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[D(" Grading Scale Name "),t("span",{class:"text-red-500"},"*")],-1)),_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>r.scaleName=o),type:"text",placeholder:"e.g., Standard Grading Scale",class:T(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-300":!r.scaleName&&r.showValidation}])},null,2),[[k,r.scaleName]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Quick Templates (Optional) ",-1)),t("div",eo,[(d(!0),c(S,null,C(r.filteredInstituteTypes,o=>(d(),c("button",{key:o.value,onClick:u=>r.applyTemplate(o),class:T(["p-4 border border-gray-300 rounded-lg text-left bg-white hover:border-gray-400 transition-colors",{"border-blue-500 bg-blue-50":r.isRecommendedTemplate(o)}])},[t("div",so,[e[19]||(e[19]=t("div",{class:"flex-shrink-0 w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center"},[t("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})])],-1)),t("div",null,[t("h4",oo,m(o.label),1),t("p",io,m(o.grades.length)+" pre-defined grades",1),r.isRecommendedTemplate(o)?(d(),c("div",ro,e[18]||(e[18]=[t("span",{class:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800"},[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),D(" Recommended for your institution ")],-1)]))):v("",!0)])])],10,to))),128))])]),t("div",no,[t("div",ao,[t("div",lo,[e[22]||(e[22]=t("h4",{class:"text-lg font-semibold text-gray-800"},"Grading Scale",-1)),t("button",{onClick:e[5]||(e[5]=(...o)=>r.addGrade&&r.addGrade(...o)),class:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2 text-sm"},e[21]||(e[21]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Add Grade",-1)]))])]),t("div",uo,[t("table",co,[e[25]||(e[25]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Grade Code"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Threshold (%)"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Description"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",mo,[(d(!0),c(S,null,C(r.manualGrades,(o,u)=>(d(),c("tr",{key:u,class:"hover:bg-gray-50 transition-colors"},[t("td",go,[_(t("input",{"onUpdate:modelValue":l=>o.grade_code=l,type:"text",placeholder:"e.g., A, B, C",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:e[6]||(e[6]=(...l)=>r.debouncedUpdate&&r.debouncedUpdate(...l))},null,40,po),[[k,o.grade_code]])]),t("td",ho,[t("div",fo,[_(t("input",{"onUpdate:modelValue":l=>o.threshold=l,type:"number",min:"0",max:"100",step:"0.1",placeholder:"0-100",class:"w-24 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:e[7]||(e[7]=(...l)=>r.debouncedUpdate&&r.debouncedUpdate(...l))},null,40,vo),[[k,o.threshold]]),e[23]||(e[23]=t("span",{class:"text-gray-500 text-sm"},"%",-1))])]),t("td",bo,[_(t("input",{"onUpdate:modelValue":l=>o.description=l,type:"text",placeholder:"e.g., Excellent, Good, Average",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onInput:e[8]||(e[8]=(...l)=>r.debouncedUpdate&&r.debouncedUpdate(...l))},null,40,yo),[[k,o.description]])]),t("td",So,[t("button",{onClick:l=>r.removeGrade(u),class:"text-red-600 hover:text-red-900 p-2 rounded-lg hover:bg-red-50 transition-colors",disabled:r.manualGrades.length<=1},e[24]||(e[24]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Co)])]))),128))])])]),r.manualGrades.length===0?(d(),c("div",xo,[e[26]||(e[26]=t("p",{class:"text-gray-500 mb-4"},"No grades added yet.",-1)),t("button",{onClick:e[9]||(e[9]=(...o)=>r.addGrade&&r.addGrade(...o)),class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Add First Grade ")])):v("",!0)]),r.showValidation&&r.hasManualValidationErrors?(d(),c("div",_o,[e[27]||(e[27]=t("div",{class:"flex items-center space-x-2 text-red-700"},[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),t("span",{class:"font-medium"},"Please fix the following issues:")],-1)),t("ul",wo,[r.scaleName?v("",!0):(d(),c("li",ko,"Grading scale name is required")),r.hasValidManualGrades?v("",!0):(d(),c("li",To,"All grades must have a code and valid threshold (0-100)"))])])):v("",!0)])):v("",!0)])}const Ao=O(As,[["render",Do],["__scopeId","data-v-09b838a4"]]),jo={name:"FeeStructureCreator",props:{values:Object},data(){return{selectedTemplates:{},newCategoryInputs:[],newAmountInputs:[],feeStructures:[],savedCommonStructures:[],currentStructureId:null,commonStructure:{name:"",frequency:"Annually",categories:[]},newCommonCategory:{name:"",amount:0},quickSelectCategories:[{name:"Tuition Fee",amount:5e3},{name:"Admission Fee",amount:1e3},{name:"Library Fee",amount:500},{name:"Sports Fee",amount:800},{name:"Lab Fee",amount:1200},{name:"Exam Fee",amount:600},{name:"Transport Fee",amount:3e3},{name:"Development Fee",amount:2e3}],feeFrequencies:[{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annual"},{value:"Annually",label:"Annual"},{value:"Term-Wise",label:"Term-Wise"}]}},computed:{classes(){return this.values.classes||[]},institutionType(){return this.values.selectedInstitution||"school"},isEditingSavedStructure(){return this.currentStructureId!==null}},watch:{classes:{immediate:!0,handler(s){this.feeStructures=s.map(()=>[]),this.newCategoryInputs=new Array(s.length).fill({}),this.newAmountInputs=new Array(s.length).fill({})}},feeStructures:{handler(s){this.emitFeeStructures()},deep:!0}},methods:{onStructureNameEnter(){this.commonStructure.name.trim()&&this.addStructureToAllPrograms()},addStructureToAllPrograms(){!this.commonStructure.name.trim()||this.commonStructure.categories.length===0||this.isEditingSavedStructure||(this.classes.forEach((s,e)=>{this.feeStructures[e]||(this.feeStructures[e]=[]);const n=this.feeStructures[e].findIndex(r=>r.name===this.commonStructure.name&&r.frequency===this.commonStructure.frequency);if(n===-1){const r={name:this.commonStructure.name,frequency:this.commonStructure.frequency,templateName:null,components:[],commonCategories:[...this.commonStructure.categories],savedStructureId:null};this.feeStructures[e].push(r)}else{const r=this.feeStructures[e][n];r.commonCategories=[...this.commonStructure.categories],r.savedStructureId=null}}),this.feeStructures=[...this.feeStructures])},connectSavedStructureToAllPrograms(s){s&&(this.classes.forEach((e,n)=>{this.feeStructures[n]||(this.feeStructures[n]=[]);const r=this.feeStructures[n].findIndex(a=>a.name===s.name&&a.frequency===s.frequency);if(r===-1){const a={name:s.name,frequency:s.frequency,templateName:null,components:[],commonCategories:[...s.categories],savedStructureId:s.id};this.feeStructures[n].push(a)}else{const a=this.feeStructures[n][r];a.commonCategories=[...s.categories],a.savedStructureId=s.id}}),this.feeStructures=[...this.feeStructures])},removeSavedStructureFromAllPrograms(s){this.classes.forEach((e,n)=>{this.feeStructures[n]&&(this.feeStructures[n]=this.feeStructures[n].filter(r=>r.savedStructureId!==s))}),this.savedCommonStructures=this.savedCommonStructures.filter(e=>e.id!==s),this.currentStructureId===s&&this.startNewStructure(),this.$emit("update-field",{field:"savedCommonStructures",value:this.savedCommonStructures}),this.feeStructures=[...this.feeStructures]},updateProgramsWithCurrentStructure(){!this.isEditingSavedStructure||!this.commonStructure.name||!this.savedCommonStructures.find(e=>e.id===this.currentStructureId)||(this.classes.forEach((e,n)=>{this.feeStructures[n]&&this.feeStructures[n].forEach(r=>{r.savedStructureId===this.currentStructureId&&(r.commonCategories=[...this.commonStructure.categories],r.name=this.commonStructure.name,r.frequency=this.commonStructure.frequency)})}),this.feeStructures=[...this.feeStructures])},startNewStructure(){this.currentStructureId=null,this.commonStructure={name:"",frequency:"Annually",categories:[]},this.newCommonCategory={name:"",amount:0}},loadSavedStructure(s){const e=this.savedCommonStructures.find(n=>n.id===s);e&&(this.currentStructureId&&this.disconnectCurrentStructure(),this.commonStructure=JSON.parse(JSON.stringify(e)),this.currentStructureId=s,this.connectSavedStructureToAllPrograms(e))},disconnectCurrentStructure(){this.currentStructureId&&(this.classes.forEach((s,e)=>{this.feeStructures[e]&&this.feeStructures[e].forEach(n=>{n.savedStructureId===this.currentStructureId&&(n.savedStructureId=null)})}),this.feeStructures=[...this.feeStructures])},saveCommonStructure(){if(!(!this.commonStructure.name||this.commonStructure.categories.length===0)){if(this.isEditingSavedStructure){const s=this.savedCommonStructures.findIndex(e=>e.id===this.currentStructureId);s!==-1&&(this.savedCommonStructures[s]=G(L({},this.commonStructure),{id:this.currentStructureId}),this.updateProgramsWithCurrentStructure())}else{const s=Date.now()+Math.random().toString(36).substr(2,9),e=G(L({},this.commonStructure),{id:s});this.savedCommonStructures.unshift(e),this.currentStructureId=s,this.connectSavedStructureToAllPrograms(e)}this.$emit("update-field",{field:"savedCommonStructures",value:this.savedCommonStructures})}},deleteSavedStructure(s,e){e.stopPropagation(),confirm("Are you sure you want to delete this saved structure? This will remove it from all programs.")&&this.removeSavedStructureFromAllPrograms(s)},addCommonCategory(){if(this.newCommonCategory.name.trim()&&this.newCommonCategory.amount>0){const s=this.commonStructure.categories.findIndex(e=>e.name.toLowerCase()===this.newCommonCategory.name.trim().toLowerCase());s>=0?this.commonStructure.categories[s].amount=this.newCommonCategory.amount:this.commonStructure.categories.push({name:this.newCommonCategory.name.trim(),amount:this.newCommonCategory.amount}),this.newCommonCategory.name="",this.newCommonCategory.amount=0,this.isEditingSavedStructure?this.updateProgramsWithCurrentStructure():this.commonStructure.name&&this.addStructureToAllPrograms()}},removeCommonCategory(s){this.commonStructure.categories.splice(s,1),this.isEditingSavedStructure?this.updateProgramsWithCurrentStructure():this.commonStructure.name&&this.addStructureToAllPrograms()},isCommonCategorySelected(s){return this.commonStructure.categories.some(e=>e.name===s)},toggleCommonCategory(s){if(this.isCommonCategorySelected(s.name)){const e=this.commonStructure.categories.findIndex(n=>n.name===s.name);this.removeCommonCategory(e)}else this.newCommonCategory.name=s.name,this.newCommonCategory.amount=s.amount,this.addCommonCategory()},calculateCommonStructureTotal(){return this.commonStructure.categories.reduce((s,e)=>s+e.amount,0)},calculateSavedStructureTotal(s){return s.categories.reduce((e,n)=>e+n.amount,0)},getAppliedCommonCategories(s,e){var r;const n=(r=this.feeStructures[s])==null?void 0:r[e];return(n==null?void 0:n.commonCategories)||[]},removeCommonCategoryFromStructure(s,e,n){const r=this.feeStructures[s][e];if(r.commonCategories){const a=r.commonCategories.findIndex(i=>i.name===n);a!==-1&&(r.commonCategories.splice(a,1),this.feeStructures=[...this.feeStructures])}},updateCommonCategoryAmount(s,e,n,r){const a=this.feeStructures[s][e];if(a.commonCategories){const i=a.commonCategories.find(o=>o.name===n);i&&(i.amount=parseFloat(r)||0,this.feeStructures=[...this.feeStructures])}},getFrequencySelectClass(s){return{Monthly:"border-blue-200 text-blue-800 bg-blue-50",Quarterly:"border-purple-200 text-purple-800 bg-purple-50","Semi-Annually":"border-orange-200 text-orange-800 bg-orange-50",Annually:"border-green-200 text-green-800 bg-green-50","Term-Wise":"border-red-200 text-red-800 bg-red-50"}[s]||"border-gray-200 text-gray-800 bg-gray-50"},getFrequencyBadgeClass(s){return{Monthly:"bg-blue-100 text-blue-800 border-blue-200",Quarterly:"bg-purple-100 text-purple-800 border-purple-200","Semi-Annually":"bg-orange-100 text-orange-800 border-orange-200",Annually:"bg-green-100 text-green-800 border-green-200","Term-Wise":"bg-red-100 text-red-800 border-red-200"}[s]||"bg-gray-100 text-gray-800 border-gray-200"},updateComponentLabel(s,e,n,r){const a=this.feeStructures[s][e].components[n];a&&(a.fees_category=r)},validateComponentLabel(s,e,n){const r=this.feeStructures[s][e].components[n];r&&!r.fees_category.trim()&&(r.fees_category="Unnamed Category")},updateStructureName(s,e,n){this.feeStructures[s][e].name=n},updateStructureFrequency(s,e,n){this.feeStructures[s][e].frequency=n},addNewStructure(s){this.feeStructures[s]||(this.feeStructures[s]=[]);const e=this.feeStructures[s].length+1;this.feeStructures[s].push({name:`Custom Structure ${e}`,frequency:"Monthly",templateName:null,components:[],commonCategories:[],savedStructureId:null}),this.newCategoryInputs[s]||(this.newCategoryInputs[s]={},this.newAmountInputs[s]={}),this.newCategoryInputs[s][this.feeStructures[s].length-1]="",this.newAmountInputs[s][this.feeStructures[s].length-1]=0,this.newCategoryInputs=[...this.newCategoryInputs],this.newAmountInputs=[...this.newAmountInputs]},removeStructure(s,e){this.feeStructures[s].splice(e,1),this.newCategoryInputs[s]&&(delete this.newCategoryInputs[s][e],this.newCategoryInputs=[...this.newCategoryInputs]),this.newAmountInputs[s]&&(delete this.newAmountInputs[s][e],this.newAmountInputs=[...this.newAmountInputs])},updateComponentAmount(s,e,n,r){const a=this.feeStructures[s][e].components[n];a&&(a.amount=parseFloat(r)||0,a.total=a.amount)},validateComponentAmount(s){s.amount<=0&&(s.amount=0,s.total=0)},getCategoryInput(s,e){var n;return((n=this.newCategoryInputs[s])==null?void 0:n[e])||""},setCategoryInput(s,e,n){this.newCategoryInputs[s]||(this.newCategoryInputs[s]={}),this.newCategoryInputs[s][e]=n,this.newCategoryInputs=[...this.newCategoryInputs]},getAmountInput(s,e){var n;return((n=this.newAmountInputs[s])==null?void 0:n[e])||0},setAmountInput(s,e,n){this.newAmountInputs[s]||(this.newAmountInputs[s]={}),this.newAmountInputs[s][e]=parseFloat(n)||0,this.newAmountInputs=[...this.newAmountInputs]},addCustomCategory(s,e){var a;const n=(a=this.getCategoryInput(s,e))==null?void 0:a.trim(),r=this.getAmountInput(s,e);if(n&&r>0){const i=this.feeStructures[s][e],o=i.components.findIndex(u=>u.fees_category.toLowerCase()===n.toLowerCase());o>=0?(i.components[o].amount=r,i.components[o].total=r):i.components.push({fees_category:n,amount:r,discount:0,total:r}),this.setCategoryInput(s,e,""),this.setAmountInput(s,e,0)}},removeComponent(s,e,n){this.feeStructures[s][e].components.splice(n,1)},calculateStructureTotal(s,e){const n=this.feeStructures[s][e];let r=0;return n.commonCategories&&(r+=n.commonCategories.reduce((a,i)=>a+i.amount,0)),r+=n.components.reduce((a,i)=>a+i.amount,0),r},getClassStructuresCount(s){return this.feeStructures[s]?this.feeStructures[s].length:0},getTotalStructures(){return this.feeStructures.reduce((s,e)=>s+(e?e.length:0),0)},getTotalCategories(){let s=0;return this.feeStructures.forEach(e=>{e&&e.forEach(n=>{n.commonCategories&&(s+=n.commonCategories.length),s+=n.components.length})}),s},getGrandTotal(){let s=0;return this.feeStructures.forEach((e,n)=>{e&&e.forEach((r,a)=>{s+=this.calculateStructureTotal(n,a)})}),s},emitFeeStructures(){this.$emit("update-field",{field:"feeStructures",value:this.feeStructures})}}},No={class:"bg-white shadow rounded-lg p-6 space-y-6"},Mo={key:0,class:"saved-structures-section"},Fo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Po=["onClick"],Bo=["onClick"],Eo={class:"flex items-center justify-between mb-2 pr-8"},Lo={class:"font-semibold text-gray-800 text-sm"},Oo={class:"text-xs text-gray-600 mb-2"},Io={class:"flex flex-wrap gap-1"},Uo={key:0,class:"inline-block px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full"},Yo={key:0,class:"mt-2 text-xs text-blue-600 font-medium"},Go={class:"create-structure-section"},qo={class:"flex items-center justify-between mb-4"},Vo={class:"common-structure-builder bg-blue-50 p-4 rounded-lg border border-gray-200 mb-4"},Wo={class:"flex items-center justify-between mb-4"},Ro={class:"text-lg font-semibold text-gray-800"},Ho=["disabled"],Ko={class:"space-y-4"},zo={class:"flex items-center space-x-4"},$o={class:"flex-1"},Jo={class:"w-48"},Qo={class:"relative"},Zo=["value"],Xo={class:"flex flex-wrap items-center gap-2 p-3 bg-white rounded border border-gray-200 min-h-[60px]"},ei={class:"flex items-center space-x-2"},ti={class:"font-medium"},si={class:"text-blue-600"},oi=["onClick"],ii={class:"flex items-center space-x-2 flex-1 min-w-[200px]"},ri={class:"relative"},ni={class:"quick-select mt-3"},ai={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},li=["onClick"],ui={class:"font-medium"},di={class:"text-xs text-gray-600"},ci={class:"bg-white p-3 rounded border border-gray-200"},mi={class:"flex items-center justify-between"},gi={class:"text-lg font-bold text-blue-600"},pi={class:"text-xs text-gray-500 mt-1"},hi={key:1,class:"class-structures-section"},fi={class:"flex items-center justify-between mb-4"},vi={class:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded"},bi={class:"space-y-6"},yi={class:"flex items-center justify-between mb-4"},Si={class:"flex items-center space-x-3"},Ci={class:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center"},xi={class:"text-blue-600 font-medium text-sm"},_i={class:"font-semibold text-gray-900"},wi={class:"text-xs text-gray-500"},ki=["onClick"],Ti={key:0,class:"space-y-3"},Di={class:"flex items-center justify-between mb-2"},Ai={class:"flex items-center space-x-2"},ji=["value","onInput"],Ni={class:"relative"},Mi=["value","onChange"],Fi=["value"],Pi={class:"flex items-center space-x-1"},Bi={class:"text-xs text-gray-500"},Ei=["onClick"],Li={key:0,class:"mb-2"},Oi={class:"space-y-2"},Ii={class:"flex items-center space-x-3 flex-1"},Ui={class:"flex-1 min-w-0"},Yi={class:"font-medium text-gray-800 block truncate"},Gi={class:"flex items-center space-x-2"},qi={class:"flex items-center space-x-1"},Vi=["value","onInput"],Wi=["onClick"],Ri={class:"flex items-center space-x-3 flex-1"},Hi={class:"flex-1 min-w-0"},Ki=["value","onInput","onBlur"],zi={class:"flex items-center space-x-2"},$i={class:"flex items-center space-x-1"},Ji=["value","onInput","onBlur"],Qi=["onClick"],Zi={class:"flex space-x-2 mt-2"},Xi=["value","onInput","onKeydown"],er={class:"relative"},tr=["value","onInput","onKeydown"],sr=["onClick","disabled"],or={key:1,class:"text-center py-4 text-gray-500 text-sm"},ir={key:2,class:"summary-section"},rr={class:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-100"},nr={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},ar={class:"text-center"},lr={class:"text-2xl font-bold text-blue-600"},ur={class:"font-semibold text-gray-800 capitalize"},dr={class:"text-center"},cr={class:"text-2xl font-bold text-green-600"},mr={class:"font-semibold text-gray-800"},gr={class:"text-center"},pr={class:"text-2xl font-bold text-purple-600"},hr={class:"font-semibold text-gray-800"},fr={class:"text-center"},vr={class:"text-2xl font-bold text-orange-600"},br={class:"font-semibold text-gray-800"},yr={class:"mt-4 pt-4 border-t border-blue-200"},Sr={class:"text-center"},Cr={class:"text-lg font-bold text-gray-800"},xr={key:3,class:"text-center py-8"};function _r(s,e,n,r,a,i){return d(),c("div",No,[a.savedCommonStructures.length>0?(d(),c("div",Mo,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Saved Common Structures ",-1)),t("div",Fo,[(d(!0),c(S,null,C(a.savedCommonStructures,(o,u)=>(d(),c("div",{key:o.id,class:T(["saved-structure-card p-4 border border-gray-200 rounded-lg bg-white shadow-sm cursor-pointer hover:shadow-md transition-shadow relative",{"border-blue-500 bg-blue-50":a.currentStructureId===o.id}]),onClick:l=>i.loadSavedStructure(o.id)},[t("button",{onClick:ie(l=>i.deleteSavedStructure(o.id,l),["stop"]),class:"absolute top-2 right-2 text-red-500 hover:text-red-700 transition-colors",title:"Delete this structure from all programs"},e[9]||(e[9]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Bo),t("div",Eo,[t("h4",Lo,m(o.name),1),t("span",{class:T(["text-xs font-medium px-2 py-1 rounded-full",i.getFrequencyBadgeClass(o.frequency)])},m(o.frequency),3)]),t("div",Oo,m(o.categories.length)+" categories â€¢ â‚¹"+m(i.calculateSavedStructureTotal(o).toLocaleString()),1),t("div",Io,[(d(!0),c(S,null,C(o.categories.slice(0,3),(l,p)=>(d(),c("span",{key:p,class:"inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"},m(l.name),1))),128)),o.categories.length>3?(d(),c("span",Uo," +"+m(o.categories.length-3)+" more ",1)):v("",!0)]),a.currentStructureId===o.id?(d(),c("div",Yo," âœ“ Connected ")):v("",!0)],10,Po))),128))])])):v("",!0),t("div",Go,[t("div",qo,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"}," Common Structure Builder ",-1)),t("button",{onClick:e[0]||(e[0]=(...o)=>i.startNewStructure&&i.startNewStructure(...o)),class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm font-medium transition-colors flex items-center space-x-2"},e[11]||(e[11]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Reset",-1)]))]),t("div",Vo,[t("div",Wo,[t("h4",Ro,m(a.currentStructureId?"Editing Common Structure":"Building Common Structure"),1),t("button",{onClick:e[1]||(e[1]=(...o)=>i.saveCommonStructure&&i.saveCommonStructure(...o)),disabled:!a.commonStructure.name||a.commonStructure.categories.length===0,class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm font-medium transition-colors flex items-center space-x-2"},[e[13]||(e[13]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)),t("span",null,m(a.currentStructureId?"Update Structure":"Save Common Structure"),1)],8,Ho)]),t("div",Ko,[t("div",zo,[t("div",$o,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Structure Name",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a.commonStructure.name=o),onKeydown:e[3]||(e[3]=E((...o)=>i.onStructureNameEnter&&i.onStructureNameEnter(...o),["enter"])),placeholder:"e.g., Annual Fees, Basic Charges, etc.",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[k,a.commonStructure.name]])]),t("div",Jo,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Frequency",-1)),t("div",Qo,[_(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.commonStructure.frequency=o),class:T(["w-full text-sm font-medium pr-8 pl-3 py-2 rounded-md border bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors",i.getFrequencySelectClass(a.commonStructure.frequency)])},[(d(!0),c(S,null,C(a.feeFrequencies,o=>(d(),c("option",{key:o.value,value:o.value,class:"text-gray-800"},m(o.label),9,Zo))),128))],2),[[X,a.commonStructure.frequency]]),e[15]||(e[15]=t("div",{class:"custom-select-arrow"},[t("svg",{class:"w-4 h-4 text-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Common Categories",-1)),t("div",Xo,[(d(!0),c(S,null,C(a.commonStructure.categories,(o,u)=>(d(),c("div",{key:u,class:"inline-flex items-center px-3 py-2 rounded-lg bg-blue-100 text-blue-800 text-sm border border-blue-200"},[t("div",ei,[t("span",ti,m(o.name),1),t("span",si,"â‚¹"+m(o.amount.toLocaleString()),1),t("button",{onClick:l=>i.removeCommonCategory(u),class:"ml-2 text-blue-500 hover:text-blue-700 transition-colors"}," Ã— ",8,oi)])]))),128)),t("div",ii,[_(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>a.newCommonCategory.name=o),onKeydown:e[6]||(e[6]=E((...o)=>i.addCommonCategory&&i.addCommonCategory(...o),["enter"])),placeholder:"Add common category...",class:"flex-1 px-3 py-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[k,a.newCommonCategory.name]]),t("div",ri,[e[17]||(e[17]=t("span",{class:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm"},"â‚¹",-1)),_(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=o=>a.newCommonCategory.amount=o),onKeydown:e[8]||(e[8]=E((...o)=>i.addCommonCategory&&i.addCommonCategory(...o),["enter"])),placeholder:"Amount",class:"w-24 pl-6 pr-3 py-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,544),[[k,a.newCommonCategory.amount]])])])]),t("div",ni,[e[18]||(e[18]=t("h3",{class:"text-sm font-medium text-gray-700 mb-2"},"Quick Select Common Categories",-1)),t("div",ai,[(d(!0),c(S,null,C(a.quickSelectCategories,o=>(d(),c("div",{key:o.name,class:T(["category-card px-3 py-2 border rounded-md text-center cursor-pointer text-sm",{"bg-blue-100 border-blue-300":i.isCommonCategorySelected(o.name),"bg-gray-50 hover:bg-gray-100":!i.isCommonCategorySelected(o.name)}]),onClick:u=>i.toggleCommonCategory(o)},[t("div",ui,m(o.name),1),t("div",di,"â‚¹"+m(o.amount.toLocaleString()),1)],10,li))),128))])])]),t("div",ci,[t("div",mi,[e[20]||(e[20]=t("span",{class:"text-sm font-medium text-gray-700"},"Total Amount:",-1)),t("span",gi,"â‚¹"+m(i.calculateCommonStructureTotal().toLocaleString()),1)]),t("div",pi,m(a.currentStructureId?"Editing connected structure - changes update all programs":"Create new structure or select a saved one above"),1)])])])]),i.classes.length>0?(d(),c("div",hi,[t("div",fi,[e[21]||(e[21]=t("h4",{class:"text-md font-semibold text-gray-800"},"Class-wise Fee Structures",-1)),t("span",vi,m(i.getTotalStructures())+" structures across "+m(i.classes.length)+" classes ",1)]),t("div",bi,[(d(!0),c(S,null,C(i.classes,(o,u)=>(d(),c("div",{key:u,class:"class-fee-card p-4 border border-gray-200 rounded-lg bg-white shadow-sm"},[t("div",yi,[t("div",Si,[t("div",Ci,[t("span",xi,m(u+1),1)]),t("div",null,[t("h5",_i,m(o.className),1),t("p",wi,m(i.getClassStructuresCount(u))+" structures",1)])]),t("button",{onClick:l=>i.addNewStructure(u),class:"px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm font-medium transition-colors flex items-center space-x-1"},e[22]||(e[22]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),t("span",null,"Add Structure",-1)]),8,ki)]),a.feeStructures[u]&&a.feeStructures[u].length>0?(d(),c("div",Ti,[(d(!0),c(S,null,C(a.feeStructures[u],(l,p)=>(d(),c("div",{key:p,class:"structure-card p-3 border border-gray-100 rounded-lg bg-gray-50"},[t("div",Di,[t("div",Ai,[t("input",{value:l.name,onInput:b=>i.updateStructureName(u,p,b.target.value),class:"font-medium text-gray-800 text-sm bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none px-1 py-0.5"},null,40,ji),t("div",Ni,[t("select",{value:l.frequency,onChange:b=>i.updateStructureFrequency(u,p,b.target.value),class:T(["text-xs font-medium pr-8 pl-3 py-1 rounded-full border bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors",i.getFrequencySelectClass(l.frequency)])},[(d(!0),c(S,null,C(a.feeFrequencies,b=>(d(),c("option",{key:b.value,value:b.value,class:"text-gray-800"},m(b.label),9,Fi))),128))],42,Mi),e[23]||(e[23]=t("div",{class:"custom-select-arrow"},[t("svg",{class:"w-3 h-3 text-current",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),t("div",Pi,[t("span",Bi,"Total: â‚¹"+m(i.calculateStructureTotal(u,p).toLocaleString()),1),a.feeStructures[u].length>1?(d(),c("button",{key:0,onClick:b=>i.removeStructure(u,p),class:"text-red-400 hover:text-red-600 transition-colors p-1",title:"Remove structure"},e[24]||(e[24]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Ei)):v("",!0)])]),l.savedStructureId?(d(),c("div",Li,e[25]||(e[25]=[t("span",{class:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"},[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),D(" Connected to Saved Structure ")],-1)]))):v("",!0),t("div",Oi,[(d(!0),c(S,null,C(i.getAppliedCommonCategories(u,p),(b,j)=>(d(),c("div",{key:"common-"+j,class:"component-item flex items-center justify-between p-2 bg-white rounded border text-sm border-blue-200 bg-blue-50"},[t("div",Ii,[e[27]||(e[27]=t("div",{class:"w-2 h-2 bg-blue-500 rounded-full"},null,-1)),t("div",Ui,[t("span",Yi,[D(m(b.name)+" ",1),e[26]||(e[26]=t("span",{class:"text-blue-600 text-xs ml-1"},"(Common)",-1))])])]),t("div",Gi,[t("div",qi,[e[28]||(e[28]=t("span",{class:"text-gray-500 text-xs"},"â‚¹",-1)),t("input",{type:"number",value:b.amount,onInput:N=>i.updateCommonCategoryAmount(u,p,b.name,N.target.value),class:"w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,40,Vi)]),t("button",{onClick:N=>i.removeCommonCategoryFromStructure(u,p,b.name),class:"text-red-400 hover:text-red-600 transition-colors p-1",title:"Remove common category"},e[29]||(e[29]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Wi)])]))),128)),(d(!0),c(S,null,C(l.components,(b,j)=>(d(),c("div",{key:"specific-"+j,class:"component-item flex items-center justify-between p-2 bg-white rounded border border-gray-200"},[t("div",Ri,[e[30]||(e[30]=t("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),t("div",Hi,[t("input",{type:"text",value:b.fees_category,onInput:N=>i.updateComponentLabel(u,p,j,N.target.value),onBlur:N=>i.validateComponentLabel(u,p,j),class:"w-full bg-transparent border-b border-transparent hover:border-gray-300 focus:border-green-500 focus:outline-none px-1 py-0.5 text-sm font-medium text-gray-800",placeholder:"Category name..."},null,40,Ki)])]),t("div",zi,[t("div",$i,[e[31]||(e[31]=t("span",{class:"text-gray-500 text-xs"},"â‚¹",-1)),t("input",{type:"number",value:b.amount,onInput:N=>i.updateComponentAmount(u,p,j,N.target.value),onBlur:N=>i.validateComponentAmount(b),class:"w-20 px-2 py-1 text-xs border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,40,Ji)]),t("button",{onClick:N=>i.removeComponent(u,p,j),class:"text-red-400 hover:text-red-600 transition-colors p-1",title:"Remove category"},e[32]||(e[32]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Qi)])]))),128))]),t("div",Zi,[t("input",{value:i.getCategoryInput(u,p),onInput:b=>i.setCategoryInput(u,p,b.target.value),onKeydown:E(b=>i.addCustomCategory(u,p),["enter"]),placeholder:"Custom category name...",class:"flex-1 px-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,40,Xi),t("div",er,[e[33]||(e[33]=t("span",{class:"absolute left-2 top-1/2 transform -translate-y-1/2 text-gray-500 text-xs"},"â‚¹",-1)),t("input",{value:i.getAmountInput(u,p),onInput:b=>i.setAmountInput(u,p,b.target.value),onKeydown:E(b=>i.addCustomCategory(u,p),["enter"]),type:"number",placeholder:"Amount",class:"w-16 pl-6 pr-2 py-1 border border-gray-300 rounded text-xs focus:ring-1 focus:ring-blue-500 focus:border-blue-500"},null,40,tr)]),t("button",{onClick:b=>i.addCustomCategory(u,p),disabled:!i.getCategoryInput(u,p)||!i.getAmountInput(u,p),class:"px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-xs font-medium transition-colors"}," Add ",8,sr)])]))),128))])):(d(),c("div",or,' No fee structures added. Click "Add Structure" to create one. '))]))),128))])])):v("",!0),i.classes.length>0?(d(),c("div",ir,[e[39]||(e[39]=t("h4",{class:"text-md font-semibold text-gray-800 mb-3"},"Summary",-1)),t("div",rr,[t("div",nr,[t("div",ar,[t("div",lr,m(i.institutionType==="school"?"School":"College"),1),e[34]||(e[34]=t("div",{class:"text-gray-600 mt-1"},"Institution",-1)),t("div",ur,m(i.institutionType),1)]),t("div",dr,[t("div",cr,m(i.classes.length),1),e[35]||(e[35]=t("div",{class:"text-gray-600 mt-1"},"Total Classes",-1)),t("div",mr,m(i.classes.length),1)]),t("div",gr,[t("div",pr,m(i.getTotalStructures()),1),e[36]||(e[36]=t("div",{class:"text-gray-600 mt-1"},"Total Structures",-1)),t("div",hr,m(i.getTotalStructures()),1)]),t("div",fr,[t("div",vr,m(i.getTotalCategories()),1),e[37]||(e[37]=t("div",{class:"text-gray-600 mt-1"},"Total Categories",-1)),t("div",br,m(i.getTotalCategories()),1)])]),t("div",yr,[t("div",Sr,[t("div",Cr,"â‚¹"+m(i.getGrandTotal().toLocaleString()),1),e[38]||(e[38]=t("div",{class:"text-gray-600 text-sm"},"Grand Total Across All Classes",-1))])])])])):v("",!0),i.classes.length===0?(d(),c("div",xr,e[40]||(e[40]=[de('<div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center" data-v-371c71a7><svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-371c71a7><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-371c71a7></path></svg></div><h4 class="text-lg font-medium text-gray-900 mb-2" data-v-371c71a7>No Classes Found</h4><p class="text-gray-500 text-sm" data-v-371c71a7>Please go back and set up classes first to create fee structures.</p>',3)]))):v("",!0)])}const wr=O(jo,[["render",_r],["__scopeId","data-v-371c71a7"]]),kr={name:"MultiStepForm",components:{EmailAccountSetup:Te,AcademicYearTerms:nt,UsePreviousData:ft,SubjectsDivisions:Ds,GradingSystem:Ao,FeeStructureCreator:wr},setup(){const s=w(0),e=w([]),n=w(!1),r=w(!1),a=w(!1),i=w(""),o=w([]),u=w(!1),l=fe({email:"",googleAppPassword:"",academicYear:"",academicYearStart:"",academicYearEnd:"",numberOfTerms:"",terms:[],selectedTerm:"",selectedInstitution:"",classes:[],subjects:[],divisions:[],commonSubjects:[],commonDivisions:[],dontCreateClasses:!1,feeStructures:[],setAsCurrent:!1,gradingSystem:{selectedOption:"",scaleName:"",previousScaleName:"",gradeData:null},gradingCompleted:!1}),p=w([{title:"Email Account Setup (Optional)",component:"EmailAccountSetup"},{title:"Academic Year & Terms",component:"AcademicYearTerms"},{title:"Use Previous Data",component:"UsePreviousData"},{title:"Subjects and Divisions",component:"SubjectsDivisions"},{title:"Grading System",component:"GradingSystem"},{title:"Create Fee Structures",component:"FeeStructureCreator"}]),b=H({url:"school.al_ummah.api3.get_previous_data",params:{values:{}},onSuccess:g=>{e.value=Array.isArray(g)?g.map(h=>G(L({},h),{academicYear:h.json_data?JSON.parse(h.json_data).academicYear:""})):[]},onError:g=>{console.error("Error fetching previous data:",g),e.value=[]}}),j=H({url:"school.al_ummah.api3.create_email_account",params:{email_id:"",password:""},onSuccess:()=>{alert("Email account setup successfully!")},onError:g=>{console.error("Error setting up email account:",g),alert("Error setting up email account.")}}),N=H({url:"school.al_ummah.api3.quick_setup",params:{values:{}},onSuccess:()=>{a.value=!0,s.value++,n.value=!1,r.value=!0},onError:g=>{var h;a.value=!1,i.value=((h=g.messages)==null?void 0:h[0])||"An error occurred while submitting the form.",console.error("Submission error:",g),n.value=!1,r.value=!0}});function I(){l.gradingCompleted=!0,$()}function ee({classNames:g}){const h=[...l.classes],x=h.reduce((M,A)=>Math.max(M,A.classIndex||0),0),F=g.map((M,A)=>({className:M,subjects:[],divisions:[{divisionName:""}],classIndex:x+A+1}));l.classes=[...h,...F]}function K(){b.reload()}function V({field:g,value:h,parent:x=null}){x&&l[x]?l[x][g]=h:l[g]=h}function te({field:g,index:h,subField:x,value:F}){h!==void 0&&x?l[g][h][x]=F:h!==void 0?l[g][h]=F:l[g]=F}function z(){return le(this,null,function*(){const{email:g,googleAppPassword:h}=l;if(!g||!h){alert("Please provide both email and Google app password.");return}j.update({params:{email_id:g,password:h}}),j.submit()})}function se(){const g=parseInt(l.numberOfTerms,10),h=new Date(l.academicYearStart),x=new Date(l.academicYearEnd);if(!g||g<=0){alert("Please enter a valid number of terms.");return}if(isNaN(h.getTime())){alert("Please enter valid 'From' date.");return}if(isNaN(x.getTime())){alert("Please enter valid 'To' date.");return}if(h>=x){alert("'From' date must be before 'To' date.");return}const F=Math.ceil((x-h)/(1e3*60*60*24)),M=Math.floor(F/g),A=[];let P=new Date(h);for(let B=0;B<g;B++){const f=new Date(P);f.setDate(P.getDate()+M-1),B===g-1&&f.setTime(x.getTime()),A.push({name:`Term ${B+1}`,startDate:P.toISOString().split("T")[0],endDate:f.toISOString().split("T")[0]}),P=new Date(f),P.setDate(P.getDate()+1)}l.terms=A}function oe(g){if(console.log("ðŸ“¥ USE_PREVIOUS_DATA: Selected data received",g),!(g!=null&&g.json_data)){console.error("âŒ Invalid or missing previous data");return}try{const h=JSON.parse(g.json_data);console.log("ðŸ“Š Parsed previous data:",{classes:h.classes,commonSubjects:h.commonSubjects,commonDivisions:h.commonDivisions,divisions:h.divisions}),l.classes=h.classes||[],l.commonSubjects=h.commonSubjects||[],l.commonDivisions=h.commonDivisions||[],l.subjects=h.subjects||[],l.divisions=h.divisions||[],console.log("âœ… Updated formValues:",{classes:l.classes,commonSubjects:l.commonSubjects,commonDivisions:l.commonDivisions})}catch(h){console.error("âŒ Error parsing previous data:",h),alert("Failed to load previous data. Please try another selection.")}}function $(){s.value<p.value.length-1?(s.value++,u.value=!1):J()}function q(){s.value>0&&(s.value--,u.value=!1)}function J(){n.value=!0,r.value=!1,a.value=!1,i.value="",u.value=!1;const h=Q(l,["selectedTerm","commonSubjects","commonDivisions","divisions","institutionName","logo","dontCreateClasses","subjects","terms","email","googleAppPassword","classes","gradingSystem","gradingCompleted","setAsCurrent"]);if(h.length>0){o.value=h,u.value=!0,n.value=!1,window.scrollTo({top:0,behavior:"smooth"});return}N.update({params:{values:L({},l)}}),N.submit()}function Q(g,h){const x=[];return Object.entries(g).forEach(([F,M])=>{if(!h.includes(F)){if(Array.isArray(M))if(M.length===0){const A=U(F);x.push(`${A} list is empty`)}else M.forEach((A,P)=>{typeof A=="object"&&A!==null&&Object.entries(A).forEach(([B,f])=>{if(!f||typeof f=="string"&&f.trim()===""){const y=U(B),Y=U(F);x.push(`${Y} ${P+1}: ${y} is required`)}})});else if(!M||typeof M=="string"&&M.trim()===""){const A=U(F);x.push(`${A} is required`)}}}),x}function U(g){return g.replace(/([A-Z])/g," $1").replace(/^./,h=>h.toUpperCase()).replace(/([A-Z])/g," $1").trim()}return re(()=>{K()}),R(()=>l.commonDivisions,g=>{console.log("ðŸ  MAIN COMPONENT: commonDivisions updated:",g)},{deep:!0}),R(()=>l.commonSubjects,g=>{console.log("ðŸ  MAIN COMPONENT: commonSubjects updated:",g)},{deep:!0}),R(()=>l.classes,g=>{var h;console.log("ðŸ  MAIN COMPONENT: classes updated - count:",g==null?void 0:g.length),g&&g.length>0&&console.log("ðŸ  MAIN COMPONENT: First class divisions:",(h=g[0])==null?void 0:h.divisions)},{deep:!0}),R(l,g=>{var h;console.log("ðŸ  MAIN COMPONENT: formValues updated:",{commonSubjects:g.commonSubjects,commonDivisions:g.commonDivisions,classesCount:(h=g.classes)==null?void 0:h.length})},{deep:!0,immediate:!0}),{currentStep:s,previousDataList:e,isSubmitting:n,showResultMessage:r,submitSuccess:a,errorMessage:i,missingFields:o,showMissingFields:u,formValues:l,steps:p,quickSetupResource:N,autoCreateClasses:ee,fetchPreviousData:K,updateField:V,updateFieldArray:te,submitEmailAccount:z,autoCreateTerms:se,usePreviousData:oe,handleGradingCompleted:I,nextStep:$,prevStep:q,submitForm:J,checkMissingFields:Q,formatFieldName:U}}},Tr={class:"enrollment-container"},Dr={class:"floating-navigation"},Ar={key:1,class:"back-button-placeholder"},jr=["disabled"],Nr={key:0,class:"scroll-view-content"},Mr={class:"header"},Fr={class:"title"},Pr={key:0,class:"missing-fields-alert form-card"},Br={class:"alert-header"},Er={class:"alert-content"},Lr={class:"missing-fields-list"},Or={class:"form-card"},Ir={key:1,class:"loading-overlay"},Ur={key:2,class:"modal-overlay"},Yr={class:"result-modal"},Gr={key:0,class:"success-icon"},qr={key:1,class:"error-icon"},Vr={class:"result-title"},Wr={class:"result-description"},Rr={class:"modal-actions"},Hr={key:3,class:"form-card"};function Kr(s,e,n,r,a,i){return d(),c("div",Tr,[t("div",Dr,[r.currentStep>0?(d(),c("button",{key:0,onClick:e[0]||(e[0]=(...o)=>r.prevStep&&r.prevStep(...o)),class:"nav-button back-button"},e[4]||(e[4]=[t("svg",{class:"button-icon",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"})],-1),D(" Back ")]))):(d(),c("div",Ar)),t("button",{onClick:e[1]||(e[1]=(...o)=>r.nextStep&&r.nextStep(...o)),class:"nav-button next-button",disabled:r.isSubmitting||r.quickSetupResource.loading},[D(m(r.currentStep===r.steps.length-1?r.isSubmitting?"Submitting...":"Submit":"Next")+" ",1),e[5]||(e[5]=t("svg",{class:"button-icon",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"})],-1))],8,jr)]),r.currentStep<r.steps.length?(d(),c("div",Nr,[t("div",Mr,[t("h2",Fr,m(r.steps[r.currentStep].title),1)]),r.missingFields.length>0&&r.showMissingFields?(d(),c("div",Pr,[t("div",Br,[e[7]||(e[7]=t("div",{class:"alert-icon"},[t("svg",{class:"icon",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"})])],-1)),e[8]||(e[8]=t("h3",{class:"alert-title"},"Required Information Missing",-1)),t("button",{onClick:e[2]||(e[2]=o=>r.showMissingFields=!1),class:"close-button"},e[6]||(e[6]=[t("svg",{class:"close-icon",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"})],-1)]))]),t("div",Er,[e[10]||(e[10]=t("p",{class:"alert-description"},"Please fill in the following required fields before proceeding:",-1)),t("ul",Lr,[(d(!0),c(S,null,C(r.missingFields,(o,u)=>(d(),c("li",{key:u,class:"missing-field-item"},[e[9]||(e[9]=t("span",{class:"field-bullet"},"â€¢",-1)),D(" "+m(o),1)]))),128))])])])):v("",!0),t("div",Or,[(d(),ve(be(r.steps[r.currentStep].component),{values:r.formValues,previousDataList:r.previousDataList,onUpdateField:r.updateField,onUpdateFieldArray:r.updateFieldArray,onSubmitEmail:r.submitEmailAccount,onAutoCreateTerms:r.autoCreateTerms,onAutoCreateClasses:r.autoCreateClasses,onUsePreviousData:r.usePreviousData,onGradingCompleted:r.handleGradingCompleted},null,40,["values","previousDataList","onUpdateField","onUpdateFieldArray","onSubmitEmail","onAutoCreateTerms","onAutoCreateClasses","onUsePreviousData","onGradingCompleted"]))])])):v("",!0),r.isSubmitting?(d(),c("div",Ir,e[11]||(e[11]=[t("div",{class:"loading-modal"},[t("div",{class:"loading-spinner"}),t("h3",{class:"loading-title"},"Submitting your data..."),t("p",{class:"loading-description"},"Please wait while we process your information.")],-1)]))):v("",!0),r.showResultMessage?(d(),c("div",Ur,[t("div",Yr,[r.submitSuccess?(d(),c("div",Gr,e[12]||(e[12]=[t("svg",{class:"icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)]))):(d(),c("div",qr,e[13]||(e[13]=[t("svg",{class:"icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))),t("h3",Vr,m(r.submitSuccess?"Form Submitted Successfully!":"Submission Failed"),1),t("p",Wr,m(r.submitSuccess?"Your data has been successfully processed.":r.errorMessage||"An error occurred while submitting the form."),1),t("div",Rr,[t("button",{onClick:e[3]||(e[3]=o=>r.showResultMessage=!1),class:"success-button"}," OK ")])])])):v("",!0),r.currentStep>=r.steps.length&&!r.isSubmitting&&!r.showResultMessage?(d(),c("div",Hr,e[14]||(e[14]=[t("div",{class:"header"},[t("h2",{class:"title"},"Form Submitted Successfully!"),t("p",{class:"subtitle"},"Your data has been successfully processed.")],-1)]))):v("",!0)])}const zr=O(kr,[["render",Kr],["__scopeId","data-v-72b02ea6"]]),$r={components:{MultiStepForm:zr}},Jr={class:"app-container"};function Qr(s,e,n,r,a,i){const o=Se("MultiStepForm");return d(),c("div",Jr,[ye(o)])}const tn=O($r,[["render",Qr]]);export{tn as default};
