var le=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var z=(m,s,d)=>s in m?le(m,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):m[s]=d,Y=(m,s)=>{for(var d in s||(s={}))oe.call(s,d)&&z(m,d,s[d]);if(j)for(var d of j(s))re.call(s,d)&&z(m,d,s[d]);return m},O=(m,s)=>ne(m,ae(s));import{_ as ue,r as b,x as L,c as k,y as H,j as de,a as r,b as e,h as g,t as o,i as c,z as D,A as x,F as S,l as y,o as u,B as J,C as ie}from"./index-MGLFZjrf.js";/* empty css             */const ce={name:"FeeScheduleCreator",setup(){const m=b(!1),s=b(""),d=b(""),t=b(null),F=b(null),h=b([]),C=b([{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annually"},{value:"Annually",label:"Annually"},{value:"Term-Wise",label:"Term-Wise"}]),l=b({selected_class:"",fee_structure:"",student_group:"",fee_plan:""}),p=L({url:"school.al_ummah.api3.get_classes",auto:!0,onSuccess:n=>{console.log("Classes loaded:",n)},onError:n=>{var a;s.value=((a=n.messages)==null?void 0:a[0])||"Failed to load classes",console.error("Error loading classes:",n)}}),v=L({url:"school.al_ummah.api5.get_fee_structures_for_selection",onSuccess:n=>{console.log("Fee structures loaded:",n)},onError:n=>{var a;s.value=((a=n.messages)==null?void 0:a[0])||"Failed to load fee structures",console.error("Error loading fee structures:",n)}}),f=L({url:"school.al_ummah.api5.get_student_groups_for_fee_structure",onSuccess:n=>{console.log("Student groups loaded:",n),n&&n.success&&n.student_groups&&n.student_groups.forEach(a=>{a.selected=!0})},onError:n=>{var a;s.value=((a=n.messages)==null?void 0:a[0])||"Failed to load student groups",console.error("Error loading student groups:",n)}}),G=L({url:"school.al_ummah.api5.create_and_submit_fee_schedules_with_invoices",method:"POST",onSuccess:n=>{m.value=!1,F.value=null,t.value=n,d.value=n.message,s.value="",console.log("Fee schedules and invoices created:",n)},onError:n=>{var a;m.value=!1,F.value=null,s.value=((a=n.messages)==null?void 0:a[0])||"Failed to create fee schedules and invoices",console.error("Error creating fee schedules:",n)}}),V=k(()=>p.data||[]),w=k(()=>v.data&&v.data.success?v.data.fee_structures:[]),E=k(()=>f.data&&f.data.success?f.data.student_groups:[]),A=k(()=>l.value.fee_structure&&w.value.length?w.value.find(n=>n.name===l.value.fee_structure):null),P=k(()=>E.value.filter(n=>n.selected)),q=k(()=>l.value.selected_class&&l.value.fee_structure&&l.value.fee_plan&&h.value.length>0&&P.value.length>0);H(()=>l.value.fee_plan,n=>{n&&A.value&&I()}),H(()=>l.value.fee_structure,n=>{n&&l.value.fee_plan&&I()});function K(){l.value.fee_structure="",l.value.student_group="",l.value.fee_plan="",t.value=null,d.value="",s.value="",h.value=[],l.value.selected_class?(v.update({params:{program:l.value.selected_class}}),v.reload()):v.data=null}function X(){l.value.student_group="",l.value.fee_plan="",t.value=null,d.value="",s.value="",h.value=[],l.value.fee_structure?(f.update({params:{fee_structure_name:l.value.fee_structure}}),f.reload()):f.data=null}function I(){if(!A.value||!l.value.fee_plan)return;const n=A.value.total_amount,a=l.value.fee_plan,i=Z(a,n);h.value=i.map(_=>O(Y({},_),{selected:!0,due_date:_.due_date||$()}))}function Z(n,a){const i=new Date,_=[],T={Monthly:{frequency:12,gap:1},Quarterly:{frequency:4,gap:3},"Semi-Annually":{frequency:2,gap:6},Annually:{frequency:1,gap:12},"Term-Wise":{frequency:3,gap:4}}[n];if(!T)return[];const te=a/T.frequency;for(let M=1;M<=T.frequency;M++){const W=new Date(i);W.setMonth(i.getMonth()+T.gap*M),_.push({due_date:R(W),amount:parseFloat(te.toFixed(2))})}return _}function $(){const n=new Date;return n.setDate(n.getDate()+30),R(n)}function R(n){const a=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),_=String(n.getDate()).padStart(2,"0");return`${a}-${i}-${_}`}function U(n){const a=V.value.find(i=>i.name===n);return a?a.program_name||a.name:n}function N(n){const a=w.value.find(i=>i.name===n);if(a){let i=a.name;return a.program&&(i+=` - ${a.program}`),a.academic_year&&(i+=` (${a.academic_year})`),i}return n}function B(n){const a=C.value.find(i=>i.value===n);return a?a.label:n}function Q(){return P.value.reduce((n,a)=>n+(a.total_students||0),0)}function ee(){if(!q.value)return;m.value=!0,s.value="",d.value="",t.value=null;const n=h.value.filter(_=>_.selected),a=P.value.map(_=>_.name),i=n.map(_=>_.due_date);F.value={class:U(l.value.selected_class),fee_structure:N(l.value.fee_structure),student_groups:a.join(", "),fee_plan:B(l.value.fee_plan),total_students:Q(),schedule_count:n.length},G.submit({fee_structure_name:l.value.fee_structure,student_groups:a,fee_plan:l.value.fee_plan,due_dates:i})}function se(){l.value={selected_class:"",fee_structure:"",student_group:"",fee_plan:""},t.value=null,s.value="",d.value="",F.value=null,h.value=[],v.data=null,f.data=null}return de(()=>{console.log("Fee Schedule Creator mounted")}),{processing:m,errorMessage:s,successMessage:d,results:t,feePlans:C,formData:l,processingDetails:F,feeSchedules:h,classesResource:p,feeStructuresResource:v,studentGroupsResource:f,createFeeSchedulesResource:G,classesList:V,feeStructuresList:w,studentGroupsList:E,isFormValid:q,selectedFeeStructure:A,selectedStudentGroups:P,onClassChange:K,onFeeStructureChange:X,getClassName:U,getFeeStructureName:N,getFeePlanLabel:B,getTotalStudents:Q,createFeeSchedulesAndInvoices:ee,resetForm:se}}},me={class:"enrollment-container"},ve={class:"scroll-view-content"},_e={key:0,class:"modal-overlay"},fe={class:"loading-modal"},ge={key:0},pe={class:"form-card"},he={key:0,class:"message error"},be={key:1,class:"message success"},Se={class:"form-section"},ye={class:"form-grid"},Fe={class:"form-group required"},ke=["disabled"],De=["value"],Ce={key:0,class:"field-hint"},we={class:"form-group required"},Ae=["disabled"],Pe=["value"],Te={key:0,class:"field-hint"},Le={key:1,class:"field-hint"},Me={class:"form-group required"},xe=["disabled"],Ge=["value"],Ve={key:2,class:"fee-structure-details-section"},Ee={class:"details-grid"},qe={class:"detail-item"},Ie={class:"value"},Re={class:"detail-item"},Ue={class:"value"},Ne={key:0,class:"detail-item"},Be={class:"value"},Qe={key:0,class:"components-section"},We={class:"components-table"},je={key:3,class:"form-section"},ze={class:"table-container-wrapper"},Ye={class:"preview-table"},Oe={class:"status-cell"},He=["onUpdate:modelValue","disabled"],Je=["onUpdate:modelValue","disabled"],Ke={key:4,class:"form-section"},Xe={class:"table-container-wrapper"},Ze={class:"preview-table"},$e={class:"status-cell"},es=["onUpdate:modelValue","disabled"],ss={key:0,class:"summary-stats"},ts={class:"stat-item"},ls={class:"stat-value info"},ns={class:"stat-item"},as={class:"stat-value valid"},os={key:5,class:"summary-section"},rs={class:"summary-grid"},us={class:"summary-item"},ds={class:"value"},is={class:"summary-item"},cs={class:"value"},ms={class:"summary-item"},vs={class:"value"},_s={class:"summary-item"},fs={class:"value"},gs={class:"summary-item"},ps={class:"value"},hs={class:"summary-item"},bs={class:"value"},Ss={class:"form-actions"},ys=["disabled"],Fs={class:"button-content"},ks={key:0,class:"spinner"},Ds=["disabled"],Cs={key:1,class:"form-card summary-card"},ws={class:"message success"},As={class:"form-section"},Ps={class:"table-container-wrapper"},Ts={class:"preview-table"},Ls={class:"actions"},Ms=["href"],xs={class:"form-section"},Gs={class:"table-container-wrapper"},Vs={class:"preview-table"},Es={class:"status-cell"},qs={key:0,class:"status-badge success"},Is={key:1,class:"status-badge error"},Rs={class:"form-actions"};function Us(m,s,d,t,F,h){var C;return u(),r("div",me,[e("div",ve,[s[54]||(s[54]=e("div",{class:"header"},[e("h1",{class:"title"},"Create Fee Schedules & Invoices"),e("p",{class:"subtitle"},"Generate fee schedules and sales invoices for students")],-1)),t.processing?(u(),r("div",_e,[e("div",fe,[s[15]||(s[15]=e("div",{class:"loading-spinner"},null,-1)),s[16]||(s[16]=e("h3",{class:"loading-title"},"Processing Fee Schedules & Invoices",-1)),s[17]||(s[17]=e("p",{class:"loading-description"}," Please wait while we create fee schedules and generate invoices for all students. This may take a few minutes depending on the number of students. ",-1)),t.processingDetails?(u(),r("div",ge,[s[14]||(s[14]=e("h4",null,"Processing Details",-1)),e("div",null,[e("div",null,[s[9]||(s[9]=e("strong",null,"Fee Structure:",-1)),g(" "+o(t.processingDetails.fee_structure),1)]),e("div",null,[s[10]||(s[10]=e("strong",null,"Student Groups:",-1)),g(" "+o(t.processingDetails.student_groups),1)]),e("div",null,[s[11]||(s[11]=e("strong",null,"Fee Plan:",-1)),g(" "+o(t.processingDetails.fee_plan),1)]),e("div",null,[s[12]||(s[12]=e("strong",null,"Total Students:",-1)),g(" "+o(t.processingDetails.total_students),1)]),e("div",null,[s[13]||(s[13]=e("strong",null,"Schedule Count:",-1)),g(" "+o(t.processingDetails.schedule_count),1)])])])):c("",!0),s[18]||(s[18]=e("div",null,[e("div",{class:"spinner"}),g(" Creating fee schedules and invoices... ")],-1))])])):c("",!0),e("div",pe,[s[47]||(s[47]=e("h2",{class:"form-title"},"Fee Schedule Configuration",-1)),t.errorMessage?(u(),r("div",he,[s[19]||(s[19]=e("strong",null,"Error:",-1)),g(" "+o(t.errorMessage),1)])):c("",!0),t.successMessage?(u(),r("div",be,[s[20]||(s[20]=e("strong",null,"Success:",-1)),g(" "+o(t.successMessage),1)])):c("",!0),e("div",Se,[s[27]||(s[27]=e("h3",{class:"section-title"},"Basic Information",-1)),e("div",ye,[e("div",Fe,[s[22]||(s[22]=e("label",null,"Class/Program",-1)),D(e("select",{"onUpdate:modelValue":s[0]||(s[0]=l=>t.formData.selected_class=l),class:"picker",disabled:t.classesResource.loading||t.processing,onChange:s[1]||(s[1]=(...l)=>t.onClassChange&&t.onClassChange(...l))},[s[21]||(s[21]=e("option",{value:""},"Select Class/Program",-1)),(u(!0),r(S,null,y(t.classesList,l=>(u(),r("option",{key:l.name,value:l.name},o(l.program_name||l.name),9,De))),128))],40,ke),[[x,t.formData.selected_class]]),t.classesResource.loading?(u(),r("span",Ce,"Loading classes...")):c("",!0)]),e("div",we,[s[24]||(s[24]=e("label",null,"Fee Structure",-1)),D(e("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>t.formData.fee_structure=l),class:"picker",disabled:!t.formData.selected_class||t.feeStructuresResource.loading||t.processing,onChange:s[3]||(s[3]=(...l)=>t.onFeeStructureChange&&t.onFeeStructureChange(...l))},[s[23]||(s[23]=e("option",{value:""},"Select Fee Structure",-1)),(u(!0),r(S,null,y(t.feeStructuresList,l=>(u(),r("option",{key:l.name,value:l.name},o(l.name)+" - "+o(l.program)+" ("+o(l.academic_year)+") ",9,Pe))),128))],40,Ae),[[x,t.formData.fee_structure]]),t.feeStructuresResource.loading?(u(),r("span",Te,"Loading fee structures...")):c("",!0),t.formData.selected_class?c("",!0):(u(),r("span",Le,"Select a class first"))]),e("div",Me,[s[26]||(s[26]=e("label",null,"Fee Plan",-1)),D(e("select",{"onUpdate:modelValue":s[4]||(s[4]=l=>t.formData.fee_plan=l),class:"picker",disabled:t.processing},[s[25]||(s[25]=e("option",{value:""},"Select Fee Plan",-1)),(u(!0),r(S,null,y(t.feePlans,l=>(u(),r("option",{key:l.value,value:l.value},o(l.label),9,Ge))),128))],8,xe),[[x,t.formData.fee_plan]])])])]),t.formData.fee_structure&&t.selectedFeeStructure?(u(),r("div",Ve,[s[33]||(s[33]=e("h3",{class:"section-title"},"Fee Structure Details",-1)),e("div",Ee,[e("div",qe,[s[28]||(s[28]=e("span",{class:"label"},"Total Amount:",-1)),e("span",Ie,"₹"+o((C=t.selectedFeeStructure.total_amount)==null?void 0:C.toLocaleString()),1)]),e("div",Re,[s[29]||(s[29]=e("span",{class:"label"},"Academic Year:",-1)),e("span",Ue,o(t.selectedFeeStructure.academic_year),1)]),t.selectedFeeStructure.academic_term?(u(),r("div",Ne,[s[30]||(s[30]=e("span",{class:"label"},"Academic Term:",-1)),e("span",Be,o(t.selectedFeeStructure.academic_term),1)])):c("",!0)]),t.selectedFeeStructure.components&&t.selectedFeeStructure.components.length?(u(),r("div",Qe,[s[32]||(s[32]=e("h4",{class:"subsection-title"},"Fee Components",-1)),e("div",We,[e("table",null,[s[31]||(s[31]=e("thead",null,[e("tr",null,[e("th",null,"Fee Category"),e("th",null,"Amount"),e("th",null,"Discount"),e("th",null,"Total")])],-1)),e("tbody",null,[(u(!0),r(S,null,y(t.selectedFeeStructure.components,l=>{var p,v;return u(),r("tr",{key:l.fees_category},[e("td",null,o(l.fees_category),1),e("td",null,"₹"+o((p=l.amount)==null?void 0:p.toLocaleString()),1),e("td",null,o(l.discount)+"%",1),e("td",null,"₹"+o((v=l.total)==null?void 0:v.toLocaleString()),1)])}),128))])])])])):c("",!0)])):c("",!0),t.formData.fee_plan&&t.feeSchedules.length?(u(),r("div",je,[s[35]||(s[35]=e("h3",{class:"section-title"},"Fee Schedule Distribution",-1)),e("div",ze,[e("table",Ye,[s[34]||(s[34]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Due Date")]),e("th",null,[e("div",{class:"header-label"},"Amount")])])],-1)),e("tbody",null,[(u(!0),r(S,null,y(t.feeSchedules,(l,p)=>{var v;return u(),r("tr",{key:p},[e("td",Oe,[D(e("input",{type:"checkbox","onUpdate:modelValue":f=>l.selected=f,disabled:t.processing,class:"custom-checkbox"},null,8,He),[[J,l.selected]])]),e("td",null,[D(e("input",{type:"date","onUpdate:modelValue":f=>l.due_date=f,disabled:t.processing,class:"table-input"},null,8,Je),[[ie,l.due_date]])]),e("td",null,"₹"+o((v=l.amount)==null?void 0:v.toLocaleString()),1)])}),128))])])])])):c("",!0),t.formData.fee_structure&&t.studentGroupsList.length?(u(),r("div",Ke,[s[39]||(s[39]=e("h3",{class:"section-title"},"Select Student Groups",-1)),e("div",Xe,[e("table",Ze,[s[36]||(s[36]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Student Group")]),e("th",null,[e("div",{class:"header-label"},"Total Students")])])],-1)),e("tbody",null,[(u(!0),r(S,null,y(t.studentGroupsList,l=>(u(),r("tr",{key:l.name},[e("td",$e,[D(e("input",{type:"checkbox","onUpdate:modelValue":p=>l.selected=p,disabled:t.processing,class:"custom-checkbox"},null,8,es),[[J,l.selected]])]),e("td",null,o(l.name),1),e("td",null,o(l.total_students),1)]))),128))])])]),t.selectedStudentGroups.length>0?(u(),r("div",ss,[e("div",ts,[s[37]||(s[37]=e("span",{class:"stat-label"},"Selected Groups",-1)),e("span",ls,o(t.selectedStudentGroups.length),1)]),e("div",ns,[s[38]||(s[38]=e("span",{class:"stat-label"},"Total Students",-1)),e("span",as,o(t.getTotalStudents()),1)])])):c("",!0)])):c("",!0),t.isFormValid?(u(),r("div",os,[s[46]||(s[46]=e("h3",{class:"section-title"},"Summary",-1)),e("div",rs,[e("div",us,[s[40]||(s[40]=e("span",{class:"label"},"Class:",-1)),e("span",ds,o(t.getClassName(t.formData.selected_class)),1)]),e("div",is,[s[41]||(s[41]=e("span",{class:"label"},"Fee Structure:",-1)),e("span",cs,o(t.getFeeStructureName(t.formData.fee_structure)),1)]),e("div",ms,[s[42]||(s[42]=e("span",{class:"label"},"Fee Plan:",-1)),e("span",vs,o(t.getFeePlanLabel(t.formData.fee_plan)),1)]),e("div",_s,[s[43]||(s[43]=e("span",{class:"label"},"Total Schedules:",-1)),e("span",fs,o(t.feeSchedules.filter(l=>l.selected).length),1)]),e("div",gs,[s[44]||(s[44]=e("span",{class:"label"},"Student Groups:",-1)),e("span",ps,o(t.selectedStudentGroups.length)+" groups",1)]),e("div",hs,[s[45]||(s[45]=e("span",{class:"label"},"Total Students:",-1)),e("span",bs,o(t.getTotalStudents()),1)])])])):c("",!0),e("div",Ss,[e("button",{onClick:s[5]||(s[5]=(...l)=>t.createFeeSchedulesAndInvoices&&t.createFeeSchedulesAndInvoices(...l)),class:"enroll-button",disabled:!t.isFormValid||t.processing},[e("span",Fs,[t.processing?(u(),r("span",ks)):c("",!0),g(" "+o(t.processing?"Processing...":"Create Fee Schedules & Invoices"),1)])],8,ys),e("button",{onClick:s[6]||(s[6]=(...l)=>t.resetForm&&t.resetForm(...l)),class:"reset-button",disabled:t.processing}," Reset Form ",8,Ds)])]),t.results&&t.results.success?(u(),r("div",Cs,[s[53]||(s[53]=e("h2",{class:"form-title"},"Creation Results",-1)),e("div",ws,[s[48]||(s[48]=e("strong",null,"Successfully Created!",-1)),g(" "+o(t.results.message),1)]),e("div",As,[s[50]||(s[50]=e("h3",{class:"section-title"},"Fee Schedules Created",-1)),e("div",Ps,[e("table",Ts,[s[49]||(s[49]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Action")])],-1)),e("tbody",null,[(u(!0),r(S,null,y(t.results.fee_schedules,l=>(u(),r("tr",{key:l},[e("td",null,o(l),1),e("td",Ls,[e("a",{href:`/app/fee-schedule/${l}`,target:"_blank",class:"primary-button",style:{padding:"0.5rem 1rem","font-size":"0.9rem","text-decoration":"none",display:"inline-block"}}," View ",8,Ms)])]))),128))])])])]),e("div",xs,[s[52]||(s[52]=e("h3",{class:"section-title"},"Invoice Results",-1)),e("div",Gs,[e("table",Vs,[s[51]||(s[51]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Students Processed"),e("th",null,"Status")])],-1)),e("tbody",null,[(u(!0),r(S,null,y(t.results.invoice_results,l=>(u(),r("tr",{key:l.fee_schedule},[e("td",null,o(l.fee_schedule),1),e("td",null,o(l.result.created_count)+"/"+o(l.result.total_students),1),e("td",Es,[l.result.success?(u(),r("span",qs,"Success")):(u(),r("span",Is,"Failed"))])]))),128))])])])]),e("div",Rs,[e("button",{onClick:s[7]||(s[7]=(...l)=>t.resetForm&&t.resetForm(...l)),class:"success-button"}," Create Another "),e("button",{onClick:s[8]||(s[8]=l=>t.results=null),class:"secondary-button"}," Close Results ")])])):c("",!0)])])}const js=ue(ce,[["render",Us],["__scopeId","data-v-2d36b809"]]);export{js as default};
