import{_ as R,r as d,x as F,c as h,j as V,a as n,b as s,t as r,i,h as y,y as C,z as D,F as _,l as p,n as j,o as a}from"./index-DPZu7dOE.js";const A={name:"FeeScheduleCreator",setup(){const f=d(!1),e=d(""),c=d(""),t=d(null),v=d(null),k=d([{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annually"},{value:"Annually",label:"Annually"},{value:"Term-Wise",label:"Term-Wise"}]),o=d({fee_structure:"",student_group:"",fee_plan:""}),S=F({url:"school.al_ummah.api5.get_fee_structures_for_selection",auto:!0,onSuccess:l=>{console.log("Fee structures loaded:",l)},onError:l=>{var u;e.value=((u=l.messages)==null?void 0:u[0])||"Failed to load fee structures",console.error("Error loading fee structures:",l)}}),m=F({url:"school.al_ummah.api5.get_student_groups_for_fee_structure",onSuccess:l=>{console.log("Student groups loaded:",l)},onError:l=>{var u;e.value=((u=l.messages)==null?void 0:u[0])||"Failed to load student groups",console.error("Error loading student groups:",l)}}),M=F({url:"school.al_ummah.api5.create_and_submit_fee_schedules_with_invoices",method:"POST",onSuccess:l=>{f.value=!1,v.value=null,t.value=l,c.value=l.message,e.value="",console.log("Fee schedules and invoices created:",l)},onError:l=>{var u;f.value=!1,v.value=null,e.value=((u=l.messages)==null?void 0:u[0])||"Failed to create fee schedules and invoices",console.error("Error creating fee schedules:",l)}}),w=h(()=>S.data&&S.data.success?S.data.fee_structures:[]),b=h(()=>m.data&&m.data.success?m.data.student_groups:[]),x=h(()=>o.value.fee_structure&&o.value.student_group&&o.value.fee_plan);function I(){o.value.student_group="",t.value=null,c.value="",e.value="",o.value.fee_structure&&(m.update({params:{fee_structure_name:o.value.fee_structure}}),m.reload())}function G(l){const u=w.value.find(g=>g.name===l);return u?`${u.name} - ${u.program} (${u.academic_year})`:l}function P(l){const u=b.value.find(g=>g.name===l);return u?u.name:l}function L(l){const u=k.value.find(g=>g.value===l);return u?u.label:l}function B(){const l=b.value.find(u=>u.name===o.value.student_group);return l?l.total_students:0}function T(){x.value&&(f.value=!0,e.value="",c.value="",t.value=null,v.value={fee_structure:G(o.value.fee_structure),student_group:P(o.value.student_group),fee_plan:L(o.value.fee_plan),total_students:B()},M.submit({fee_structure_name:o.value.fee_structure,student_group_name:o.value.student_group,fee_plan:o.value.fee_plan}))}function E(){o.value={fee_structure:"",student_group:"",fee_plan:""},t.value=null,e.value="",c.value="",v.value=null}return V(()=>{console.log("Fee Schedule Creator mounted")}),{processing:f,errorMessage:e,successMessage:c,results:t,feePlans:k,formData:o,processingDetails:v,feeStructuresResource:S,studentGroupsResource:m,createFeeSchedulesResource:M,feeStructuresList:w,studentGroupsList:b,isFormValid:x,onFeeStructureChange:I,getFeeStructureName:G,getStudentGroupName:P,getFeePlanLabel:L,getTotalStudents:B,createFeeSchedulesAndInvoices:T,resetForm:E}}},z={key:0,class:"processing-modal-overlay"},N={class:"processing-modal"},q={key:0,class:"processing-details"},U={class:"detail-item"},Q={class:"detail-value"},W={class:"detail-item"},H={class:"detail-value"},O={class:"detail-item"},J={class:"detail-value"},K={class:"detail-item"},X={class:"detail-value"},Y={class:"form-card"},Z={key:0,class:"message error"},$={class:"message-content"},ee={key:1,class:"message success"},se={class:"message-content"},te={class:"form-grid"},oe={class:"form-group required"},le=["disabled"],ne=["value"],re={key:0,class:"loading-text"},ae={class:"form-group required"},ue=["disabled"],ie=["value"],de={key:0,class:"loading-text"},ce={key:1,class:"hint-text"},ve={class:"form-group required"},me=["disabled"],fe=["value"],ge={key:2,class:"summary-section"},_e={class:"summary-grid"},pe={class:"summary-item"},Se={class:"value"},ke={class:"summary-item"},be={class:"value"},Fe={class:"summary-item"},he={class:"value"},ye={class:"summary-item"},Ce={class:"value"},De={class:"form-actions"},Me=["disabled"],we={class:"button-content"},xe={key:0,class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},Ge={key:1,class:"spinner"},Pe=["disabled"],Le={key:1,class:"form-card results-card"},Be={class:"success-banner"},Ie={class:"success-content"},Te={class:"results-details"},Ee={class:"result-section"},Re={class:"result-list"},Ve={class:"result-name"},je=["href"],Ae={class:"result-section"},ze={class:"result-list"},Ne={class:"result-name"},qe={class:"result-count"};function Ue(f,e,c,t,v,k){return a(),n("div",{class:j(["fee-schedule-container",{blurred:t.processing}])},[e[42]||(e[42]=s("div",{class:"header"},[s("h1",{class:"title"},"Create Fee Schedules & Invoices"),s("p",{class:"subtitle"},"Generate fee schedules and sales invoices for students")],-1)),t.processing?(a(),n("div",z,[s("div",N,[e[12]||(e[12]=s("div",{class:"processing-spinner"},null,-1)),e[13]||(e[13]=s("h3",{class:"processing-title"},"Processing Fee Schedules & Invoices",-1)),e[14]||(e[14]=s("p",{class:"processing-description"}," Please wait while we create fee schedules and generate invoices for all students. This may take a few minutes depending on the number of students. ",-1)),t.processingDetails?(a(),n("div",q,[s("div",U,[e[8]||(e[8]=s("span",{class:"detail-label"},"Fee Structure:",-1)),s("span",Q,r(t.processingDetails.fee_structure),1)]),s("div",W,[e[9]||(e[9]=s("span",{class:"detail-label"},"Student Group:",-1)),s("span",H,r(t.processingDetails.student_group),1)]),s("div",O,[e[10]||(e[10]=s("span",{class:"detail-label"},"Fee Plan:",-1)),s("span",J,r(t.processingDetails.fee_plan),1)]),s("div",K,[e[11]||(e[11]=s("span",{class:"detail-label"},"Total Students:",-1)),s("span",X,r(t.processingDetails.total_students),1)])])):i("",!0),e[15]||(e[15]=s("div",{class:"processing-status"},[s("div",{class:"status-spinner"}),s("span",{class:"status-text"},"Creating fee schedules and invoices...")],-1))])])):i("",!0),s("div",Y,[e[34]||(e[34]=s("h2",{class:"form-title"},"Fee Schedule Configuration",-1)),t.errorMessage?(a(),n("div",Z,[e[18]||(e[18]=s("div",{class:"message-icon"},[s("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("div",$,[e[16]||(e[16]=s("strong",null,"Error:",-1)),y(" "+r(t.errorMessage),1)]),s("button",{onClick:e[0]||(e[0]=o=>t.errorMessage=""),class:"message-close"},e[17]||(e[17]=[s("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):i("",!0),t.successMessage?(a(),n("div",ee,[e[21]||(e[21]=s("div",{class:"message-icon"},[s("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("div",se,[e[19]||(e[19]=s("strong",null,"Success:",-1)),y(" "+r(t.successMessage),1)]),s("button",{onClick:e[1]||(e[1]=o=>t.successMessage=""),class:"message-close"},e[20]||(e[20]=[s("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):i("",!0),s("div",te,[s("div",oe,[e[23]||(e[23]=s("label",null,"Fee Structure",-1)),C(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>t.formData.fee_structure=o),class:"picker",disabled:t.feeStructuresResource.loading||t.processing,onChange:e[3]||(e[3]=(...o)=>t.onFeeStructureChange&&t.onFeeStructureChange(...o))},[e[22]||(e[22]=s("option",{value:""},"Select Fee Structure",-1)),(a(!0),n(_,null,p(t.feeStructuresList,o=>(a(),n("option",{key:o.name,value:o.name},r(o.name)+" - "+r(o.program)+" ("+r(o.academic_year)+") ",9,ne))),128))],40,le),[[D,t.formData.fee_structure]]),t.feeStructuresResource.loading?(a(),n("span",re,"Loading fee structures...")):i("",!0)]),s("div",ae,[e[25]||(e[25]=s("label",null,"Student Group",-1)),C(s("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.formData.student_group=o),class:"picker",disabled:!t.formData.fee_structure||t.studentGroupsResource.loading||t.processing},[e[24]||(e[24]=s("option",{value:""},"Select Student Group",-1)),(a(!0),n(_,null,p(t.studentGroupsList,o=>(a(),n("option",{key:o.name,value:o.name},r(o.name)+" - "+r(o.total_students)+" students ",9,ie))),128))],8,ue),[[D,t.formData.student_group]]),t.studentGroupsResource.loading?(a(),n("span",de,"Loading student groups...")):i("",!0),t.formData.fee_structure?i("",!0):(a(),n("span",ce,"Select a fee structure first"))]),s("div",ve,[e[27]||(e[27]=s("label",null,"Fee Plan",-1)),C(s("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>t.formData.fee_plan=o),class:"picker",disabled:t.processing},[e[26]||(e[26]=s("option",{value:""},"Select Fee Plan",-1)),(a(!0),n(_,null,p(t.feePlans,o=>(a(),n("option",{key:o.value,value:o.value},r(o.label),9,fe))),128))],8,me),[[D,t.formData.fee_plan]])])]),t.formData.fee_structure&&t.formData.student_group&&t.formData.fee_plan?(a(),n("div",ge,[e[32]||(e[32]=s("h3",{class:"section-title"},"Summary",-1)),s("div",_e,[s("div",pe,[e[28]||(e[28]=s("span",{class:"label"},"Fee Structure:",-1)),s("span",Se,r(t.getFeeStructureName(t.formData.fee_structure)),1)]),s("div",ke,[e[29]||(e[29]=s("span",{class:"label"},"Student Group:",-1)),s("span",be,r(t.getStudentGroupName(t.formData.student_group)),1)]),s("div",Fe,[e[30]||(e[30]=s("span",{class:"label"},"Fee Plan:",-1)),s("span",he,r(t.getFeePlanLabel(t.formData.fee_plan)),1)]),s("div",ye,[e[31]||(e[31]=s("span",{class:"label"},"Total Students:",-1)),s("span",Ce,r(t.getTotalStudents()),1)])])])):i("",!0),s("div",De,[s("button",{onClick:e[6]||(e[6]=(...o)=>t.createFeeSchedulesAndInvoices&&t.createFeeSchedulesAndInvoices(...o)),class:"primary-button",disabled:!t.isFormValid||t.processing},[s("span",we,[t.processing?i("",!0):(a(),n("svg",xe,e[33]||(e[33]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"},null,-1)]))),t.processing?(a(),n("span",Ge)):i("",!0),y(" "+r(t.processing?"Processing...":"Create Fee Schedules & Invoices"),1)])],8,Me),s("button",{onClick:e[7]||(e[7]=(...o)=>t.resetForm&&t.resetForm(...o)),class:"secondary-button",disabled:t.processing}," Reset Form ",8,Pe)])]),t.results&&t.results.success?(a(),n("div",Le,[e[41]||(e[41]=s("h2",{class:"form-title"},"Creation Results",-1)),s("div",Be,[e[36]||(e[36]=s("div",{class:"success-icon"},[s("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("div",Ie,[e[35]||(e[35]=s("h3",null,"Successfully Created!",-1)),s("p",null,r(t.results.message),1)])]),s("div",Te,[s("div",Ee,[e[38]||(e[38]=s("h4",null,"Fee Schedules Created",-1)),s("div",Re,[(a(!0),n(_,null,p(t.results.fee_schedules,o=>(a(),n("div",{key:o,class:"result-item"},[e[37]||(e[37]=s("span",{class:"result-badge"},"Fee Schedule",-1)),s("span",Ve,r(o),1),s("a",{href:`/app/fee-schedule/${o}`,target:"_blank",class:"view-link"}," View ",8,je)]))),128))])]),s("div",Ae,[e[40]||(e[40]=s("h4",null,"Invoice Results",-1)),s("div",ze,[(a(!0),n(_,null,p(t.results.invoice_results,o=>(a(),n("div",{key:o.fee_schedule,class:"result-item"},[e[39]||(e[39]=s("span",{class:"result-badge"},"Invoices",-1)),s("span",Ne,r(o.fee_schedule),1),s("span",qe,r(o.result.created_count)+"/"+r(o.result.total_students)+" students ",1)]))),128))])])])])):i("",!0)],2)}const We=R(A,[["render",Ue],["__scopeId","data-v-12da091b"]]);export{We as default};
