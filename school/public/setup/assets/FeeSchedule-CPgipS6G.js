var Ne=Object.defineProperty,je=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var oe=(p,s,g)=>s in p?Ne(p,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):p[s]=g,Q=(p,s)=>{for(var g in s||(s={}))qe.call(s,g)&&oe(p,g,s[g]);if(ne)for(var g of ne(s))Ue.call(s,g)&&oe(p,g,s[g]);return p},H=(p,s)=>je(p,Oe(s));import{_ as ce,r as L,c as V,j as ie,x as We,o as d,a as c,b as e,t as a,F as k,l as A,i as S,y as B,h as w,e as Qe,z as j,A as ae,f as Be,n as de,B as Y,C as ze}from"./index-D8Hu_FYz.js";/* empty css             */const Je={class:"student-list-container"},He={class:"student-list-header"},Ye={class:"student-list-title"},Ke={class:"header-actions"},Xe={class:"summary-stats"},Ze={class:"stat-item"},Re={class:"stat-value"},$e={class:"stat-item"},es={class:"stat-value"},ss={class:"bulk-actions"},ts={class:"bulk-buttons"},ls=["onClick"],ns={class:"students-grid"},os={class:"student-basic-info"},as={class:"student-avatar"},ds=["src"],cs={key:1,class:"avatar-placeholder"},is={class:"student-details"},us={class:"student-name"},rs={class:"student-roll"},_s={class:"student-id"},hs={key:0,class:"fee-categories-section"},ms={class:"fee-categories-checkboxes"},fs={class:"checkbox-label"},gs=["checked","onChange"],vs={class:"category-info"},Ss={class:"category-name"},ps={class:"category-amount"},bs={class:"student-selection-summary"},ys={class:"summary-text"},Cs={key:0,class:"no-selection-warning"},ks={key:1,class:"no-categories-message"},As={key:0,class:"empty-state"},Fs={__name:"StudentList",props:{studentGroup:{type:Object,required:!0,default:()=>({})},feeStructures:{type:Array,default:()=>[]},initialSelections:{type:Object,default:()=>({})}},emits:["save","close"],setup(p,{emit:s}){const g=p,n=s,y=L({}),F=V(()=>{const r=[];return g.feeStructures.forEach(u=>{u.components&&u.components.forEach(f=>{r.find(h=>h.fees_category===f.fees_category)||r.push({fees_category:f.fees_category,amount:f.amount,discount:f.discount,total:f.total})})}),r}),M=(r,u)=>{var f;return((f=y.value[r])==null?void 0:f.includes(u))||!1},G=(r,u,f)=>{y.value[r]||(y.value[r]=[]);const h=y.value[r];if(f)h.includes(u)||h.push(u);else{const b=h.indexOf(u);b>-1&&h.splice(b,1)}},l=r=>{var u;return((u=y.value[r])==null?void 0:u.length)||0},v=r=>{var u;(u=g.studentGroup.students)==null||u.forEach(f=>{G(f.student,r,!0)})},i=()=>{var r;(r=g.studentGroup.students)==null||r.forEach(u=>{y.value[u.student]=[]})},E=()=>{y.value={}},C=()=>{var u;const r={};(u=g.studentGroup.students)==null||u.forEach(f=>{const h=f.student,b=y.value[h]||[];if(b.length<F.value.length){const P=F.value.filter(T=>!b.includes(T.fees_category)).map(T=>T.fees_category);P.length>0&&(r[h]=P)}}),n("save",r)},x=r=>r?r.startsWith("http")||r.startsWith("//")?r:r.startsWith("/")?window.location.origin+r:`${window.location.origin}/${r.replace(/^\//,"")}`:null,N=r=>r?r.split(" ").map(u=>u.charAt(0)).join("").toUpperCase().substring(0,2):"?",q=r=>{r.target.style.display="none"};return ie(()=>{var r;g.initialSelections&&Object.keys(g.initialSelections).length>0?y.value=Q({},g.initialSelections):(r=g.studentGroup.students)==null||r.forEach(u=>{y.value[u.student]=F.value.map(f=>f.fees_category)})}),We(()=>g.studentGroup,()=>{var r;y.value={},(r=g.studentGroup.students)==null||r.forEach(u=>{y.value[u.student]=F.value.map(f=>f.fees_category)})},{deep:!0}),(r,u)=>{var f;return d(),c("div",Je,[e("div",He,[e("h3",Ye,a(p.studentGroup.name)+" - Fee Category Selection",1),e("div",Ke,[e("button",{onClick:u[0]||(u[0]=h=>r.$emit("close")),class:"close-button"}," Close ")])]),e("div",Xe,[e("div",Ze,[u[1]||(u[1]=e("span",{class:"stat-label"},"Total Students:",-1)),e("span",Re,a(((f=p.studentGroup.students)==null?void 0:f.length)||0),1)]),e("div",$e,[u[2]||(u[2]=e("span",{class:"stat-label"},"Fee Categories:",-1)),e("span",es,a(F.value.length),1)])]),e("div",ss,[u[3]||(u[3]=e("h4",{class:"bulk-actions-title"},"Bulk Actions",-1)),e("div",ts,[(d(!0),c(k,null,A(F.value,h=>(d(),c("button",{key:h.fees_category,onClick:b=>v(h.fees_category),class:"bulk-category-button"}," Select "+a(h.fees_category)+" for All ",9,ls))),128)),e("button",{onClick:i,class:"bulk-clear-button"}," Clear All Selections ")])]),e("div",ns,[(d(!0),c(k,null,A(p.studentGroup.students,h=>(d(),c("div",{key:h.student,class:"student-card"},[e("div",os,[e("div",as,[h.student_image?(d(),c("img",{key:0,src:x(h.student_image),alt:"Student",class:"avatar-image",onError:q},null,40,ds)):(d(),c("div",cs,a(N(h.student_name)),1))]),e("div",is,[e("h4",us,a(h.student_name),1),e("p",rs,"Roll No: "+a(h.group_roll_number),1),e("p",_s,a(h.student),1)])]),F.value.length>0?(d(),c("div",hs,[u[5]||(u[5]=e("h5",{class:"fee-categories-title"},"Select Fee Categories",-1)),e("div",ms,[(d(!0),c(k,null,A(F.value,b=>{var P;return d(),c("div",{key:b.fees_category,class:"fee-category-checkbox"},[e("label",fs,[e("input",{type:"checkbox",checked:M(h.student,b.fees_category),onChange:T=>G(h.student,b.fees_category,T.target.checked),class:"category-checkbox"},null,40,gs),u[4]||(u[4]=e("span",{class:"checkbox-custom"},null,-1)),e("span",vs,[e("span",Ss,a(b.fees_category),1),e("span",ps,"₹"+a((P=b.total)==null?void 0:P.toLocaleString()),1)])])])}),128))]),e("div",bs,[e("span",ys," Selected: "+a(l(h.student))+"/"+a(F.value.length)+" categories ",1),l(h.student)===0?(d(),c("span",Cs," (No fee categories selected) ")):S("",!0)])])):(d(),c("div",ks,u[6]||(u[6]=[e("p",null,"No fee categories available",-1)])))]))),128))]),!p.studentGroup.students||p.studentGroup.students.length===0?(d(),c("div",As,u[7]||(u[7]=[e("p",{class:"empty-message"},"No students found in this group",-1)]))):S("",!0),e("div",{class:"actions-footer"},[e("button",{onClick:C,class:"save-button"}," Save Fee Category Selections "),e("button",{onClick:E,class:"clear-button"}," Clear All ")])])}}},xs=ce(Fs,[["__scopeId","data-v-a5658c5e"]]),Es={name:"FeeScheduleCreator",components:{StudentList:xs},setup(){const p=L(!1),s=L(""),g=L(""),n=L(null),y=L(null),F=L({}),M=L(!1),G=L(null),l=L({}),v=L([{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annually"},{value:"Annually",label:"Annually"},{value:"Term-Wise",label:"Term-Wise"}]),i=L({selected_class:"",student_group:""}),E=B({url:"school.al_ummah.api3.get_classes",auto:!0,onSuccess:t=>{console.log("Classes loaded:",t)},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load classes",console.error("Error loading classes:",t)}}),C=B({url:"school.al_ummah.api5.get_fee_structures_for_selection",onSuccess:t=>{console.log("Fee structures loaded:",t),t&&t.success&&t.fee_structures&&t.fee_structures.forEach(o=>{o.selected=!1,o.selected_fee_plan=T(o.name)||"",o.feeSchedules=[],o.selected_fee_plan&&U(o)})},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load fee structures",console.error("Error loading fee structures:",t)}}),x=B({url:"school.al_ummah.api5.get_student_groups",onSuccess:t=>{console.log("Student groups loaded:",t),t&&t.success&&t.student_groups&&t.student_groups.forEach(o=>{o.selected=!0,l.value[o.name]||(l.value[o.name]={})})},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load student groups",console.error("Error loading student groups:",t)}}),N=B({url:"school.al_ummah.api5.create_and_submit_fee_schedules_with_invoices",method:"POST",onSuccess:t=>{p.value=!1,y.value=null,n.value=t,g.value=t.message,s.value="",console.log("Fee schedules and invoices created:",t)},onError:t=>{var o;p.value=!1,y.value=null,s.value=((o=t.messages)==null?void 0:o[0])||"Failed to create fee schedules and invoices",console.error("Error creating fee schedules:",t)}}),q=V(()=>E.data||[]),r=V(()=>C.data&&C.data.success?C.data.fee_structures:[]),u=V(()=>x.data&&x.data.success?x.data.student_groups:[]),f=V(()=>r.value.filter(t=>t.selected&&t.selected_fee_plan&&t.feeSchedules&&t.feeSchedules.length>0)),h=V(()=>f.value.length),b=V(()=>u.value.filter(t=>t.selected)),P=V(()=>i.value.selected_class&&h.value>0&&b.value.length>0);function T(t){const o=t.toLowerCase();return o.includes("monthly")?"Monthly":o.includes("quarterly")?"Quarterly":o.includes("semi-annually")||o.includes("semi annually")?"Semi-Annually":o.includes("annually")||o.includes("annual")?"Annually":o.includes("term")||o.includes("term-wise")?"Term-Wise":""}function K(t){return{Monthly:12,Quarterly:4,"Semi-Annually":2,Annually:1,"Term-Wise":3}[t]||1}function ue(t,o){const _=K(o);return parseFloat((t/_).toFixed(2))}function U(t){if(!t.selected_fee_plan)return;const o=t.total_amount,_=t.selected_fee_plan,m=re(_,o);t.feeSchedules=m.map(D=>H(Q({},D),{selected:!0,due_date:D.due_date||he()}))}function re(t,o){const _=new Date,m=[],I={Monthly:{frequency:12,gap:1},Quarterly:{frequency:4,gap:3},"Semi-Annually":{frequency:2,gap:6},Annually:{frequency:1,gap:12},"Term-Wise":{frequency:3,gap:4}}[t];if(!I)return[];const J=o/I.frequency;for(let O=1;O<=I.frequency;O++){const W=new Date(_);W.setMonth(_.getMonth()+I.gap*O),m.push({due_date:X(W),amount:parseFloat(J.toFixed(2))})}return m}function _e(t,o){return{Monthly:["January","February","March","April","May","June","July","August","September","October","November","December"][o]||`Month ${o+1}`,Quarterly:`Quarter ${o+1}`,"Semi-Annually":o===0?"First Half":"Second Half",Annually:"Annual Fee","Term-Wise":`Term ${o+1}`}[t]||`Installment ${o+1}`}function he(){const t=new Date;return t.setDate(t.getDate()+30),X(t)}function X(t){const o=t.getFullYear(),_=String(t.getMonth()+1).padStart(2,"0"),m=String(t.getDate()).padStart(2,"0");return`${o}-${_}-${m}`}function me(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not set"}function fe(){i.value.student_group="",n.value=null,g.value="",s.value="",F.value={},l.value={},i.value.selected_class?(C.update({params:{program:i.value.selected_class}}),C.reload()):C.data=null}function ge(t){t.selected?t.selected&&!t.selected_fee_plan&&(t.selected_fee_plan=T(t.name)||"",t.selected_fee_plan&&U(t)):(t.selected_fee_plan="",t.feeSchedules=[]),h.value>0&&!x.data&&Z()}function ve(t){t.selected_fee_plan?U(t):t.feeSchedules=[]}function Z(){i.value.selected_class&&(x.update({params:{program:i.value.selected_class}}),x.reload())}function Se(t){F.value=H(Q({},F.value),{[t]:!F.value[t]})}function pe(){r.value.forEach(t=>{t.selected=!0,t.selected_fee_plan||(t.selected_fee_plan=T(t.name)||"",t.selected_fee_plan&&U(t))}),h.value>0&&Z()}function be(){r.value.forEach(t=>{t.selected=!1,t.selected_fee_plan="",t.feeSchedules=[]})}function ye(){u.value.forEach(t=>{t.selected=!0})}function Ce(){u.value.forEach(t=>{t.selected=!1})}function ke(t){t.feeSchedules&&t.feeSchedules.forEach(o=>{o.selected=!0})}function Ae(t){t.feeSchedules&&t.feeSchedules.forEach(o=>{o.selected=!1})}function R(t){const o=q.value.find(_=>_.name===t);return o?o.program_name||o.name:t}function Fe(t){const o=v.value.find(_=>_.value===t);return o?o.label:t}function $(t){return t.feeSchedules?t.feeSchedules.filter(o=>o.selected).length:0}function ee(){return f.value.reduce((t,o)=>t+$(o),0)}function se(){const t=[];return f.value.forEach(o=>{o.components&&o.components.forEach(_=>{t.includes(_.fees_category)||t.push(_.fees_category)})}),t}function z(t){const o=t.total_students||0,_=l.value[t.name]||{},m=se();if(m.length===0)return o;const D=Object.keys(_).filter(I=>(_[I]||[]).length===m.length).length;return o-D}function te(){return b.value.reduce((t,o)=>t+z(o),0)}function xe(){let t=0;return b.value.forEach(o=>{const _=o.total_students||0,m=z(o);t+=_-m}),t}function Ee(t){const o=l.value[t.name];return o&&Object.keys(o).length>0}function De(t){const o=l.value[t.name];if(!o)return 0;let _=0;return Object.values(o).forEach(m=>{_+=m.length}),_}function le(){let t=0;return b.value.forEach(o=>{const _=l.value[o.name];_&&Object.values(_).forEach(m=>{t+=m.length})}),t}function we(){return f.value.reduce((t,o)=>t+(o.total_amount||0),0)}function Le(t){var m;if(!t)return{};const o={},_=se();return(m=t.students)==null||m.forEach(D=>{const I=D.student,O=(l.value[t.name]||{})[I]||[],W=_.filter(Ve=>!O.includes(Ve));o[I]=W}),o}function Ge(t){G.value=t,M.value=!0}function Te(t){if(G.value){const o=G.value.name;l.value[o]=t,console.log(`Saved fee category exceptions for ${o}:`,t)}M.value=!1}function Ie(t){console.log("Selection changed:",t)}function Me(){if(!P.value)return;p.value=!0,s.value="",g.value="",n.value=null;const t=f.value.map(m=>({fee_structure_name:m.name,fee_plan:m.selected_fee_plan,due_dates:m.feeSchedules.filter(D=>D.selected).map(D=>D.due_date)})),o=b.value.map(m=>m.name),_={};b.value.forEach(m=>{const D=l.value[m.name];D&&Object.keys(D).length>0&&(_[m.name]=D)}),y.value={class:R(i.value.selected_class),fee_structures:f.value.map(m=>m.name).join(", "),student_groups:o.join(", "),total_students:te(),schedule_count:ee(),excluded_categories:le()},N.submit({fee_structures:t,student_groups:o,student_exceptions:_})}function Pe(){i.value={selected_class:"",student_group:""},n.value=null,s.value="",g.value="",y.value=null,F.value={},l.value={},M.value=!1,G.value=null,C.data=null,x.data=null}return ie(()=>{console.log("Fee Schedule Creator mounted")}),{processing:p,errorMessage:s,successMessage:g,results:n,feePlans:v,formData:i,processingDetails:y,expandedStructures:F,showStudentList:M,selectedStudentGroup:G,classesResource:E,feeStructuresResource:C,studentGroupsResource:x,createFeeSchedulesResource:N,classesList:q,feeStructuresList:r,studentGroupsList:u,selectedStructures:f,selectedStructuresCount:h,selectedStudentGroups:b,isFormValid:P,onClassChange:fe,onStructureSelectionChange:ge,onFeePlanChange:ve,toggleStructureDetails:Se,selectAllStructures:pe,deselectAllStructures:be,selectAllGroups:ye,deselectAllGroups:Ce,selectAllSchedules:ke,deselectAllSchedules:Ae,extractFeePlanFromName:T,getInstallmentCount:K,calculateInstallmentAmount:ue,getScheduleDescription:_e,getClassName:R,getFeePlanLabel:Fe,getSelectedSchedulesCount:$,getTotalSchedulesCount:ee,getTotalStudents:te,getTotalExcludedStudents:xe,getTotalExcludedCategories:le,getSelectedStudentsCount:z,getExcludedCategoriesCount:De,hasFeeCategoryExceptions:Ee,getTotalAmount:we,formatScheduleDate:me,openStudentList:Ge,handleStudentListSave:Te,handleStudentListSelectionChange:Ie,getInitialSelections:Le,createFeeSchedulesAndInvoices:Me,resetForm:Pe}}},Ds={class:"enrollment-container"},ws={class:"scroll-view-content"},Ls={key:0,class:"modal-overlay"},Gs={class:"loading-modal"},Ts={key:0},Is={key:1,class:"modal-overlay fullscreen-modal"},Ms={class:"modal-content fullscreen-content scrollable-content"},Ps={class:"form-card"},Vs={key:0,class:"message error"},Ns={key:1,class:"message success"},js={class:"form-section"},Os={class:"form-grid"},qs={class:"form-group required"},Us=["disabled"],Ws=["value"],Qs={key:0,class:"field-hint"},Bs={key:2,class:"form-section"},zs={class:"selection-controls"},Js=["disabled"],Hs=["disabled"],Ys={class:"selection-count"},Ks={class:"table-container-wrapper"},Xs={class:"preview-table fee-structures-table"},Zs={class:"status-cell"},Rs=["onUpdate:modelValue","disabled","onChange"],$s={class:"fee-structure-info"},et={class:"fee-structure-name"},st={class:"fee-structure-meta"},tt={key:0},lt=["onUpdate:modelValue","disabled","onChange"],nt=["value"],ot={class:"total-amount"},at={class:"actions"},dt=["onClick","disabled"],ct={key:0,class:"fee-structure-expanded-details"},it={class:"fee-structure-details-section"},ut={class:"subsection-title"},rt={class:"details-grid"},_t={class:"detail-item"},ht={class:"value"},mt={class:"detail-item"},ft={class:"value"},gt={key:0,class:"detail-item"},vt={class:"value"},St={class:"detail-item"},pt={class:"value"},bt={key:0,class:"components-section"},yt={class:"components-table"},Ct={class:"installment-calculation"},kt={key:0},At={key:1,class:"text-muted"},Ft={key:0,class:"form-section"},xt={class:"subsection-title"},Et={class:"schedule-controls"},Dt=["onClick","disabled"],wt=["onClick","disabled"],Lt={class:"selection-count"},Gt={class:"table-container-wrapper"},Tt={class:"preview-table"},It={class:"status-cell"},Mt=["onUpdate:modelValue","disabled"],Pt=["onUpdate:modelValue","disabled"],Vt={class:"schedule-description"},Nt={key:3,class:"form-section"},jt={class:"selection-controls"},Ot=["disabled"],qt=["disabled"],Ut={class:"selection-count"},Wt={class:"table-container-wrapper"},Qt={class:"preview-table"},Bt={class:"status-cell"},zt=["onUpdate:modelValue","disabled"],Jt={key:0,class:"exceptions-badge"},Ht={class:"actions"},Yt=["onClick","disabled"],Kt={key:0,class:"summary-stats"},Xt={class:"stat-item"},Zt={class:"stat-value info"},Rt={class:"stat-item"},$t={class:"stat-value valid"},el={class:"stat-item"},sl={class:"stat-value warning"},tl={key:4,class:"summary-section"},ll={class:"summary-grid"},nl={class:"summary-item"},ol={class:"value"},al={class:"summary-item"},dl={class:"value"},cl={class:"summary-item"},il={class:"value"},ul={class:"summary-item"},rl={class:"value"},_l={class:"summary-item"},hl={class:"value"},ml={class:"summary-item"},fl={class:"value"},gl={class:"summary-item highlight"},vl={class:"value"},Sl={class:"selected-structures-in-summary"},pl={class:"structures-summary-grid"},bl={class:"structure-summary-header"},yl={class:"structure-name-plan"},Cl={class:"structure-title"},kl={class:"fee-plan-tag"},Al={class:"structure-amounts"},Fl={class:"total-amount"},xl={class:"schedule-count"},El={class:"structure-components-summary"},Dl={class:"component-name"},wl={class:"component-breakdown"},Ll={key:0},Gl={key:0,class:"schedule-preview"},Tl={class:"schedule-dates"},Il={key:0,class:"more-schedules"},Ml={class:"form-actions"},Pl=["disabled"],Vl={class:"button-content"},Nl={key:0,class:"spinner"},jl=["disabled"],Ol={key:2,class:"form-card summary-card"},ql={class:"message success"},Ul={class:"section-title"},Wl={class:"table-container-wrapper"},Ql={class:"preview-table"},Bl={class:"actions"},zl=["href"],Jl={class:"form-section"},Hl={class:"table-container-wrapper"},Yl={class:"preview-table"},Kl={key:0,class:"document-links"},Xl=["href"],Zl={key:0,class:"more-documents"},Rl={key:1,class:"document-links"},$l=["href"],en={key:0,class:"more-documents"},sn={key:2},tn={class:"actions"},ln={key:0,class:"status-badge success"},nn={key:1,class:"status-badge error"},on={class:"form-actions"};function an(p,s,g,n,y,F){var G;const M=Be("StudentList");return d(),c("div",Ds,[e("div",ws,[s[59]||(s[59]=e("div",{class:"header"},[e("h1",{class:"title"},"Create Fee Schedules & Invoices"),e("p",{class:"subtitle"},"Generate fee schedules and sales invoices for students")],-1)),n.processing?(d(),c("div",Ls,[e("div",Gs,[s[16]||(s[16]=e("div",{class:"loading-spinner"},null,-1)),s[17]||(s[17]=e("h3",{class:"loading-title"},"Processing Fee Schedules & Invoices",-1)),s[18]||(s[18]=e("p",{class:"loading-description"}," Please wait while we create fee schedules and generate invoices for all students. This may take a few minutes depending on the number of students. ",-1)),n.processingDetails?(d(),c("div",Ts,[s[15]||(s[15]=e("h4",null,"Processing Details",-1)),e("div",null,[e("div",null,[s[11]||(s[11]=e("strong",null,"Fee Structures:",-1)),w(" "+a(n.processingDetails.fee_structures),1)]),e("div",null,[s[12]||(s[12]=e("strong",null,"Student Groups:",-1)),w(" "+a(n.processingDetails.student_groups),1)]),e("div",null,[s[13]||(s[13]=e("strong",null,"Total Students:",-1)),w(" "+a(n.processingDetails.total_students),1)]),e("div",null,[s[14]||(s[14]=e("strong",null,"Total Schedules:",-1)),w(" "+a(n.processingDetails.schedule_count),1)])])])):S("",!0),s[19]||(s[19]=e("div",null,[e("div",{class:"spinner"}),w(" Creating fee schedules and invoices... ")],-1))])])):S("",!0),n.showStudentList?(d(),c("div",Is,[e("div",Ms,[Qe(M,{"student-group":n.selectedStudentGroup,"fee-structures":n.selectedStructures,"initial-selected-students":n.getInitialSelections(n.selectedStudentGroup),onSave:n.handleStudentListSave,onClose:s[0]||(s[0]=l=>n.showStudentList=!1),onSelectionChange:n.handleStudentListSelectionChange},null,8,["student-group","fee-structures","initial-selected-students","onSave","onSelectionChange"])])])):S("",!0),e("div",Ps,[s[51]||(s[51]=e("h2",{class:"form-title"},"Fee Schedule Configuration",-1)),n.errorMessage?(d(),c("div",Vs,[s[20]||(s[20]=e("strong",null,"Error:",-1)),w(" "+a(n.errorMessage),1)])):S("",!0),n.successMessage?(d(),c("div",Ns,[s[21]||(s[21]=e("strong",null,"Success:",-1)),w(" "+a(n.successMessage),1)])):S("",!0),e("div",js,[s[24]||(s[24]=e("h3",{class:"section-title"},"Basic Information",-1)),e("div",Os,[e("div",qs,[s[23]||(s[23]=e("label",null,"Class/Program",-1)),j(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>n.formData.selected_class=l),class:"picker",disabled:n.classesResource.loading||n.processing,onChange:s[2]||(s[2]=(...l)=>n.onClassChange&&n.onClassChange(...l))},[s[22]||(s[22]=e("option",{value:""},"Select Class/Program",-1)),(d(!0),c(k,null,A(n.classesList,l=>(d(),c("option",{key:l.name,value:l.name},a(l.program_name||l.name),9,Ws))),128))],40,Us),[[ae,n.formData.selected_class]]),n.classesResource.loading?(d(),c("span",Qs,"Loading classes...")):S("",!0)])])]),n.formData.selected_class&&n.feeStructuresList.length?(d(),c("div",Bs,[s[35]||(s[35]=e("h3",{class:"section-title"},"Select Fee Structures",-1)),e("div",zs,[e("button",{onClick:s[3]||(s[3]=(...l)=>n.selectAllStructures&&n.selectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,Js),e("button",{onClick:s[4]||(s[4]=(...l)=>n.deselectAllStructures&&n.deselectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,Hs),e("span",Ys,a(n.selectedStructuresCount)+" of "+a(n.feeStructuresList.length)+" selected ",1)]),e("div",Ks,[e("table",Xs,[s[27]||(s[27]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Fee Structure")]),e("th",null,[e("div",{class:"header-label"},"Fee Plan")]),e("th",null,[e("div",{class:"header-label"},"Total Amount")]),e("th",{width:"80px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.feeStructuresList,l=>{var v;return d(),c("tr",{key:l.name,class:de({"selected-row":l.selected})},[e("td",Zs,[j(e("input",{type:"checkbox","onUpdate:modelValue":i=>l.selected=i,disabled:n.processing,class:"custom-checkbox",onChange:i=>n.onStructureSelectionChange(l)},null,40,Rs),[[Y,l.selected]])]),e("td",null,[e("div",$s,[e("div",et,a(l.name),1),e("div",st,[w(a(l.program)+" • "+a(l.academic_year)+" ",1),l.academic_term?(d(),c("span",tt,"• "+a(l.academic_term),1)):S("",!0)])])]),e("td",null,[j(e("select",{"onUpdate:modelValue":i=>l.selected_fee_plan=i,class:"table-select",disabled:n.processing||!l.selected,onChange:i=>n.onFeePlanChange(l)},[s[25]||(s[25]=e("option",{value:""},"Select Plan",-1)),(d(!0),c(k,null,A(n.feePlans,i=>(d(),c("option",{key:i.value,value:i.value},a(i.label),9,nt))),128))],40,lt),[[ae,l.selected_fee_plan]])]),e("td",null,[e("div",ot," ₹"+a((v=l.total_amount)==null?void 0:v.toLocaleString()),1)]),e("td",at,[e("button",{class:de(["details-button",{expanded:n.expandedStructures[l.name]}]),onClick:i=>n.toggleStructureDetails(l.name),disabled:n.processing},s[26]||(s[26]=[e("span",{class:"icon"},"▼",-1),w(" Details ")]),10,dt)])],2)}),128))])])]),(d(!0),c(k,null,A(n.feeStructuresList,l=>{var v;return d(),c("div",{key:l.name+"_details"},[n.expandedStructures[l.name]?(d(),c("div",ct,[e("div",it,[e("h4",ut,"Fee Structure Details - "+a(l.name),1),e("div",rt,[e("div",_t,[s[28]||(s[28]=e("span",{class:"label"},"Total Amount:",-1)),e("span",ht,"₹"+a((v=l.total_amount)==null?void 0:v.toLocaleString()),1)]),e("div",mt,[s[29]||(s[29]=e("span",{class:"label"},"Academic Year:",-1)),e("span",ft,a(l.academic_year),1)]),l.academic_term?(d(),c("div",gt,[s[30]||(s[30]=e("span",{class:"label"},"Academic Term:",-1)),e("span",vt,a(l.academic_term),1)])):S("",!0),e("div",St,[s[31]||(s[31]=e("span",{class:"label"},"Selected Fee Plan:",-1)),e("span",pt,a(n.getFeePlanLabel(l.selected_fee_plan)||"Not selected"),1)])]),l.components&&l.components.length?(d(),c("div",bt,[s[33]||(s[33]=e("h5",{class:"subsubsection-title"},"Fee Components",-1)),e("div",yt,[e("table",null,[s[32]||(s[32]=e("thead",null,[e("tr",null,[e("th",null,"Fee Category"),e("th",null,"Amount"),e("th",null,"Discount"),e("th",null,"Total"),e("th",null,"Installment Calculation")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.components,i=>{var E,C,x,N;return d(),c("tr",{key:i.fees_category},[e("td",null,a(i.fees_category),1),e("td",null,"₹"+a((E=i.amount)==null?void 0:E.toLocaleString()),1),e("td",null,a(i.discount)+"%",1),e("td",null,"₹"+a((C=i.total)==null?void 0:C.toLocaleString()),1),e("td",Ct,[l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(d(),c("span",kt," ₹"+a((x=i.total)==null?void 0:x.toLocaleString())+" ÷ "+a(n.getInstallmentCount(l.selected_fee_plan))+" months = ₹"+a((N=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:N.toLocaleString()),1)):(d(),c("span",At,"Full amount"))])])}),128))])])])])):S("",!0)]),l.selected_fee_plan&&l.feeSchedules&&l.feeSchedules.length?(d(),c("div",Ft,[e("h4",xt,"Fee Schedule Distribution - "+a(l.name),1),e("div",Et,[e("button",{onClick:i=>n.selectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Select All ",8,Dt),e("button",{onClick:i=>n.deselectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,wt),e("span",Lt,a(n.getSelectedSchedulesCount(l))+" of "+a(l.feeSchedules.length)+" schedules selected ",1)]),e("div",Gt,[e("table",Tt,[s[34]||(s[34]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Due Date")]),e("th",null,[e("div",{class:"header-label"},"Amount")]),e("th",null,[e("div",{class:"header-label"},"Description")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.feeSchedules,(i,E)=>{var C;return d(),c("tr",{key:E},[e("td",It,[j(e("input",{type:"checkbox","onUpdate:modelValue":x=>i.selected=x,disabled:n.processing,class:"custom-checkbox"},null,8,Mt),[[Y,i.selected]])]),e("td",null,[j(e("input",{type:"date","onUpdate:modelValue":x=>i.due_date=x,disabled:n.processing,class:"table-input"},null,8,Pt),[[ze,i.due_date]])]),e("td",null,"₹"+a((C=i.amount)==null?void 0:C.toLocaleString()),1),e("td",Vt,a(n.getScheduleDescription(l.selected_fee_plan,E)),1)])}),128))])])])])):S("",!0)])):S("",!0)])}),128))])):S("",!0),n.selectedStructuresCount>0&&n.studentGroupsList.length?(d(),c("div",Nt,[s[40]||(s[40]=e("h3",{class:"section-title"},"Select Student Groups",-1)),e("div",jt,[e("button",{onClick:s[5]||(s[5]=(...l)=>n.selectAllGroups&&n.selectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,Ot),e("button",{onClick:s[6]||(s[6]=(...l)=>n.deselectAllGroups&&n.deselectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,qt),e("span",Ut,a(n.selectedStudentGroups.length)+" of "+a(n.studentGroupsList.length)+" groups selected ",1)]),e("div",Wt,[e("table",Qt,[s[36]||(s[36]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Student Group")]),e("th",null,[e("div",{class:"header-label"},"Total Students")]),e("th",null,[e("div",{class:"header-label"},"Selected Students")]),e("th",{width:"100px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.studentGroupsList,l=>(d(),c("tr",{key:l.name},[e("td",Bt,[j(e("input",{type:"checkbox","onUpdate:modelValue":v=>l.selected=v,disabled:n.processing,class:"custom-checkbox"},null,8,zt),[[Y,l.selected]])]),e("td",null,a(l.name),1),e("td",null,a(l.total_students),1),e("td",null,[w(a(n.getSelectedStudentsCount(l))+" / "+a(l.total_students)+" ",1),n.getSelectedStudentsCount(l)<l.total_students?(d(),c("span",Jt," ("+a(l.total_students-n.getSelectedStudentsCount(l))+" excluded) ",1)):S("",!0)]),e("td",Ht,[e("button",{onClick:v=>n.openStudentList(l),class:"edit-button",disabled:n.processing}," Edit Students ",8,Yt)])]))),128))])])]),n.selectedStudentGroups.length>0?(d(),c("div",Kt,[e("div",Xt,[s[37]||(s[37]=e("span",{class:"stat-label"},"Selected Groups",-1)),e("span",Zt,a(n.selectedStudentGroups.length),1)]),e("div",Rt,[s[38]||(s[38]=e("span",{class:"stat-label"},"Total Students",-1)),e("span",$t,a(n.getTotalStudents()),1)]),e("div",el,[s[39]||(s[39]=e("span",{class:"stat-label"},"Excluded Students",-1)),e("span",sl,a(n.getTotalExcludedStudents()),1)])])):S("",!0)])):S("",!0),n.isFormValid?(d(),c("div",tl,[s[50]||(s[50]=e("h3",{class:"section-title"},"Summary",-1)),e("div",ll,[e("div",nl,[s[41]||(s[41]=e("span",{class:"label"},"Class:",-1)),e("span",ol,a(n.getClassName(n.formData.selected_class)),1)]),e("div",al,[s[42]||(s[42]=e("span",{class:"label"},"Fee Structures:",-1)),e("span",dl,a(n.selectedStructuresCount)+" structures",1)]),e("div",cl,[s[43]||(s[43]=e("span",{class:"label"},"Student Groups:",-1)),e("span",il,a(n.selectedStudentGroups.length)+" groups",1)]),e("div",ul,[s[44]||(s[44]=e("span",{class:"label"},"Total Students:",-1)),e("span",rl,a(n.getTotalStudents()),1)]),e("div",_l,[s[45]||(s[45]=e("span",{class:"label"},"Excluded Students:",-1)),e("span",hl,a(n.getTotalExcludedStudents()),1)]),e("div",ml,[s[46]||(s[46]=e("span",{class:"label"},"Total Schedules:",-1)),e("span",fl,a(n.getTotalSchedulesCount()),1)]),e("div",gl,[s[47]||(s[47]=e("span",{class:"label"},"Total Amount:",-1)),e("span",vl,"₹"+a((G=n.getTotalAmount())==null?void 0:G.toLocaleString()),1)])]),e("div",Sl,[s[49]||(s[49]=e("h4",{class:"subsection-title"},"Selected Fee Structures",-1)),e("div",pl,[(d(!0),c(k,null,A(n.selectedStructures,l=>{var v;return d(),c("div",{key:l.name,class:"structure-summary-card"},[e("div",bl,[e("div",yl,[e("h5",Cl,a(l.name),1),e("span",kl,a(n.getFeePlanLabel(l.selected_fee_plan)),1)]),e("div",Al,[e("span",Fl,"₹"+a((v=l.total_amount)==null?void 0:v.toLocaleString()),1),e("span",xl,a(n.getSelectedSchedulesCount(l))+" schedules",1)])]),e("div",El,[(d(!0),c(k,null,A(l.components,i=>{var E,C;return d(),c("div",{key:i.fees_category,class:"component-summary"},[e("span",Dl,a(i.fees_category),1),e("span",wl,[w(" ₹"+a((E=i.total)==null?void 0:E.toLocaleString())+" ",1),l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(d(),c("span",Ll," (₹"+a((C=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:C.toLocaleString())+" × "+a(n.getInstallmentCount(l.selected_fee_plan))+") ",1)):S("",!0)])])}),128))]),l.feeSchedules&&l.feeSchedules.filter(i=>i.selected).length>0?(d(),c("div",Gl,[s[48]||(s[48]=e("div",{class:"schedule-preview-title"},"Schedule:",-1)),e("div",Tl,[(d(!0),c(k,null,A(l.feeSchedules.filter(i=>i.selected).slice(0,3),(i,E)=>(d(),c("span",{key:E,class:"schedule-date-tag"},a(n.formatScheduleDate(i.due_date)),1))),128)),l.feeSchedules.filter(i=>i.selected).length>3?(d(),c("span",Il," +"+a(l.feeSchedules.filter(i=>i.selected).length-3)+" more ",1)):S("",!0)])])):S("",!0)])}),128))])])])):S("",!0),e("div",Ml,[e("button",{onClick:s[7]||(s[7]=(...l)=>n.createFeeSchedulesAndInvoices&&n.createFeeSchedulesAndInvoices(...l)),class:"enroll-button",disabled:!n.isFormValid||n.processing},[e("span",Vl,[n.processing?(d(),c("span",Nl)):S("",!0),w(" "+a(n.processing?"Processing...":`Create Fee Schedules for ${n.selectedStructuresCount} Structures`),1)])],8,Pl),e("button",{onClick:s[8]||(s[8]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"reset-button",disabled:n.processing}," Reset Form ",8,jl)])]),n.results&&n.results.success?(d(),c("div",Ol,[s[58]||(s[58]=e("h2",{class:"form-title"},"Creation Results",-1)),e("div",ql,[s[52]||(s[52]=e("strong",null,"Successfully Created!",-1)),w(" "+a(n.results.message),1)]),(d(!0),c(k,null,A(n.results.structure_results,l=>(d(),c("div",{key:l.fee_structure,class:"form-section"},[e("h3",Ul,"Fee Schedules Created - "+a(l.fee_structure),1),e("div",Wl,[e("table",Ql,[s[53]||(s[53]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Action")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(l.fee_schedules,v=>(d(),c("tr",{key:v},[e("td",null,a(v),1),e("td",Bl,[e("a",{href:`/app/fee-schedule/${v}`,target:"_blank",class:"primary-button",style:{padding:"0.5rem 1rem","font-size":"0.9rem","text-decoration":"none",display:"inline-block"}}," View ",8,zl)])]))),128))])])])]))),128)),e("div",Jl,[s[57]||(s[57]=e("h3",{class:"section-title"},"Invoice Results Summary",-1)),e("div",Hl,[e("table",Yl,[s[56]||(s[56]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Students Processed"),e("th",null,"Created Documents"),e("th",null,"Actions")])],-1)),e("tbody",null,[(d(!0),c(k,null,A(n.results.invoice_results,l=>(d(),c("tr",{key:l.fee_schedule},[e("td",null,a(l.fee_schedule),1),e("td",null,a(l.result.created_count)+"/"+a(l.result.total_students),1),e("td",null,[l.result.submitted_invoices&&l.result.submitted_invoices.length>0?(d(),c("div",Kl,[s[54]||(s[54]=e("strong",null,"Invoices:",-1)),(d(!0),c(k,null,A(l.result.submitted_invoices.slice(0,3),v=>(d(),c("div",{key:v,class:"document-link"},[e("a",{href:`/app/sales-invoice/${v}`,target:"_blank",class:"link"},a(v),9,Xl)]))),128)),l.result.submitted_invoices.length>3?(d(),c("div",Zl," +"+a(l.result.submitted_invoices.length-3)+" more invoices ",1)):S("",!0)])):S("",!0),l.result.submitted_orders&&l.result.submitted_orders.length>0?(d(),c("div",Rl,[s[55]||(s[55]=e("strong",null,"Orders:",-1)),(d(!0),c(k,null,A(l.result.submitted_orders.slice(0,3),v=>(d(),c("div",{key:v,class:"document-link"},[e("a",{href:`/app/sales-order/${v}`,target:"_blank",class:"link"},a(v),9,$l)]))),128)),l.result.submitted_orders.length>3?(d(),c("div",en," +"+a(l.result.submitted_orders.length-3)+" more orders ",1)):S("",!0)])):S("",!0),!l.result.submitted_invoices&&!l.result.submitted_orders?(d(),c("div",sn," No documents created ")):S("",!0)]),e("td",tn,[l.result.success?(d(),c("span",ln,"Success")):(d(),c("span",nn,"Failed"))])]))),128))])])])]),e("div",on,[e("button",{onClick:s[9]||(s[9]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"success-button"}," Create Another "),e("button",{onClick:s[10]||(s[10]=l=>n.results=null),class:"secondary-button"}," Close Results ")])])):S("",!0)])])}const rn=ce(Es,[["render",an],["__scopeId","data-v-24f25bf6"]]);export{rn as default};
