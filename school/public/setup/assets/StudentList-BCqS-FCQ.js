import{_ as W,r as j,c as A,j as H,x as E,o,a,b as s,t as d,i as g,F as G,l as N,n as K,g as P,e as Q,I as X}from"./index-BhxGw4-h.js";import{S as Y}from"./StudentAvatar-CS1o3-Mh.js";const Z={class:"student-list-container"},ee={class:"student-list-header"},te={class:"student-list-title"},se={class:"header-actions"},le={class:"summary-stats"},ne={class:"stat-item"},oe={class:"stat-value"},ae={key:0,class:"stat-item"},ce={class:"stat-value"},ue={key:1,class:"stat-item"},ie={class:"stat-value"},de={key:2,class:"stat-item"},re={class:"stat-value"},ge={key:0,class:"bulk-actions"},_e={class:"bulk-buttons"},ve=["onClick"],he={key:1,class:"bulk-actions"},me={class:"bulk-buttons"},fe=["disabled"],be={class:"students-grid"},ke=["onClick"],Se={key:0,class:"student-selection-checkbox"},pe={class:"selection-checkbox-label"},ye=["checked","onChange"],Ce={key:1,class:"student-edit-button"},xe=["onClick"],Ae={class:"student-basic-info"},Ee={class:"student-details"},Ge={class:"student-name"},Ne={class:"student-roll"},Fe={class:"student-id"},Oe={key:2,class:"fee-categories-section"},je={class:"fee-categories-checkboxes"},we={class:"checkbox-label"},$e=["checked","onChange"],ze={class:"category-info"},Be={class:"category-name"},De={class:"category-amount"},Ie={class:"student-selection-summary"},Le={class:"summary-text"},Me={key:0,class:"no-selection-warning"},Ue={key:1,class:"partial-selection-warning"},Ve={key:3,class:"no-categories-message"},Je={key:2,class:"empty-state"},Te={key:3,class:"actions-footer"},qe={__name:"StudentList",props:{studentGroup:{type:Object,required:!0,default:()=>({})},feeStructures:{type:Array,default:()=>[]},initialSelections:{type:Object,default:()=>({})},mode:{type:String,default:"fee-schedule"}},emits:["save","close","student-clicked","student-deleted","refresh","students-selected-for-delete"],setup(h,{emit:w}){const u=h,k=w,r=j({}),v=j(new Set),c=A(()=>u.mode==="fee-schedule"),_=A(()=>{if(!c.value)return[];const e=[];return u.feeStructures.forEach(t=>{t.components&&t.components.forEach(n=>{n.fees_category&&!e.find(l=>l.fees_category===n.fees_category)&&e.push({fees_category:n.fees_category,amount:n.amount,discount:n.discount,total:n.total})})}),e}),S=A(()=>v.value.size),$=(e,t)=>{var n;return((n=r.value[e])==null?void 0:n.includes(t))||!1},F=(e,t,n)=>{r.value[e]||(r.value[e]=[]);const l=r.value[e];if(n)l.includes(t)||l.push(t);else{const i=l.indexOf(t);i>-1&&l.splice(i,1)}},m=e=>{var t;return((t=r.value[e])==null?void 0:t.length)||0},z=()=>Object.values(r.value).filter(e=>e.length<_.value.length).length,B=e=>{var t;(t=u.studentGroup.students)==null||t.forEach(n=>{F(n.student,e,!0)})},D=()=>{var e;(e=u.studentGroup.students)==null||e.forEach(t=>{r.value[t.student]=_.value.map(n=>n.fees_category)})},I=()=>{var e;(e=u.studentGroup.students)==null||e.forEach(t=>{r.value[t.student]=[]})},L=()=>{r.value={}},p=()=>{var t;const e={};(t=u.studentGroup.students)==null||t.forEach(n=>{const l=n.student,i=r.value[l]||[],b=_.value.map(x=>x.fees_category).filter(x=>!i.includes(x));b.length>0&&(e[l]=b)}),k("save",e)},y=e=>v.value.has(e),O=(e,t)=>{t?v.value.add(e):v.value.delete(e)},M=e=>{const t=y(e.student);O(e.student,!t)},U=()=>{var e;(e=u.studentGroup.students)==null||e.forEach(t=>{v.value.add(t.student)})},V=()=>{v.value.clear()},J=()=>{if(v.value.size===0)return;const e=Array.from(v.value);k("students-selected-for-delete",e)},T=e=>{console.log("ðŸ“¤ Emitting student data for edit:",{student:e.student,student_name:e.student_name,group_roll_number:e.group_roll_number,student_image:e.student_image,address:e.address,mobile:e.mobile}),k("student-clicked",{student:e.student,student_name:e.student_name,group_roll_number:e.group_roll_number,student_image:e.student_image,address:e.address,mobile:e.mobile})},q=e=>{const t=e.student_image||e.img_url||e.image||"";return console.log("ðŸ–¼ï¸ Student image debug:",{student:e.student,student_image:e.student_image,img_url:e.img_url,image:e.image,finalUrl:t}),t},R=e=>{console.log("Image failed to load",e)},f=()=>{var e;if(c.value){if(u.initialSelections&&Object.keys(u.initialSelections).length>0&&Object.values(u.initialSelections).some(n=>Array.isArray(n)&&n.length>0)){r.value=JSON.parse(JSON.stringify(u.initialSelections));return}r.value={},(e=u.studentGroup.students)==null||e.forEach(t=>{r.value[t.student]=_.value.map(n=>n.fees_category)})}};return H(()=>{c.value&&f()}),E(()=>u.initialSelections,e=>{c.value&&e&&Object.keys(e).length>0&&f()},{deep:!0}),E(()=>u.studentGroup,()=>{c.value&&f()},{deep:!0}),E(()=>u.feeStructures,()=>{c.value&&X(()=>{f()})},{deep:!0}),(e,t)=>{var n;return o(),a("div",Z,[s("div",ee,[s("h3",te,d(c.value?h.studentGroup.name+" - Fee Category Selection":h.studentGroup.name+" - Student Management"),1),s("div",se,[c.value?(o(),a("button",{key:0,onClick:p,class:"save-button"}," Save Selections ")):g("",!0),c.value?(o(),a("button",{key:1,onClick:t[0]||(t[0]=l=>e.$emit("close")),class:"close-button"}," Close ")):g("",!0)])]),s("div",le,[s("div",ne,[t[1]||(t[1]=s("span",{class:"stat-label"},"Total Students:",-1)),s("span",oe,d(((n=h.studentGroup.students)==null?void 0:n.length)||0),1)]),c.value?(o(),a("div",ae,[t[2]||(t[2]=s("span",{class:"stat-label"},"Fee Categories:",-1)),s("span",ce,d(_.value.length),1)])):g("",!0),c.value?(o(),a("div",ue,[t[3]||(t[3]=s("span",{class:"stat-label"},"Students with Exceptions:",-1)),s("span",ie,d(z()),1)])):g("",!0),c.value?g("",!0):(o(),a("div",de,[t[4]||(t[4]=s("span",{class:"stat-label"},"Selected Students:",-1)),s("span",re,d(S.value),1)]))]),c.value?(o(),a("div",ge,[t[5]||(t[5]=s("h4",{class:"bulk-actions-title"},"Bulk Actions",-1)),s("div",_e,[(o(!0),a(G,null,N(_.value,l=>(o(),a("button",{key:l.fees_category,onClick:i=>B(l.fees_category),class:"bulk-category-button"}," Select "+d(l.fees_category)+" for All ",9,ve))),128)),s("button",{onClick:D,class:"bulk-category-button"}," Select All Categories for All "),s("button",{onClick:I,class:"bulk-clear-button"}," Clear All Selections "),s("button",{onClick:p,class:"bulk-save-button"}," Save Selections ")])])):g("",!0),c.value?g("",!0):(o(),a("div",he,[t[6]||(t[6]=s("h4",{class:"bulk-actions-title"},"Student Selection",-1)),s("div",me,[s("button",{onClick:U,class:"bulk-category-button"}," Select All "),s("button",{onClick:V,class:"bulk-category-button"}," Unselect All "),s("button",{onClick:J,class:"bulk-delete-button",disabled:S.value===0}," Delete Selected ("+d(S.value)+") ",9,fe)])])),s("div",be,[(o(!0),a(G,null,N(h.studentGroup.students,l=>(o(),a("div",{key:l.student,class:K(["student-card",{"selected-student":y(l.student),"compact-card":!c.value}]),onClick:i=>c.value?null:M(l)},[c.value?g("",!0):(o(),a("div",Se,[s("label",pe,[s("input",{type:"checkbox",checked:y(l.student),onChange:i=>O(l.student,i.target.checked),class:"student-checkbox"},null,40,ye),t[7]||(t[7]=s("span",{class:"selection-checkbox-custom"},null,-1))])])),c.value?g("",!0):(o(),a("div",Ce,[s("button",{onClick:P(i=>T(l),["stop"]),class:"edit-button",title:"Edit Student"}," âœï¸ ",8,xe)])),s("div",Ae,[Q(Y,{"image-url":q(l),"student-name":l.student_name,"alt-text":"Student",onError:R},null,8,["image-url","student-name"]),s("div",Ee,[s("h4",Ge,d(l.student_name),1),s("p",Ne,"Roll No: "+d(l.group_roll_number),1),s("p",Fe,d(l.student),1)])]),c.value&&_.value.length>0?(o(),a("div",Oe,[t[9]||(t[9]=s("h5",{class:"fee-categories-title"},"Select Fee Categories",-1)),s("div",je,[(o(!0),a(G,null,N(_.value,i=>{var C;return o(),a("div",{key:i.fees_category,class:"fee-category-checkbox"},[s("label",we,[s("input",{type:"checkbox",checked:$(l.student,i.fees_category),onChange:b=>F(l.student,i.fees_category,b.target.checked),class:"category-checkbox"},null,40,$e),t[8]||(t[8]=s("span",{class:"checkbox-custom"},null,-1)),s("span",ze,[s("span",Be,d(i.fees_category),1),s("span",De,"â‚¹"+d((C=i.total)==null?void 0:C.toLocaleString()),1)])])])}),128))]),s("div",Ie,[s("span",Le," Selected: "+d(m(l.student))+"/"+d(_.value.length)+" categories ",1),m(l.student)===0?(o(),a("span",Me," (No fee categories selected) ")):m(l.student)<_.value.length?(o(),a("span",Ue," ("+d(_.value.length-m(l.student))+" excluded) ",1)):g("",!0)])])):c.value?(o(),a("div",Ve,t[10]||(t[10]=[s("p",null,"No fee categories available",-1)]))):g("",!0)],10,ke))),128))]),!h.studentGroup.students||h.studentGroup.students.length===0?(o(),a("div",Je,t[11]||(t[11]=[s("p",{class:"empty-message"},"No students found in this group",-1)]))):g("",!0),c.value?(o(),a("div",Te,[s("button",{onClick:p,class:"save-button"}," Save Fee Category Selections "),s("button",{onClick:L,class:"clear-button"}," Clear All ")])):g("",!0)])}}},He=W(qe,[["__scopeId","data-v-e115c161"]]);export{He as S};
