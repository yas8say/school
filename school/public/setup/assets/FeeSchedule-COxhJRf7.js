var Ve=Object.defineProperty,Ne=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var je=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var oe=(v,s,h)=>s in v?Ve(v,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):v[s]=h,H=(v,s)=>{for(var h in s||(s={}))je.call(s,h)&&oe(v,h,s[h]);if(ne)for(var h of ne(s))qe.call(s,h)&&oe(v,h,s[h]);return v},B=(v,s)=>Ne(v,Ue(s));import{_ as Oe,r as D,C as Q,c as x,j as Qe,a as d,b as e,h as b,t as a,i as _,e as We,y as I,A as ae,F as p,l as y,f as He,o as c,n as de,H as z,z as Be}from"./index-BhxGw4-h.js";import{S as ze}from"./StudentList-BCqS-FCQ.js";/* empty css             */import"./StudentAvatar-CS1o3-Mh.js";const Je={name:"FeeScheduleCreator",components:{StudentList:ze},setup(){const v=D(!1),s=D(""),h=D(""),n=D(null),G=D(null),w=D({}),M=D(!1),E=D(null),l=D({}),m=D([{value:"Monthly",label:"Monthly"},{value:"Quarterly",label:"Quarterly"},{value:"Semi-Annually",label:"Semi-Annually"},{value:"Annually",label:"Annually"},{value:"Term-Wise",label:"Term-Wise"}]),i=D({selected_class:"",student_group:""}),C=Q({url:"school.al_ummah.api3.get_classes",auto:!0,onSuccess:t=>{console.log("Classes loaded:",t)},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load classes",console.error("Error loading classes:",t)}}),f=Q({url:"school.al_ummah.api5.get_fee_structures_for_selection",onSuccess:t=>{console.log("Fee structures loaded:",t),t&&t.success&&t.fee_structures&&t.fee_structures.forEach(o=>{o.selected=!1,o.selected_fee_plan=q(o.name)||"",o.feeSchedules=[],o.selected_fee_plan&&O(o)})},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load fee structures",console.error("Error loading fee structures:",t)}}),S=Q({url:"school.al_ummah.api5.get_student_groups",onSuccess:t=>{console.log("Student groups loaded:",t),t&&t.success&&t.student_groups&&t.student_groups.forEach(o=>{o.selected=!0,l.value[o.name]||(l.value[o.name]={})})},onError:t=>{var o;s.value=((o=t.messages)==null?void 0:o[0])||"Failed to load student groups",console.error("Error loading student groups:",t)}}),P=Q({url:"school.al_ummah.api5.create_and_submit_fee_schedules_with_invoices",method:"POST",onSuccess:t=>{v.value=!1,G.value=null,n.value=t,h.value=t.message,s.value="",console.log("Fee schedules and invoices created:",t)},onError:t=>{var o;v.value=!1,G.value=null,s.value=((o=t.messages)==null?void 0:o[0])||"Failed to create fee schedules and invoices",console.error("Error creating fee schedules:",t)}}),ce=x(()=>f.data&&f.data.success&&f.data.fee_schedules_count||0),J=x(()=>C.data||[]),N=x(()=>f.data&&f.data.success?f.data.fee_structures:[]),U=x(()=>S.data&&S.data.success?S.data.student_groups:[]),L=x(()=>N.value.filter(t=>t.selected&&t.selected_fee_plan&&t.feeSchedules&&t.feeSchedules.length>0)),j=x(()=>L.value.length),T=x(()=>U.value.filter(t=>t.selected)),Y=x(()=>i.value.selected_class&&j.value>0&&T.value.length>0);function q(t){const o=t.toLowerCase();return o.includes("monthly")?"Monthly":o.includes("quarterly")?"Quarterly":o.includes("semi-annually")||o.includes("semi annually")?"Semi-Annually":o.includes("annually")||o.includes("annual")?"Annually":o.includes("term")||o.includes("term-wise")?"Term-Wise":""}function K(t){return{Monthly:12,Quarterly:4,"Semi-Annually":2,Annually:1,"Term-Wise":3}[t]||1}function ie(t,o){const u=K(o);return parseFloat((t/u).toFixed(2))}function O(t){if(!t.selected_fee_plan)return;const o=t.total_amount,u=t.selected_fee_plan,r=ue(u,o);t.feeSchedules=r.map(g=>B(H({},g),{selected:!0,due_date:g.due_date||_e()}))}function ue(t,o){const u=new Date,r=[],A={Monthly:{frequency:12,gap:1},Quarterly:{frequency:4,gap:3},"Semi-Annually":{frequency:2,gap:6},Annually:{frequency:1,gap:12},"Term-Wise":{frequency:3,gap:4}}[t];if(!A)return[];const F=o/A.frequency;for(let k=1;k<=A.frequency;k++){const V=new Date(u);V.setMonth(u.getMonth()+A.gap*k),r.push({due_date:X(V),amount:parseFloat(F.toFixed(2))})}return r}function re(t,o,u=null){if(u){const A=new Date(u),F=A.toLocaleDateString("en-US",{month:"long"}),k=A.getFullYear();return{Monthly:`${F} ${k}`,Quarterly:`Quarter ${Math.floor(o/3)+1} - ${F} ${k}`,"Semi-Annually":o===0?`First Half - ${F} ${k}`:`Second Half - ${F} ${k}`,Annually:`Annual Fee - ${k}`,"Term-Wise":`Term ${o+1} - ${F} ${k}`}[t]||`${F} ${k} - Installment ${o+1}`}return{Monthly:["January","February","March","April","May","June","July","August","September","October","November","December"][o]||`Month ${o+1}`,Quarterly:`Quarter ${o+1}`,"Semi-Annually":o===0?"First Half":"Second Half",Annually:"Annual Fee","Term-Wise":`Term ${o+1}`}[t]||`Installment ${o+1}`}function _e(){const t=new Date;return t.setDate(t.getDate()+30),X(t)}function X(t){const o=t.getFullYear(),u=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${o}-${u}-${r}`}function me(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Not set"}function fe(){i.value.student_group="",n.value=null,h.value="",s.value="",w.value={},l.value={},i.value.selected_class?(f.update({params:{program:i.value.selected_class}}),f.reload()):f.data=null}function he(t){t.selected?t.selected&&!t.selected_fee_plan&&(t.selected_fee_plan=q(t.name)||"",t.selected_fee_plan&&O(t)):(t.selected_fee_plan="",t.feeSchedules=[]),j.value>0&&!S.data&&Z()}function ge(t){t.selected_fee_plan?O(t):t.feeSchedules=[]}function Z(){i.value.selected_class&&(S.update({params:{program:i.value.selected_class}}),S.reload())}function ve(t){w.value=B(H({},w.value),{[t]:!w.value[t]})}function Se(){N.value.forEach(t=>{t.selected=!0,t.selected_fee_plan||(t.selected_fee_plan=q(t.name)||"",t.selected_fee_plan&&O(t))}),j.value>0&&Z()}function be(){N.value.forEach(t=>{t.selected=!1,t.selected_fee_plan="",t.feeSchedules=[]})}function pe(){U.value.forEach(t=>{t.selected=!0})}function ye(){U.value.forEach(t=>{t.selected=!1})}function Ce(t){t.feeSchedules&&t.feeSchedules.forEach(o=>{o.selected=!0})}function ke(t){t.feeSchedules&&t.feeSchedules.forEach(o=>{o.selected=!1})}function R(t){const o=J.value.find(u=>u.name===t);return o?o.program_name||o.name:t}function Fe(t){const o=m.value.find(u=>u.value===t);return o?o.label:t}function $(t){return t.feeSchedules?t.feeSchedules.filter(o=>o.selected).length:0}function ee(){return L.value.reduce((t,o)=>t+$(o),0)}function se(){const t=[];return L.value.forEach(o=>{o.components&&o.components.forEach(u=>{t.includes(u.fees_category)||t.push(u.fees_category)})}),t}function W(t){const o=t.total_students||0,u=l.value[t.name]||{},r=se();if(r.length===0)return o;const g=Object.keys(u).filter(A=>(u[A]||[]).length===r.length).length;return o-g}function te(){return T.value.reduce((t,o)=>t+W(o),0)}function Ae(){let t=0;return T.value.forEach(o=>{const u=o.total_students||0,r=W(o);t+=u-r}),t}function De(t){const o=l.value[t.name];return o&&Object.keys(o).length>0}function Ee(t){const o=l.value[t.name];if(!o)return 0;let u=0;return Object.values(o).forEach(r=>{u+=r.length}),u}function le(){let t=0;return T.value.forEach(o=>{const u=l.value[o.name];u&&Object.values(u).forEach(r=>{t+=r.length})}),t}function xe(){return L.value.reduce((t,o)=>t+(o.total_amount||0),0)}function we(t){var g;if(!t)return{};const o={},u=se(),r=l.value[t.name]||{};return(g=t.students)==null||g.forEach(A=>{const F=A.student,k=r[F]||[],V=u.filter(Pe=>!k.includes(Pe));o[F]=V}),console.log("ðŸŽ¯ Initial selections for",t.name,":",o),o}function Le(t){E.value=t,M.value=!0}function Te(t){if(E.value){const o=E.value.name;l.value[o]=t,console.log(`ðŸ’¾ Saved fee category exceptions for ${o}:`,t),console.log("ðŸ“Š Total students with exceptions:",Object.keys(t).length)}M.value=!1}function Ge(t){console.log("Selection changed:",t)}function Me(){if(!Y.value)return;v.value=!0,s.value="",h.value="",n.value=null;const t=L.value.map(r=>({fee_structure_name:r.name,fee_plan:r.selected_fee_plan,due_dates:r.feeSchedules.filter(g=>g.selected).map(g=>g.due_date)})),o=T.value.map(r=>r.name),u={};T.value.forEach(r=>{const g=l.value[r.name];g&&Object.keys(g).length>0&&(u[r.name]=g)}),G.value={class:R(i.value.selected_class),fee_structures:L.value.map(r=>r.name).join(", "),student_groups:o.join(", "),total_students:te(),schedule_count:ee(),excluded_categories:le()},P.submit({fee_structures:t,student_groups:o,student_exceptions:u})}function Ie(){i.value={selected_class:"",student_group:""},n.value=null,s.value="",h.value="",G.value=null,w.value={},l.value={},M.value=!1,E.value=null,f.data=null,S.data=null}return Qe(()=>{console.log("Fee Schedule Creator mounted")}),{processing:v,errorMessage:s,successMessage:h,results:n,feePlans:m,formData:i,processingDetails:G,expandedStructures:w,showStudentList:M,selectedStudentGroup:E,classesResource:C,feeStructuresResource:f,studentGroupsResource:S,createFeeSchedulesResource:P,classesList:J,feeStructuresList:N,studentGroupsList:U,selectedStructures:L,selectedStructuresCount:j,selectedStudentGroups:T,isFormValid:Y,feeSchedulesCount:ce,onClassChange:fe,onStructureSelectionChange:he,onFeePlanChange:ge,toggleStructureDetails:ve,selectAllStructures:Se,deselectAllStructures:be,selectAllGroups:pe,deselectAllGroups:ye,selectAllSchedules:Ce,deselectAllSchedules:ke,extractFeePlanFromName:q,getInstallmentCount:K,calculateInstallmentAmount:ie,getScheduleDescription:re,getClassName:R,getFeePlanLabel:Fe,getSelectedSchedulesCount:$,getTotalSchedulesCount:ee,getTotalStudents:te,getTotalExcludedStudents:Ae,getTotalExcludedCategories:le,getSelectedStudentsCount:W,getExcludedCategoriesCount:Ee,hasFeeCategoryExceptions:De,getTotalAmount:xe,formatScheduleDate:me,openStudentList:Le,handleStudentListSave:Te,handleStudentListSelectionChange:Ge,getInitialSelections:we,createFeeSchedulesAndInvoices:Me,resetForm:Ie}}},Ye={class:"enrollment-container"},Ke={class:"scroll-view-content"},Xe={key:0,class:"modal-overlay"},Ze={class:"loading-modal"},Re={key:0},$e={key:1,class:"modal-overlay fullscreen-modal"},es={class:"modal-content fullscreen-content scrollable-content"},ss={class:"form-card"},ts={key:0,class:"message error"},ls={key:1,class:"message success"},ns={class:"form-section"},os={class:"form-grid"},as={class:"form-group required"},ds=["disabled"],cs=["value"],is={key:0,class:"field-hint"},us={key:0,class:"info-note"},rs={class:"note-content"},_s={key:2,class:"form-section"},ms={class:"selection-controls"},fs=["disabled"],hs=["disabled"],gs={class:"selection-count"},vs={class:"table-container-wrapper"},Ss={class:"preview-table fee-structures-table"},bs={class:"status-cell"},ps=["onUpdate:modelValue","disabled","onChange"],ys={class:"fee-structure-info"},Cs={class:"fee-structure-name"},ks={class:"fee-structure-meta"},Fs={key:0},As=["onUpdate:modelValue","disabled","onChange"],Ds=["value"],Es={class:"total-amount"},xs={class:"actions"},ws=["onClick","disabled"],Ls={key:0,class:"fee-structure-expanded-details"},Ts={class:"fee-structure-details-section"},Gs={class:"subsection-title"},Ms={class:"details-grid"},Is={class:"detail-item"},Ps={class:"value"},Vs={class:"detail-item"},Ns={class:"value"},Us={key:0,class:"detail-item"},js={class:"value"},qs={class:"detail-item"},Os={class:"value"},Qs={key:0,class:"components-section"},Ws={class:"components-table"},Hs={class:"installment-calculation"},Bs={key:0},zs={key:1,class:"text-muted"},Js={key:0,class:"form-section"},Ys={class:"subsection-title"},Ks={class:"schedule-controls"},Xs=["onClick","disabled"],Zs=["onClick","disabled"],Rs={class:"selection-count"},$s={class:"table-container-wrapper"},et={class:"preview-table"},st={class:"status-cell"},tt=["onUpdate:modelValue","disabled"],lt=["onUpdate:modelValue","disabled"],nt={class:"schedule-description"},ot={key:3,class:"form-section"},at={class:"selection-controls"},dt=["disabled"],ct=["disabled"],it={class:"selection-count"},ut={class:"table-container-wrapper"},rt={class:"preview-table"},_t={class:"status-cell"},mt=["onUpdate:modelValue","disabled"],ft={key:0,class:"exceptions-badge"},ht={class:"actions"},gt=["onClick","disabled"],vt={key:0,class:"summary-stats"},St={class:"stat-item"},bt={class:"stat-value info"},pt={class:"stat-item"},yt={class:"stat-value valid"},Ct={class:"stat-item"},kt={class:"stat-value warning"},Ft={key:4,class:"summary-section"},At={class:"summary-grid"},Dt={class:"summary-item"},Et={class:"value"},xt={class:"summary-item"},wt={class:"value"},Lt={class:"summary-item"},Tt={class:"value"},Gt={class:"summary-item"},Mt={class:"value"},It={class:"summary-item"},Pt={class:"value"},Vt={class:"summary-item"},Nt={class:"value"},Ut={class:"summary-item highlight"},jt={class:"value"},qt={class:"selected-structures-in-summary"},Ot={class:"structures-summary-grid"},Qt={class:"structure-summary-header"},Wt={class:"structure-name-plan"},Ht={class:"structure-title"},Bt={class:"fee-plan-tag"},zt={class:"structure-amounts"},Jt={class:"total-amount"},Yt={class:"schedule-count"},Kt={class:"structure-components-summary"},Xt={class:"component-name"},Zt={class:"component-breakdown"},Rt={key:0},$t={key:0,class:"schedule-preview"},el={class:"schedule-dates"},sl={key:0,class:"more-schedules"},tl={class:"form-actions"},ll=["disabled"],nl={class:"button-content"},ol={key:0,class:"spinner"},al=["disabled"],dl={key:2,class:"form-card summary-card"},cl={class:"message success"},il={class:"section-title"},ul={class:"table-container-wrapper"},rl={class:"preview-table"},_l={class:"actions"},ml=["href"],fl={class:"form-section"},hl={class:"table-container-wrapper"},gl={class:"preview-table"},vl={key:0,class:"document-links"},Sl=["href"],bl={key:0,class:"more-documents"},pl={key:1,class:"document-links"},yl=["href"],Cl={key:0,class:"more-documents"},kl={key:2},Fl={class:"actions"},Al={key:0,class:"status-badge success"},Dl={key:1,class:"status-badge error"},El={class:"form-actions"};function xl(v,s,h,n,G,w){var E;const M=He("StudentList");return c(),d("div",Ye,[e("div",Ke,[s[62]||(s[62]=e("div",{class:"header"},[e("h1",{class:"title"},"Create Fee Schedules & Invoices"),e("p",{class:"subtitle"},"Generate fee schedules and sales invoices for students")],-1)),n.processing?(c(),d("div",Xe,[e("div",Ze,[s[16]||(s[16]=e("div",{class:"loading-spinner"},null,-1)),s[17]||(s[17]=e("h3",{class:"loading-title"},"Processing Fee Schedules & Invoices",-1)),s[18]||(s[18]=e("p",{class:"loading-description"}," Please wait while we create fee schedules and generate invoices for all students. This may take a few minutes depending on the number of students. ",-1)),n.processingDetails?(c(),d("div",Re,[s[15]||(s[15]=e("h4",null,"Processing Details",-1)),e("div",null,[e("div",null,[s[11]||(s[11]=e("strong",null,"Fee Structures:",-1)),b(" "+a(n.processingDetails.fee_structures),1)]),e("div",null,[s[12]||(s[12]=e("strong",null,"Student Groups:",-1)),b(" "+a(n.processingDetails.student_groups),1)]),e("div",null,[s[13]||(s[13]=e("strong",null,"Total Students:",-1)),b(" "+a(n.processingDetails.total_students),1)]),e("div",null,[s[14]||(s[14]=e("strong",null,"Total Schedules:",-1)),b(" "+a(n.processingDetails.schedule_count),1)])])])):_("",!0),s[19]||(s[19]=e("div",null,[e("div",{class:"spinner"}),b(" Creating fee schedules and invoices... ")],-1))])])):_("",!0),n.showStudentList?(c(),d("div",$e,[e("div",es,[We(M,{"student-group":n.selectedStudentGroup,"fee-structures":n.selectedStructures,"initial-selections":n.getInitialSelections(n.selectedStudentGroup),onSave:n.handleStudentListSave,onClose:s[0]||(s[0]=l=>n.showStudentList=!1)},null,8,["student-group","fee-structures","initial-selections","onSave"])])])):_("",!0),e("div",ss,[s[54]||(s[54]=e("h2",{class:"form-title"},"Fee Schedule Configuration",-1)),n.errorMessage?(c(),d("div",ts,[s[20]||(s[20]=e("strong",null,"Error:",-1)),b(" "+a(n.errorMessage),1)])):_("",!0),n.successMessage?(c(),d("div",ls,[s[21]||(s[21]=e("strong",null,"Success:",-1)),b(" "+a(n.successMessage),1)])):_("",!0),e("div",ns,[s[27]||(s[27]=e("h3",{class:"section-title"},"Basic Information",-1)),e("div",os,[e("div",as,[s[23]||(s[23]=e("label",null,"Class/Program",-1)),I(e("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>n.formData.selected_class=l),class:"picker",disabled:n.classesResource.loading||n.processing,onChange:s[2]||(s[2]=(...l)=>n.onClassChange&&n.onClassChange(...l))},[s[22]||(s[22]=e("option",{value:""},"Select Class/Program",-1)),(c(!0),d(p,null,y(n.classesList,l=>(c(),d("option",{key:l.name,value:l.name},a(l.program_name||l.name),9,cs))),128))],40,ds),[[ae,n.formData.selected_class]]),n.classesResource.loading?(c(),d("span",is,"Loading classes...")):_("",!0)])]),n.formData.selected_class&&n.feeSchedulesCount>0?(c(),d("div",us,[s[26]||(s[26]=e("div",{class:"note-icon"},"â„¹ï¸",-1)),e("div",rs,[s[24]||(s[24]=e("strong",null,"Note:",-1)),s[25]||(s[25]=b(" This program already has ")),e("strong",null,a(n.feeSchedulesCount),1),b(" fee schedule"+a(n.feeSchedulesCount>1?"s":"")+" created for the current academic year. Creating new schedules will add to the existing ones. ",1)])])):_("",!0)]),n.formData.selected_class&&n.feeStructuresList.length?(c(),d("div",_s,[s[38]||(s[38]=e("h3",{class:"section-title"},"Select Fee Structures",-1)),e("div",ms,[e("button",{onClick:s[3]||(s[3]=(...l)=>n.selectAllStructures&&n.selectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,fs),e("button",{onClick:s[4]||(s[4]=(...l)=>n.deselectAllStructures&&n.deselectAllStructures(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,hs),e("span",gs,a(n.selectedStructuresCount)+" of "+a(n.feeStructuresList.length)+" selected ",1)]),e("div",vs,[e("table",Ss,[s[30]||(s[30]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Fee Structure")]),e("th",null,[e("div",{class:"header-label"},"Fee Plan")]),e("th",null,[e("div",{class:"header-label"},"Total Amount")]),e("th",{width:"80px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(c(!0),d(p,null,y(n.feeStructuresList,l=>{var m;return c(),d("tr",{key:l.name,class:de({"selected-row":l.selected})},[e("td",bs,[I(e("input",{type:"checkbox","onUpdate:modelValue":i=>l.selected=i,disabled:n.processing,class:"custom-checkbox",onChange:i=>n.onStructureSelectionChange(l)},null,40,ps),[[z,l.selected]])]),e("td",null,[e("div",ys,[e("div",Cs,a(l.name),1),e("div",ks,[b(a(l.program)+" â€¢ "+a(l.academic_year)+" ",1),l.academic_term?(c(),d("span",Fs,"â€¢ "+a(l.academic_term),1)):_("",!0)])])]),e("td",null,[I(e("select",{"onUpdate:modelValue":i=>l.selected_fee_plan=i,class:"table-select",disabled:n.processing||!l.selected,onChange:i=>n.onFeePlanChange(l)},[s[28]||(s[28]=e("option",{value:""},"Select Plan",-1)),(c(!0),d(p,null,y(n.feePlans,i=>(c(),d("option",{key:i.value,value:i.value},a(i.label),9,Ds))),128))],40,As),[[ae,l.selected_fee_plan]])]),e("td",null,[e("div",Es," â‚¹"+a((m=l.total_amount)==null?void 0:m.toLocaleString()),1)]),e("td",xs,[e("button",{class:de(["details-button",{expanded:n.expandedStructures[l.name]}]),onClick:i=>n.toggleStructureDetails(l.name),disabled:n.processing},s[29]||(s[29]=[e("span",{class:"icon"},"â–¼",-1),b(" Details ")]),10,ws)])],2)}),128))])])]),(c(!0),d(p,null,y(n.feeStructuresList,l=>{var m;return c(),d("div",{key:l.name+"_details"},[n.expandedStructures[l.name]?(c(),d("div",Ls,[e("div",Ts,[e("h4",Gs,"Fee Structure Details - "+a(l.name),1),e("div",Ms,[e("div",Is,[s[31]||(s[31]=e("span",{class:"label"},"Total Amount:",-1)),e("span",Ps,"â‚¹"+a((m=l.total_amount)==null?void 0:m.toLocaleString()),1)]),e("div",Vs,[s[32]||(s[32]=e("span",{class:"label"},"Academic Year:",-1)),e("span",Ns,a(l.academic_year),1)]),l.academic_term?(c(),d("div",Us,[s[33]||(s[33]=e("span",{class:"label"},"Academic Term:",-1)),e("span",js,a(l.academic_term),1)])):_("",!0),e("div",qs,[s[34]||(s[34]=e("span",{class:"label"},"Selected Fee Plan:",-1)),e("span",Os,a(n.getFeePlanLabel(l.selected_fee_plan)||"Not selected"),1)])]),l.components&&l.components.length?(c(),d("div",Qs,[s[36]||(s[36]=e("h5",{class:"subsubsection-title"},"Fee Components",-1)),e("div",Ws,[e("table",null,[s[35]||(s[35]=e("thead",null,[e("tr",null,[e("th",null,"Fee Category"),e("th",null,"Amount"),e("th",null,"Discount"),e("th",null,"Total"),e("th",null,"Installment Calculation")])],-1)),e("tbody",null,[(c(!0),d(p,null,y(l.components,i=>{var C,f,S,P;return c(),d("tr",{key:i.fees_category},[e("td",null,a(i.fees_category),1),e("td",null,"â‚¹"+a((C=i.amount)==null?void 0:C.toLocaleString()),1),e("td",null,a(i.discount)+"%",1),e("td",null,"â‚¹"+a((f=i.total)==null?void 0:f.toLocaleString()),1),e("td",Hs,[l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(c(),d("span",Bs," â‚¹"+a((S=i.total)==null?void 0:S.toLocaleString())+" Ã· "+a(n.getInstallmentCount(l.selected_fee_plan))+" months = â‚¹"+a((P=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:P.toLocaleString()),1)):(c(),d("span",zs,"Full amount"))])])}),128))])])])])):_("",!0)]),l.selected_fee_plan&&l.feeSchedules&&l.feeSchedules.length?(c(),d("div",Js,[e("h4",Ys,"Fee Schedule Distribution - "+a(l.name),1),e("div",Ks,[e("button",{onClick:i=>n.selectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Select All ",8,Xs),e("button",{onClick:i=>n.deselectAllSchedules(l),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,Zs),e("span",Rs,a(n.getSelectedSchedulesCount(l))+" of "+a(l.feeSchedules.length)+" schedules selected ",1)]),e("div",$s,[e("table",et,[s[37]||(s[37]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Due Date")]),e("th",null,[e("div",{class:"header-label"},"Amount")]),e("th",null,[e("div",{class:"header-label"},"Description")])])],-1)),e("tbody",null,[(c(!0),d(p,null,y(l.feeSchedules,(i,C)=>{var f;return c(),d("tr",{key:C},[e("td",st,[I(e("input",{type:"checkbox","onUpdate:modelValue":S=>i.selected=S,disabled:n.processing,class:"custom-checkbox"},null,8,tt),[[z,i.selected]])]),e("td",null,[I(e("input",{type:"date","onUpdate:modelValue":S=>i.due_date=S,disabled:n.processing,class:"table-input"},null,8,lt),[[Be,i.due_date]])]),e("td",null,"â‚¹"+a((f=i.amount)==null?void 0:f.toLocaleString()),1),e("td",nt,a(n.getScheduleDescription(l.selected_fee_plan,C,i.due_date)),1)])}),128))])])])])):_("",!0)])):_("",!0)])}),128))])):_("",!0),n.selectedStructuresCount>0&&n.studentGroupsList.length?(c(),d("div",ot,[s[43]||(s[43]=e("h3",{class:"section-title"},"Select Student Groups",-1)),e("div",at,[e("button",{onClick:s[5]||(s[5]=(...l)=>n.selectAllGroups&&n.selectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Select All ",8,dt),e("button",{onClick:s[6]||(s[6]=(...l)=>n.deselectAllGroups&&n.deselectAllGroups(...l)),class:"secondary-button small",disabled:n.processing}," Deselect All ",8,ct),e("span",it,a(n.selectedStudentGroups.length)+" of "+a(n.studentGroupsList.length)+" groups selected ",1)]),e("div",ut,[e("table",rt,[s[39]||(s[39]=e("thead",null,[e("tr",null,[e("th",{width:"60px"},[e("div",{class:"header-label"},"Select")]),e("th",null,[e("div",{class:"header-label"},"Student Group")]),e("th",null,[e("div",{class:"header-label"},"Total Students")]),e("th",null,[e("div",{class:"header-label"},"Selected Students")]),e("th",{width:"100px"},[e("div",{class:"header-label"},"Actions")])])],-1)),e("tbody",null,[(c(!0),d(p,null,y(n.studentGroupsList,l=>(c(),d("tr",{key:l.name},[e("td",_t,[I(e("input",{type:"checkbox","onUpdate:modelValue":m=>l.selected=m,disabled:n.processing,class:"custom-checkbox"},null,8,mt),[[z,l.selected]])]),e("td",null,a(l.name),1),e("td",null,a(l.total_students),1),e("td",null,[b(a(n.getSelectedStudentsCount(l))+" / "+a(l.total_students)+" ",1),n.getSelectedStudentsCount(l)<l.total_students?(c(),d("span",ft," ("+a(l.total_students-n.getSelectedStudentsCount(l))+" excluded) ",1)):_("",!0)]),e("td",ht,[e("button",{onClick:m=>n.openStudentList(l),class:"edit-button",disabled:n.processing}," Edit Students ",8,gt)])]))),128))])])]),n.selectedStudentGroups.length>0?(c(),d("div",vt,[e("div",St,[s[40]||(s[40]=e("span",{class:"stat-label"},"Selected Groups",-1)),e("span",bt,a(n.selectedStudentGroups.length),1)]),e("div",pt,[s[41]||(s[41]=e("span",{class:"stat-label"},"Total Students",-1)),e("span",yt,a(n.getTotalStudents()),1)]),e("div",Ct,[s[42]||(s[42]=e("span",{class:"stat-label"},"Excluded Students",-1)),e("span",kt,a(n.getTotalExcludedStudents()),1)])])):_("",!0)])):_("",!0),n.isFormValid?(c(),d("div",Ft,[s[53]||(s[53]=e("h3",{class:"section-title"},"Summary",-1)),e("div",At,[e("div",Dt,[s[44]||(s[44]=e("span",{class:"label"},"Class:",-1)),e("span",Et,a(n.getClassName(n.formData.selected_class)),1)]),e("div",xt,[s[45]||(s[45]=e("span",{class:"label"},"Fee Structures:",-1)),e("span",wt,a(n.selectedStructuresCount)+" structures",1)]),e("div",Lt,[s[46]||(s[46]=e("span",{class:"label"},"Student Groups:",-1)),e("span",Tt,a(n.selectedStudentGroups.length)+" groups",1)]),e("div",Gt,[s[47]||(s[47]=e("span",{class:"label"},"Total Students:",-1)),e("span",Mt,a(n.getTotalStudents()),1)]),e("div",It,[s[48]||(s[48]=e("span",{class:"label"},"Excluded Students:",-1)),e("span",Pt,a(n.getTotalExcludedStudents()),1)]),e("div",Vt,[s[49]||(s[49]=e("span",{class:"label"},"Total Schedules:",-1)),e("span",Nt,a(n.getTotalSchedulesCount()),1)]),e("div",Ut,[s[50]||(s[50]=e("span",{class:"label"},"Total Amount:",-1)),e("span",jt,"â‚¹"+a((E=n.getTotalAmount())==null?void 0:E.toLocaleString()),1)])]),e("div",qt,[s[52]||(s[52]=e("h4",{class:"subsection-title"},"Selected Fee Structures",-1)),e("div",Ot,[(c(!0),d(p,null,y(n.selectedStructures,l=>{var m;return c(),d("div",{key:l.name,class:"structure-summary-card"},[e("div",Qt,[e("div",Wt,[e("h5",Ht,a(l.name),1),e("span",Bt,a(n.getFeePlanLabel(l.selected_fee_plan)),1)]),e("div",zt,[e("span",Jt,"â‚¹"+a((m=l.total_amount)==null?void 0:m.toLocaleString()),1),e("span",Yt,a(n.getSelectedSchedulesCount(l))+" schedules",1)])]),e("div",Kt,[(c(!0),d(p,null,y(l.components,i=>{var C,f;return c(),d("div",{key:i.fees_category,class:"component-summary"},[e("span",Xt,a(i.fees_category),1),e("span",Zt,[b(" â‚¹"+a((C=i.total)==null?void 0:C.toLocaleString())+" ",1),l.selected_fee_plan&&l.selected_fee_plan!=="Annually"?(c(),d("span",Rt," (â‚¹"+a((f=n.calculateInstallmentAmount(i.total,l.selected_fee_plan))==null?void 0:f.toLocaleString())+" Ã— "+a(n.getInstallmentCount(l.selected_fee_plan))+") ",1)):_("",!0)])])}),128))]),l.feeSchedules&&l.feeSchedules.filter(i=>i.selected).length>0?(c(),d("div",$t,[s[51]||(s[51]=e("div",{class:"schedule-preview-title"},"Schedule:",-1)),e("div",el,[(c(!0),d(p,null,y(l.feeSchedules.filter(i=>i.selected).slice(0,3),(i,C)=>(c(),d("span",{key:C,class:"schedule-date-tag"},a(n.formatScheduleDate(i.due_date)),1))),128)),l.feeSchedules.filter(i=>i.selected).length>3?(c(),d("span",sl," +"+a(l.feeSchedules.filter(i=>i.selected).length-3)+" more ",1)):_("",!0)])])):_("",!0)])}),128))])])])):_("",!0),e("div",tl,[e("button",{onClick:s[7]||(s[7]=(...l)=>n.createFeeSchedulesAndInvoices&&n.createFeeSchedulesAndInvoices(...l)),class:"enroll-button",disabled:!n.isFormValid||n.processing},[e("span",nl,[n.processing?(c(),d("span",ol)):_("",!0),b(" "+a(n.processing?"Processing...":`Create Fee Schedules for ${n.selectedStructuresCount} Structures`),1)])],8,ll),e("button",{onClick:s[8]||(s[8]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"reset-button",disabled:n.processing}," Reset Form ",8,al)])]),n.results&&n.results.success?(c(),d("div",dl,[s[61]||(s[61]=e("h2",{class:"form-title"},"Creation Results",-1)),e("div",cl,[s[55]||(s[55]=e("strong",null,"Successfully Created!",-1)),b(" "+a(n.results.message),1)]),(c(!0),d(p,null,y(n.results.structure_results,l=>(c(),d("div",{key:l.fee_structure,class:"form-section"},[e("h3",il,"Fee Schedules Created - "+a(l.fee_structure),1),e("div",ul,[e("table",rl,[s[56]||(s[56]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Action")])],-1)),e("tbody",null,[(c(!0),d(p,null,y(l.fee_schedules,m=>(c(),d("tr",{key:m},[e("td",null,a(m),1),e("td",_l,[e("a",{href:`/app/fee-schedule/${m}`,target:"_blank",class:"primary-button",style:{padding:"0.5rem 1rem","font-size":"0.9rem","text-decoration":"none",display:"inline-block"}}," View ",8,ml)])]))),128))])])])]))),128)),e("div",fl,[s[60]||(s[60]=e("h3",{class:"section-title"},"Invoice Results Summary",-1)),e("div",hl,[e("table",gl,[s[59]||(s[59]=e("thead",null,[e("tr",null,[e("th",null,"Fee Schedule"),e("th",null,"Students Processed"),e("th",null,"Created Documents"),e("th",null,"Actions")])],-1)),e("tbody",null,[(c(!0),d(p,null,y(n.results.invoice_results,l=>(c(),d("tr",{key:l.fee_schedule},[e("td",null,a(l.fee_schedule),1),e("td",null,a(l.result.created_count)+"/"+a(l.result.total_students),1),e("td",null,[l.result.submitted_invoices&&l.result.submitted_invoices.length>0?(c(),d("div",vl,[s[57]||(s[57]=e("strong",null,"Invoices:",-1)),(c(!0),d(p,null,y(l.result.submitted_invoices.slice(0,3),m=>(c(),d("div",{key:m,class:"document-link"},[e("a",{href:`/app/sales-invoice/${m}`,target:"_blank",class:"link"},a(m),9,Sl)]))),128)),l.result.submitted_invoices.length>3?(c(),d("div",bl," +"+a(l.result.submitted_invoices.length-3)+" more invoices ",1)):_("",!0)])):_("",!0),l.result.submitted_orders&&l.result.submitted_orders.length>0?(c(),d("div",pl,[s[58]||(s[58]=e("strong",null,"Orders:",-1)),(c(!0),d(p,null,y(l.result.submitted_orders.slice(0,3),m=>(c(),d("div",{key:m,class:"document-link"},[e("a",{href:`/app/sales-order/${m}`,target:"_blank",class:"link"},a(m),9,yl)]))),128)),l.result.submitted_orders.length>3?(c(),d("div",Cl," +"+a(l.result.submitted_orders.length-3)+" more orders ",1)):_("",!0)])):_("",!0),!l.result.submitted_invoices&&!l.result.submitted_orders?(c(),d("div",kl," No documents created ")):_("",!0)]),e("td",Fl,[l.result.success?(c(),d("span",Al,"Success")):(c(),d("span",Dl,"Failed"))])]))),128))])])])]),e("div",El,[e("button",{onClick:s[9]||(s[9]=(...l)=>n.resetForm&&n.resetForm(...l)),class:"success-button"}," Create Another "),e("button",{onClick:s[10]||(s[10]=l=>n.results=null),class:"secondary-button"}," Close Results ")])])):_("",!0)])])}const Il=Oe(Je,[["render",xl],["__scopeId","data-v-442c0cfb"]]);export{Il as default};
