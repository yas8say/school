var J=Object.defineProperty;var H=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var L=(v,n,o)=>n in v?J(v,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):v[n]=o,$=(v,n)=>{for(var o in n||(n={}))O.call(n,o)&&L(v,o,n[o]);if(H)for(var o of H(n))G.call(n,o)&&L(v,o,n[o]);return v};var P=(v,n,o)=>new Promise((c,f)=>{var b=a=>{try{l(o.next(a))}catch(_){f(_)}},h=a=>{try{l(o.throw(a))}catch(_){f(_)}},l=a=>a.done?c(a.value):Promise.resolve(a.value).then(b,h);l((o=o.apply(v,n)).next())});import{_ as K,J as Q,r as g,z as A,x as X,c as R,j as Z,a as i,b as t,t as p,g as ee,A as M,C as T,B as te,F as se,l as oe,i as w,h as F,D as U,n as re,o as u}from"./index-DrHiZmg-.js";const ae={class:"min-h-screen bg-gray-50 p-6"},ne={class:"max-w-4xl mx-auto"},le={class:"bg-white rounded-lg shadow-md p-6"},ie={key:0,class:"flex justify-center py-8"},ue={key:1,class:"text-center py-8"},de={class:"text-gray-600 mb-4"},ce={class:"mb-8"},me={class:"flex items-center justify-between"},ge={class:"relative inline-flex items-center cursor-pointer"},ve={class:"mb-8"},ye={class:"flex items-center justify-between"},pe={class:"relative inline-flex items-center cursor-pointer"},fe={key:0,class:"mb-8"},_e=["disabled"],xe=["value"],be={key:0,class:"mt-2 text-sm text-gray-600"},he={key:1,class:"mt-2 text-sm text-yellow-600"},we={key:2,class:"mt-3 p-3 bg-blue-50 rounded-lg"},ke={class:"text-sm text-blue-700"},Se={class:"mb-8"},$e={class:"flex items-center space-x-4"},Me={class:"flex items-center space-x-2"},Ce={class:"text-sm text-gray-600"},Ee={key:0},Ae={class:"font-medium text-gray-800"},Fe={key:1,class:"text-gray-500"},Ne={class:"mt-4 flex flex-wrap gap-2"},Ve={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg"},je={class:"text-sm text-blue-700"},He={class:"flex justify-end space-x-4 pt-6 border-t"},Le=["disabled"],Pe=["disabled"],Re={key:0,class:"mt-4 p-4 bg-green-100 text-green-700 rounded-lg border border-green-200"},Te={key:1,class:"mt-4 p-4 bg-red-100 text-red-700 rounded-lg border border-red-200"},Ue={__name:"AdminSettings",setup(v){const n={allow_instructors_modify_student:!1,allow_students_promotion_for_instructors:!1,next_academic_year:"",session_expiry:"24:00"},o=Q($({},n)),c=g($({},n)),f=g(""),b=g([]),h=g(!1),l=g(24),a=g(0),_=g(!0),k=g(""),x=g(!1),y=g(""),d=g(""),Y=A({url:"school.al_ummah.api3.get_next_academic_years",params:{values:{}},onSuccess:s=>{b.value=Array.isArray(s)?s:[],h.value=!1},onError:s=>{var e;console.error("Error fetching academic years:",s),b.value=[],h.value=!1,D(`Error fetching academic years: ${((e=s.messages)==null?void 0:e[0])||"Unknown error"}`,"error")}}),N=s=>{if(!s)return{hours:24,minutes:0};const[e,r]=s.split(":").map(Number);return{hours:e||0,minutes:r||0}};X([l,a],()=>{o.session_expiry=`${l.value}:${a.value.toString().padStart(2,"0")}`});const C=R(()=>l.value+a.value/60),E=R(()=>o.allow_instructors_modify_student!==c.value.allow_instructors_modify_student||o.allow_students_promotion_for_instructors!==c.value.allow_students_promotion_for_instructors||o.next_academic_year!==c.value.next_academic_year||o.session_expiry!==c.value.session_expiry),B=s=>{const e=b.value.find(r=>r.name===s);return e?e.academic_year_name||e.name:s},V=s=>{const e=Math.floor(s);if(e<24)return`${e} hour${e!==1?"s":""}`;if(e<168){const r=Math.floor(e/24),m=e%24;return m===0?`${r} day${r!==1?"s":""}`:`${r} day${r!==1?"s":""} and ${m} hour${m!==1?"s":""}`}else if(e<8760){const r=Math.floor(e/168),m=Math.floor(e%168/24);return m===0?`${r} week${r!==1?"s":""}`:`${r} week${r!==1?"s":""} and ${m} day${m!==1?"s":""}`}else{const r=Math.floor(e/8760),m=Math.floor(e%8760/168);return m===0?`${r} year${r!==1?"s":""}`:`${r} year${r!==1?"s":""} and ${m} week${m!==1?"s":""}`}},S=(s,e)=>{l.value=s,a.value=e},D=(s,e="info")=>{e==="error"?(d.value=s,setTimeout(()=>{d.value=""},5e3)):(y.value=s,setTimeout(()=>{y.value=""},5e3))},j=A({url:"school.al_ummah.api3.fetch_admin_settings",onSuccess(s){if(console.log("Settings fetched successfully:",s),o.allow_instructors_modify_student=s.allow_instructors_modify_student===1,o.allow_students_promotion_for_instructors=s.allow_students_promotion_for_instructors===1,o.next_academic_year=s.next_academic_year||"",s.session_expiry){o.session_expiry=s.session_expiry,f.value=s.session_expiry;const e=N(s.session_expiry);l.value=e.hours,a.value=e.minutes}else o.session_expiry="24:00",f.value="24:00",l.value=24,a.value=0;c.value=$({},o),_.value=!1,k.value=""},onError(s){console.error("Error fetching settings:",s),_.value=!1,k.value=(s==null?void 0:s.message)||"Failed to load settings from server."}}),z=A({url:"school.al_ummah.api3.save_admin_settings",onSuccess(s){console.log("Settings saved successfully:",s),x.value=!1,c.value=$({},o),f.value=o.session_expiry,y.value="Settings saved successfully!",d.value="",setTimeout(()=>{y.value=""},5e3)},onError(s){console.error("Error saving settings:",s),x.value=!1,d.value=(s==null?void 0:s.message)||"Failed to save settings. Please try again.",y.value=""}}),I=()=>P(this,null,function*(){if(!E.value){d.value="No changes to save.";return}if(l.value<0||a.value<0||a.value>59){d.value="Hours cannot be negative and minutes must be between 0-59.";return}if(l.value===0&&a.value===0){d.value="Session expiry cannot be zero.";return}if(o.allow_students_promotion_for_instructors&&!o.next_academic_year){d.value="Please select a next academic year when allowing student promotion.";return}x.value=!0,y.value="",d.value="";try{yield z.submit({allow_instructors_modify_student:o.allow_instructors_modify_student,allow_students_promotion_for_instructors:o.allow_students_promotion_for_instructors,next_academic_year:o.next_academic_year,session_expiry:o.session_expiry})}catch(s){console.error("Error in save settings:",s),x.value=!1,d.value="An unexpected error occurred. Please try again."}}),W=()=>{Object.assign(o,c.value);const s=N(c.value.session_expiry);l.value=s.hours,a.value=s.minutes,y.value="",d.value=""},q=()=>{_.value=!0,k.value="",j.submit()};return Z(()=>{console.log("Admin Settings component mounted, fetching settings..."),h.value=!0,Y.submit(),j.submit()}),(s,e)=>(u(),i("div",ae,[t("div",ne,[e[27]||(e[27]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-800"},"Admin Settings"),t("p",{class:"text-gray-600 mt-2"},"Manage system configuration and permissions")],-1)),t("div",le,[_.value?(u(),i("div",ie,e[10]||(e[10]=[t("div",{class:"spinner"},null,-1),t("span",{class:"ml-3 text-gray-700"},"Loading settings...",-1)]))):k.value?(u(),i("div",ue,[e[11]||(e[11]=t("div",{class:"text-red-600 mb-4"},[t("svg",{class:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})])],-1)),e[12]||(e[12]=t("h3",{class:"text-lg font-medium text-gray-800 mb-2"},"Failed to load settings",-1)),t("p",de,p(k.value),1),t("button",{onClick:q,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," Retry ")])):(u(),i("form",{key:2,onSubmit:ee(I,["prevent"])},[t("div",ce,[t("div",me,[e[14]||(e[14]=t("div",null,[t("h3",{class:"text-lg font-medium text-gray-800 mb-2"}," Allow Instructors to modify Student data "),t("p",{class:"text-gray-600 text-sm"}," When enabled, instructors will have permission to edit and update student information ")],-1)),t("label",ge,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=r=>o.allow_instructors_modify_student=r),class:"sr-only peer"},null,512),[[T,o.allow_instructors_modify_student]]),e[13]||(e[13]=t("div",{class:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"},null,-1))])])]),t("div",ve,[t("div",ye,[e[16]||(e[16]=t("div",null,[t("h3",{class:"text-lg font-medium text-gray-800 mb-2"}," Allow Students Promotion for Instructors "),t("p",{class:"text-gray-600 text-sm"}," When enabled, instructors will have permission to promote students to the next academic year ")],-1)),t("label",pe,[M(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=r=>o.allow_students_promotion_for_instructors=r),class:"sr-only peer"},null,512),[[T,o.allow_students_promotion_for_instructors]]),e[15]||(e[15]=t("div",{class:"w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-blue-600"},null,-1))])])]),o.allow_students_promotion_for_instructors?(u(),i("div",fe,[e[19]||(e[19]=t("label",{for:"next_academic_year",class:"block text-lg font-medium text-gray-800 mb-2"}," Next Academic Year ",-1)),e[20]||(e[20]=t("p",{class:"text-gray-600 text-sm mb-4"}," Select the academic year that will be used for student promotions ",-1)),M(t("select",{id:"next_academic_year","onUpdate:modelValue":e[2]||(e[2]=r=>o.next_academic_year=r),class:"w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:h.value},[e[17]||(e[17]=t("option",{value:"",disabled:""},"Select Academic Year",-1)),(u(!0),i(se,null,oe(b.value,r=>(u(),i("option",{key:r.name,value:r.name},p(r.academic_year_name||r.name),9,xe))),128))],8,_e),[[te,o.next_academic_year]]),h.value?(u(),i("div",be," Loading academic years... ")):b.value.length===0?(u(),i("div",he," No academic years available. Please contact administrator. ")):w("",!0),c.value.next_academic_year?(u(),i("div",we,[t("p",ke,[e[18]||(e[18]=t("span",{class:"font-medium"},"Current setting:",-1)),F(" "+p(B(c.value.next_academic_year)),1)])])):w("",!0)])):w("",!0),t("div",Se,[e[24]||(e[24]=t("label",{for:"session_expiry",class:"block text-lg font-medium text-gray-800 mb-2"}," Session Expiry (HH:MM) ",-1)),e[25]||(e[25]=t("p",{class:"text-gray-600 text-sm mb-4"}," Set the duration after which user sessions will automatically expire in hours and minutes ",-1)),t("div",$e,[t("div",Me,[M(t("input",{id:"hours",type:"number","onUpdate:modelValue":e[3]||(e[3]=r=>l.value=r),min:"0",class:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Hours"},null,512),[[U,l.value,void 0,{number:!0}]]),e[21]||(e[21]=t("span",{class:"text-gray-600"},":",-1)),M(t("input",{id:"minutes",type:"number","onUpdate:modelValue":e[4]||(e[4]=r=>a.value=r),min:"0",max:"59",class:"w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Minutes"},null,512),[[U,a.value,void 0,{number:!0}]])]),t("div",Ce,[C.value>0?(u(),i("div",Ee,[e[22]||(e[22]=F(" Equivalent to: ")),t("span",Ae,p(V(C.value)),1)])):(u(),i("div",Fe," Enter hours and minutes "))])]),e[26]||(e[26]=t("p",{class:"text-gray-500 text-xs mt-2"}," No maximum limit - set any duration as needed ",-1)),t("div",Ne,[t("button",{type:"button",onClick:e[5]||(e[5]=r=>S(1,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 hour "),t("button",{type:"button",onClick:e[6]||(e[6]=r=>S(8,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 8 hours "),t("button",{type:"button",onClick:e[7]||(e[7]=r=>S(24,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 24 hours "),t("button",{type:"button",onClick:e[8]||(e[8]=r=>S(168,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 week "),t("button",{type:"button",onClick:e[9]||(e[9]=r=>S(720,0)),class:"px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors"}," 1 month ")]),f.value?(u(),i("div",Ve,[t("p",je,[e[23]||(e[23]=t("span",{class:"font-medium"},"Current setting:",-1)),F(" "+p(f.value)+" ("+p(V(C.value))+") ",1)])])):w("",!0)]),t("div",He,[t("button",{type:"button",onClick:W,disabled:x.value,class:"px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"}," Reset ",8,Le),t("button",{type:"submit",disabled:x.value||!E.value,class:re(["px-8 py-3 rounded-lg font-medium transition-colors",x.value||!E.value?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"])},p(x.value?"Saving...":"Save Settings"),11,Pe)])],32))]),y.value?(u(),i("div",Re,p(y.value),1)):w("",!0),d.value?(u(),i("div",Te,p(d.value),1)):w("",!0)])]))}},De=K(Ue,[["__scopeId","data-v-f5283a9c"]]);export{De as default};
