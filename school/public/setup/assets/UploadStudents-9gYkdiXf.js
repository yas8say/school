var ze=Object.defineProperty,Je=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var Qe=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable;var he=(w,t,S)=>t in w?ze(w,t,{enumerable:!0,configurable:!0,writable:!0,value:S}):w[t]=S,Q=(w,t)=>{for(var S in t||(t={}))Qe.call(t,S)&&he(w,S,t[S]);if(ge)for(var S of ge(t))Xe.call(t,S)&&he(w,S,t[S]);return w},X=(w,t)=>Je(w,Ke(t));var W=(w,t,S)=>new Promise((s,V)=>{var L=c=>{try{g(S.next(c))}catch(E){V(E)}},n=c=>{try{g(S.throw(c))}catch(E){V(E)}},g=c=>c.done?s(c.value):Promise.resolve(c.value).then(L,n);g((S=S.apply(w,t)).next())});import{_ as Ze,r as y,c as j,q as Z,x as $e,a as i,b as l,i as k,t as f,l as z,m as $,F as G,p as M,h as ee,n as _e,o as d,v as es}from"./index-BVhAGwWm.js";import{v as pe,g as ss,u as C,p as ts,f as ls,a as J,r as os}from"./dateUtils-CshPDU0n.js";/* empty css             */const ns={setup(){const w=y(!1),t=y([]),S=j(()=>t.value.map((e,o)=>({original:e,display:o===0?`${e} - Current Year`:e}))),s=y(null),V=y([]),L=y([]),n=y(null),g=y(null),c=y([]),E=y(null),T=y(["First Name","Middle Name","Last Name","Student Date of Birth","Email Address","Phone Number","GR Number","Roll No","Guardian Name","Guardian Number","Guardian Email","Relation","Guardian Date of Birth"]),de=y(null),_=y([]),D=y([]),O=y([]),U=y([]),A=y([]),x=y([]),H=y({total_processed:0,successful:0,failed:0}),F=y(!1),se=y(!1),te=y("success"),le=y(""),oe=y(""),ye=j(()=>_.value.filter(e=>I(e)).length),be=j(()=>_.value.filter(e=>!I(e)).length),Se=j(()=>_.value.filter(e=>!I(e))),ke=j(()=>D.value.filter((e,o)=>{var r;const a=_.value.some(u=>{const v=u[e];return v!=null&&v!==""&&v.toString().trim()!==""}),m=(r=c.value[o])==null?void 0:r.type;return a||m})),we=j(()=>c.value.map((e,o)=>X(Q({},e),{originalIndex:o})).filter((e,o)=>{const a=D.value[o],m=_.value.some(u=>{const v=u[a];return v!=null&&v!==""&&v.toString().trim()!==""}),r=e.type;return m||r}));function Re(e){const o=B(e);return`${o["First Name"]||""} ${o["Middle Name"]||""} ${o["Last Name"]||""}`.trim()||"Unknown Student"}function Ne(e){return B(e)["GR Number"]||"N/A"}function Ee(e){return B(e)["Roll No"]||"N/A"}function Ce(e){const o=[];["First Name","Last Name","GR Number","Roll No"].forEach(u=>{const v=c.value.findIndex(h=>h.type===u);if(v===-1)o.push(`${u} not mapped`);else{const h=C.decode_col(c.value[v].column),b=D.value[h],R=e[b];(!R||R.toString().trim()==="")&&o.push(`${u} missing`)}});const r=B(e)["Student Date of Birth"];if(r&&r.toString().trim()!==""){const u=J(r,"Student Date of Birth");u.isValid||o.push(u.error)}return o.length>0?o.join("; "):"Check field mappings"}const ue=Z({url:"school.al_ummah.api4.get_academic_years",params:{values:{}},onSuccess:e=>{t.value=Array.isArray(e)?e:[],t.value.length>0&&(s.value=t.value[0]),t.value.length||p("No academic years available","error")},onError:e=>{var o;console.error("Error fetching academic years:",e),t.value=[],p(`Error fetching academic years: ${((o=e.messages)==null?void 0:o[0])||"Unknown error"}`,"error")}}),ce=Z({url:"school.al_ummah.api4.get_classes",params:{values:{}},onSuccess:e=>{V.value=Array.isArray(e)?e:[],console.log("Classes loaded:",V.value),V.value.length||p("No classes available","error")},onError:e=>{var o;console.error("Error fetching classes:",e),V.value=[],p(`Error fetching classes: ${((o=e.messages)==null?void 0:o[0])||"Unknown error"}`,"error")}}),ne=Z({url:"school.al_ummah.api4.get_divisions2",params:{values:{classId:n.value,academicYear:s.value}},onSuccess:e=>{L.value=Array.isArray(e)?e:[],console.log("Divisions loaded:",L.value)},onError:e=>{var o;console.error("Error fetching divisions:",e),L.value=[],p(`Error fetching divisions: ${((o=e.messages)==null?void 0:o[0])||"Unknown error"}`,"error")}}),ae=Z({url:"school.al_ummah.api4.bulk_enroll_students",method:"POST",onSuccess:e=>{console.log("Bulk enrollment successful:",e),F.value=!1,e&&e.success?(A.value=e.enrolled_students||[],x.value=e.failed_enrollments||[],H.value=e.summary||{total_processed:e.enrolled_students.length+e.failed_enrollments.length,successful:e.enrolled_students.length,failed:e.failed_enrollments.length},Le(e.enrolled_students,e.failed_enrollments),x.value.length===0?(p(`Successfully enrolled all ${A.value.length} students!`,"success"),K("success","Enrollment Complete",`Successfully enrolled all ${A.value.length} students!`)):(p(`Completed: ${A.value.length} successful, ${x.value.length} failed.`,"warning"),K("warning","Enrollment Completed with Errors",`Completed with ${A.value.length} successful enrollments and ${x.value.length} failures.`))):p("Bulk enrollment completed with issues","warning")},onError:e=>{var o,a;console.error("Error in bulk enrollment:",e),F.value=!1,p(`Bulk enrollment failed: ${((o=e.messages)==null?void 0:o[0])||e.message||"Unknown error"}`,"error"),K("error","Bulk Enrollment Failed",((a=e.messages)==null?void 0:a[0])||e.message||"Unknown error occurred during bulk enrollment.")}});$e(()=>{ue.reload(),ce.reload()});function De(){n.value=null,g.value=null,L.value=[],me()}function me(){g.value=null,L.value=[],n.value&&s.value&&(ne.update({params:{values:{classId:n.value,academicYear:s.value}}}),ne.reload())}function Fe(e){let o="";for(;e>=0;)o=String.fromCharCode(65+e%26)+o,e=Math.floor(e/26)-1;return o}function Be(){return W(this,null,function*(){const e=document.createElement("input");e.type="file",e.accept=".xlsx,.xls,.csv",e.onchange=o=>W(this,null,function*(){const a=o.target.files[0];if(a){E.value=a,p(null),A.value=[],x.value=[],H.value={total_processed:0,successful:0,failed:0};try{const{data:m,headers:r}=yield Te(a);_.value=m.slice(0,100).map(u=>X(Q({},u),{_status:null,_error:null,_touched:!1})),D.value=r,c.value=r.map((u,v)=>({type:null,column:C.encode_col(v)})),xe(r)}catch(m){console.error("Error loading preview:",m),p("Error loading file preview","error")}}}),e.click()})}function Ge(){E.value=null,_.value=[],D.value=[],c.value=[],O.value=[],U.value=[],A.value=[],x.value=[],H.value={total_processed:0,successful:0,failed:0},p(null)}function I(e){const o=c.value.some(h=>h.type==="First Name"&&e[D.value[C.decode_col(h.column)]]),a=c.value.some(h=>h.type==="Last Name"&&e[D.value[C.decode_col(h.column)]]),m=c.value.some(h=>h.type==="GR Number"&&e[D.value[C.decode_col(h.column)]]),r=c.value.some(h=>h.type==="Roll No"&&e[D.value[C.decode_col(h.column)]]),u=B(e)["Student Date of Birth"];let v=!0;return u&&u.toString().trim()!==""&&(v=pe(u)),o&&a&&m&&r&&v}function Me(e){_.value[e]&&(_.value[e]._touched=!0)}function Ve(e){return e._status==="success"?"row-success":e._enrollment_status==="error"?"row-enrollment-error":I(e)?"":"row-invalid"}function B(e){const o={"First Name":"","Middle Name":"","Last Name":"","Student Date of Birth":"","Email Address":"","Phone Number":"","GR Number":"","Roll No":"","Guardian Name":"","Guardian Number":"",Relation:"","Guardian Email":"","Guardian Date of Birth":"",className:n.value,divisionName:g.value,academicYear:s.value};return c.value.forEach(({type:a,column:m},r)=>{var u;if(a&&o.hasOwnProperty(a))try{const v=C.decode_col(m),h=D.value[v];let b=((u=e[h])==null?void 0:u.toString().trim())||"";if(a==="Student Date of Birth"||a==="Guardian Date of Birth"){const R=ts(b);b=R?ls(R):""}o[a]=b}catch(v){console.error(`Error mapping column ${m} for type ${a}:`,v)}}),o}function Le(e,o){console.log("Updating row statuses from bulk response..."),_.value.forEach(a=>{a._status=null,a._error=null}),e.forEach(a=>{const m=Ue(a);m!==-1&&(_.value[m]._status="success",_.value[m]._error=null)}),o.forEach(a=>{const m=Ae(a.student_data);m!==-1&&(_.value[m]._enrollment_status="error",_.value[m]._enrollment_error=a.error||"Unknown error")})}function Ue(e){return _.value.findIndex(o=>{const a=B(o);return`${a["First Name"]} ${a["Middle Name"]} ${a["Last Name"]}`.trim()===e})}function Ae(e){return _.value.findIndex(o=>{const a=B(o);return a["GR Number"]===e["GR Number"]&&a["First Name"]===e["First Name"]&&a["Last Name"]===e["Last Name"]})}function K(e,o,a){te.value=e,le.value=o,oe.value=a,se.value=!0}function Pe(){se.value=!1,te.value="success",le.value="",oe.value=""}function Ye(){return W(this,null,function*(){console.log("Enroll button clicked"),A.value=[],x.value=[],H.value={total_processed:0,successful:0,failed:0},F.value=!0,_.value.forEach(r=>{r._status=null,r._error=null});const e=["First Name","GR Number","Last Name","Roll No"],o=c.value.map(r=>r.type).filter(r=>r),a=e.filter(r=>!o.includes(r));if(a.length>0){const r=`Please map the following required fields: ${a.join(", ")}`;console.error(r),p(r,"error"),F.value=!1;return}if(!s.value||!n.value||!g.value){const r="Please select an academic year, class, and division";console.error(r),p(r,"error"),F.value=!1;return}if(!E.value){const r="Please select a file first";console.error(r),p(r,"error"),F.value=!1;return}if(_.value.length===0){p("No data available to enroll","error"),F.value=!1;return}const m=_.value.filter(r=>{const u=B(r),v=u["Student Date of Birth"]&&u["Student Date of Birth"].toString().trim()!==""?J(u["Student Date of Birth"],"Student Date of Birth"):{isValid:!0},h=u["Guardian Date of Birth"]&&u["Guardian Date of Birth"].toString().trim()!==""?J(u["Guardian Date of Birth"],"Guardian Date of Birth"):{isValid:!0};return!v.isValid||!h.isValid});if(m.length>0){p(`${m.length} rows have invalid dates. Please correct the dates before enrolling.`,"warning"),m.forEach(r=>{const u=_.value.indexOf(r);if(u!==-1){const v=B(r),h=J(v["Student Date of Birth"],"Student Date of Birth"),b=J(v["Guardian Date of Birth"],"Guardian Date of Birth");let R="";h.isValid||(R+=h.error+" "),b.isValid||(R+=b.error),_.value[u]._status="error",_.value[u]._error=R.trim()}}),F.value=!1;return}try{p("Starting bulk enrollment process...","info");const r=_.value.filter(v=>I(v));if(r.length===0){p("No valid rows to enroll. Please check your data and mappings.","warning"),F.value=!1;return}console.log(`Starting bulk enrollment for ${r.length} students...`);const u=r.map(v=>B(v));yield ae.submit({academicYear:s.value,className:n.value,divisionName:g.value,students:u,mappings:Object.fromEntries(c.value.filter(v=>v.type).map(v=>[v.type,v.column]))})}catch(r){console.error("Bulk enrollment process error:",r),p(`Bulk enrollment process failed: ${r.message||"Unknown error"}`,"error"),K("error","Bulk Enrollment Process Failed",r.message||"Unknown error occurred during enrollment."),F.value=!1}})}function xe(e){const o={"First Name":["first","fname","given"],"Last Name":["last","lname","surname"],"Middle Name":["middle","mname"],"Email Address":["email","mail"],"Phone Number":["phone","mobile","contact"],"GR Number":["gr","grno","gr_num","gr no"],"Roll No":["r. no","roll","rollno","roll_num"],"Student Date of Birth":["dob","birth","birthdate","date of birth"],"Guardian Date of Birth":["guardian dob","parent dob","father dob","mother dob"],"Guardian Name":["guardian name","parent","father","mother"],"Guardian Number":["guardian no","guardian number","guardian phone","parent phone"],Relation:["relation","relationship"],"Guardian Email":["guardian email","parent email","father email","mother email"]};e.forEach((a,m)=>{if(!a)return;const r=a.toLowerCase().trim();if(r.includes("email"))if(r.includes("guardian")||r.includes("parent")){c.value[m].type="Guardian Email",console.log(`✓ Guardian Email: "${a}"`);return}else{c.value[m].type="Email Address",console.log(`✓ Student Email: "${a}"`);return}for(const[u,v]of Object.entries(o))if(v.some(h=>r.includes(h))){if(u==="Email Address"||u==="Guardian Email")continue;c.value[m].type=u,console.log(`✓ ${u}: "${a}"`);break}}),console.log("Final auto-detected mappings:",c.value)}function Te(e){return new Promise((o,a)=>{const m=new FileReader;m.onload=r=>{try{const u=new Uint8Array(r.target.result),v=os(u,{type:"array",sheetStubs:!0}),h=v.Sheets[v.SheetNames[0]],b=C.decode_range(h["!ref"]);let R=0;for(let N=b.s.r;N<=b.e.r;++N){let P=!1;for(let q=b.s.c;q<=b.e.c;++q){const Y=h[C.encode_cell({c:q,r:N})];if(Y&&Y.v!==void 0&&Y.v!==null&&Y.v!==""){P=!0;break}}if(P){R=N;break}}const re=[];for(let N=b.s.c;N<=b.e.c;++N){const P=h[C.encode_cell({c:N,r:R})];re.push(P?String(P.v).trim():`Column ${N+1}`)}const ve=[];for(let N=R+1;N<=b.e.r;++N){const P={};let q=!1;for(let Y=b.s.c;Y<=b.e.c;++Y){const ie=h[C.encode_cell({c:Y,r:N})],fe=re[Y-b.s.c];P[fe]=ie?ie.v===void 0?"":ie.v:"",P[fe]!==""&&(q=!0)}q&&ve.push(P)}o({data:ve,headers:re})}catch(u){a(u)}},m.onerror=r=>a(r),m.readAsArrayBuffer(e)})}function Ie(e,o,a){c.value[e]=X(Q({},c.value[e]),{[o]:a,column:C.encode_col(e)})}function qe(e){_.value.splice(e,1),O.value=O.value.filter(o=>o.rowIndex!==e),U.value=U.value.filter(o=>o.rowIndex!==e),p("Row deleted","success")}function p(e,o="info"){de.value=e?{text:e,type:o}:null,e&&o!=="error"&&o!=="success"&&setTimeout(()=>p(null),5e3)}function je(e,o,a){const r=_.value[e][o]||"";if(r!==a){const u={rowIndex:e,column:o,oldValue:r,newValue:a,timestamp:new Date().toISOString()};O.value.push(u),U.value.push(u),console.log("Cell edit recorded:",u),He()}}function Oe(e,o){let a;return function(...m){clearTimeout(a),a=setTimeout(()=>e.apply(this,m),o)}}const He=Oe(We,500);function We(){return W(this,null,function*(){if(U.value.length!==0)try{const e=U.value[U.value.length-1],o=_.value[e.rowIndex],a=B(o);yield ae.submit({academicYear:s.value,className:n.value,divisionName:g.value,students:[a],mappings:Object.fromEntries(c.value.filter(m=>m.type).map(m=>[m.type,m.column]))}),U.value=[]}catch(e){console.error("Error sending cell update:",e),p(`Failed to save cell update: ${e.message||"Unknown error"}`,"error")}})}return{academicYears:t,displayYears:S,selectedYear:s,classes:V,divisions:L,selectedClass:n,selectedDivision:g,mappings:c,fileSelected:E,options:T,message:de,previewData:_,previewHeaders:D,editHistory:O,pendingEdits:U,enrolledStudents:A,failedEnrollments:x,enrollmentSummary:H,processing:F,showResultModal:se,resultModalType:te,resultModalTitle:le,resultModalDescription:oe,showErrorStudentsList:w,validRowsCount:ye,invalidRowsCount:be,errorRows:Se,filteredHeaders:ke,filteredMappings:we,getStudentFullName:Re,getStudentGR:Ne,getStudentRoll:Ee,getRowError:Ce,academicYearsResource:ue,classesResource:ce,divisionsResource:ne,enrollStudentsResource:ae,onYearChange:De,onClassChange:me,getExcelColumnLetter:Fe,handleFileSelection:Be,removeFile:Ge,handleEnrollStudents:Ye,updateMapping:Ie,deleteRow:qe,showMessage:p,handleCellEdit:je,closeResultModal:Pe,isRowValid:I,markRowAsTouched:Me,getRowStatusClass:Ve,validDate:pe,getTodayDate:ss}}},as={class:"enrollment-container"},rs={class:"scroll-view-content"},is={key:0,class:"loading-overlay"},ds={key:1,class:"modal-overlay"},us={class:"result-modal"},cs={key:0,class:"success-icon"},ms={key:1,class:"error-icon"},vs={class:"result-title"},fs={class:"result-description"},gs={class:"modal-actions"},hs={class:"form-card"},_s={class:"form-grid"},ps={class:"form-group required"},ys=["disabled"],bs=["value"],Ss={class:"form-group required"},ks=["disabled"],ws=["value"],Rs={key:0,class:"form-group required"},Ns=["disabled"],Es=["value"],Cs={class:"form-card"},Ds={class:"form-section"},Fs={key:0,class:"file-selected"},Bs={class:"button-content"},Gs={class:"enroll-button-section"},Ms=["disabled"],Vs={class:"button-content"},Ls={key:0,class:"spinner"},Us={key:2,class:"form-card summary-card"},As={class:"summary-stats"},Ps={class:"stat-item"},Ys={class:"stat-value"},xs={class:"stat-item"},Ts={class:"stat-value valid"},Is={class:"stat-item"},qs={class:"stat-value warning"},js={key:0,class:"success-details"},Os={class:"section-title"},Hs={class:"results-list"},Ws={key:1,class:"error-details"},zs={class:"section-title"},Js={class:"results-list"},Ks={class:"error-student"},Qs={class:"student-details"},Xs={class:"error-text"},Zs={key:3,class:"form-card preview-card"},$s={class:"summary-stats"},et={class:"stat-item"},st={class:"stat-value"},tt={class:"stat-item"},lt={class:"stat-value valid"},ot={class:"stat-item"},nt=["title"],at={key:0,class:"error-indicator"},rt={key:0,class:"error-students-card"},it={class:"section-title"},dt={class:"error-details",style:{"max-height":"200px","overflow-y":"auto"}},ut={class:"results-list"},ct={class:"error-student"},mt={class:"student-details"},vt={class:"error-text"},ft={key:0,class:"multiple-errors"},gt={key:1},ht={key:1,class:"table-spacing"},_t={class:"table-container-wrapper"},pt={class:"table-scroll-container"},yt={class:"table-container"},bt={class:"preview-table"},St=["onUpdate:modelValue","onChange"],kt=["value"],wt={class:"header-label"},Rt={class:"actions"},Nt=["onClick"],Et={class:"status-cell"},Ct={key:0,class:"status-badge success"},Dt={key:1,class:"status-badge error"},Ft={key:2,class:"status-badge warning"},Bt={key:3,class:"status-badge pending"},Gt={key:4,class:"error-tooltip"},Mt=["onUpdate:modelValue","onInput","onBlur","placeholder"];function Vt(w,t,S,s,V,L){return d(),i("div",as,[l("div",rs,[t[38]||(t[38]=l("div",{class:"header"},[l("h1",{class:"title"},"Students Enrollment Screen")],-1)),s.processing?(d(),i("div",is,t[11]||(t[11]=[l("div",{class:"loading-modal"},[l("div",{class:"loading-spinner"}),l("h3",{class:"loading-title"},"Enrolling Students"),l("p",{class:"loading-description"},"Please wait while we process the student data...")],-1)]))):k("",!0),s.showResultModal?(d(),i("div",ds,[l("div",us,[s.resultModalType==="success"?(d(),i("div",cs,t[12]||(t[12]=[l("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1)]))):(d(),i("div",ms,t[13]||(t[13]=[l("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M6 18L18 6M6 6l12 12"})],-1)]))),l("h3",vs,f(s.resultModalTitle),1),l("p",fs,f(s.resultModalDescription),1),l("div",gs,[s.resultModalType==="success"?(d(),i("button",{key:0,class:"success-button",onClick:t[0]||(t[0]=(...n)=>s.closeResultModal&&s.closeResultModal(...n))}," Continue ")):(d(),i("button",{key:1,class:"primary-button",onClick:t[1]||(t[1]=(...n)=>s.closeResultModal&&s.closeResultModal(...n))}," Try Again "))])])])):k("",!0),l("div",hs,[t[20]||(t[20]=l("h2",{class:"form-title"},"Academic Information",-1)),l("div",_s,[l("div",ps,[t[15]||(t[15]=l("label",null,"Academic Year",-1)),z(l("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.selectedYear=n),class:"picker",onChange:t[3]||(t[3]=(...n)=>s.onYearChange&&s.onYearChange(...n)),disabled:s.academicYearsResource.loading},[t[14]||(t[14]=l("option",{value:null},"Select a Year",-1)),(d(!0),i(G,null,M(s.displayYears,n=>(d(),i("option",{key:n,value:n.original},f(n.display),9,bs))),128))],40,ys),[[$,s.selectedYear]])]),l("div",Ss,[t[17]||(t[17]=l("label",null,"Class / Program",-1)),z(l("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>s.selectedClass=n),class:"picker",onChange:t[5]||(t[5]=(...n)=>s.onClassChange&&s.onClassChange(...n)),disabled:!s.selectedYear||s.classesResource.loading},[t[16]||(t[16]=l("option",{value:null},"Select a Class / Program",-1)),(d(!0),i(G,null,M(s.classes,n=>(d(),i("option",{key:n.name,value:n.name},f(n.name),9,ws))),128))],40,ks),[[$,s.selectedClass]])]),s.divisions.length>0?(d(),i("div",Rs,[t[19]||(t[19]=l("label",null,"Division / Student Group",-1)),s.divisions.length>0?z((d(),i("select",{key:0,"onUpdate:modelValue":t[6]||(t[6]=n=>s.selectedDivision=n),class:"picker",disabled:!s.selectedClass||s.divisionsResource.loading},[t[18]||(t[18]=l("option",{value:null},"Select a Division / Student Group",-1)),(d(!0),i(G,null,M(s.divisions,n=>(d(),i("option",{key:n.name,value:n.name},f(n.name),9,Es))),128))],8,Ns)),[[$,s.selectedDivision]]):k("",!0)])):k("",!0)])]),l("div",Cs,[t[21]||(t[21]=l("h2",{class:"form-title"},"Student Data Upload",-1)),l("div",Ds,[s.fileSelected?(d(),i("div",Fs,[l("span",null,"Selected file: "+f(s.fileSelected.name),1),l("button",{onClick:t[7]||(t[7]=(...n)=>s.removeFile&&s.removeFile(...n)),class:"remove-file-btn"},"×")])):k("",!0),l("button",{class:"secondary-button",onClick:t[8]||(t[8]=(...n)=>s.handleFileSelection&&s.handleFileSelection(...n))},[l("span",Bs,f(s.fileSelected?"Change File":"Upload File 📤"),1)]),l("div",Gs,[l("button",{class:"enroll-button",onClick:t[9]||(t[9]=(...n)=>s.handleEnrollStudents&&s.handleEnrollStudents(...n)),disabled:s.processing||!s.selectedYear||!s.selectedClass||!s.selectedDivision||!s.fileSelected},[l("span",Vs,[s.processing?(d(),i("span",Ls)):k("",!0),ee(" "+f(s.processing?"Processing...":"Enroll Students"),1)])],8,Ms)]),s.message?(d(),i("div",{key:1,class:_e(["message",s.message.type])},f(s.message.text),3)):k("",!0)])]),s.enrollmentSummary.total_processed>0?(d(),i("div",Us,[t[27]||(t[27]=l("h2",{class:"form-title"},"Enrollment Summary",-1)),l("div",As,[l("div",Ps,[t[22]||(t[22]=l("span",{class:"stat-label"},"Total Processed",-1)),l("span",Ys,f(s.enrollmentSummary.total_processed),1)]),l("div",xs,[t[23]||(t[23]=l("span",{class:"stat-label"},"Successful",-1)),l("span",Ts,f(s.enrollmentSummary.successful),1)]),l("div",Is,[t[24]||(t[24]=l("span",{class:"stat-label"},"Failed",-1)),l("span",qs,f(s.enrollmentSummary.failed),1)])]),s.enrolledStudents.length>0?(d(),i("div",js,[l("h4",Os,"Successfully Enrolled ("+f(s.enrolledStudents.length)+")",1),l("div",Hs,[(d(!0),i(G,null,M(s.enrolledStudents,(n,g)=>(d(),i("div",{key:g,class:"success-message"},[t[25]||(t[25]=l("span",{class:"status-badge success"},"Success",-1)),ee(" "+f(n),1)]))),128))])])):k("",!0),s.failedEnrollments.length>0?(d(),i("div",Ws,[l("h4",zs,"Enrollment Errors ("+f(s.failedEnrollments.length)+")",1),l("div",Js,[(d(!0),i(G,null,M(s.failedEnrollments,(n,g)=>(d(),i("div",{key:g,class:"error-message"},[l("div",Ks,[l("strong",null,f(n.student_data["First Name"])+" "+f(n.student_data["Middle Name"])+" "+f(n.student_data["Last Name"]),1),l("span",Qs,"(GR: "+f(n.student_data["GR Number"])+", Roll: "+f(n.student_data["Roll No"])+")",1)]),l("div",Xs,[t[26]||(t[26]=l("span",{class:"status-badge error"},"Error",-1)),ee(" "+f(n.error),1)])]))),128))])])):k("",!0)])):k("",!0),s.fileSelected&&s.previewData.length>0?(d(),i("div",Zs,[t[37]||(t[37]=l("h2",{class:"form-title"},"File Preview (First 100 rows)",-1)),l("div",$s,[l("div",et,[t[28]||(t[28]=l("span",{class:"stat-label"},"Total Rows:",-1)),l("span",st,f(s.previewData.length),1)]),l("div",tt,[t[29]||(t[29]=l("span",{class:"stat-label"},"Ready to Enroll:",-1)),l("span",lt,f(s.validRowsCount),1)]),l("div",ot,[t[30]||(t[30]=l("span",{class:"stat-label"},"With Errors:",-1)),l("span",{class:"stat-value warning",style:{cursor:"pointer"},onClick:t[10]||(t[10]=n=>s.showErrorStudentsList=!s.showErrorStudentsList),title:s.invalidRowsCount>0?"Click to view students with errors":""},[ee(f(s.invalidRowsCount)+" ",1),s.invalidRowsCount>0?(d(),i("span",at,"⚠️")):k("",!0)],8,nt)])]),s.showErrorStudentsList&&s.errorRows.length>0?(d(),i("div",rt,[l("h4",it,"Students with Errors ("+f(s.invalidRowsCount)+")",1),l("div",dt,[l("div",ut,[(d(!0),i(G,null,M(s.errorRows,(n,g)=>(d(),i("div",{key:g,class:"error-message"},[l("div",ct,[l("strong",null,f(s.getStudentFullName(n)),1),l("span",mt," (GR: "+f(s.getStudentGR(n))+", Roll: "+f(s.getStudentRoll(n))+") ",1)]),l("div",vt,[t[31]||(t[31]=l("span",{class:"status-badge warning"},"Warning",-1)),s.getRowError(n).includes(";")?(d(),i("span",ft,f(s.getRowError(n)),1)):(d(),i("span",gt,f(s.getRowError(n)),1))])]))),128))])])])):k("",!0),s.showErrorStudentsList&&s.errorRows.length>0?(d(),i("div",ht)):k("",!0),l("div",_t,[l("div",pt,[l("div",yt,[l("table",bt,[l("thead",null,[l("tr",null,[t[32]||(t[32]=l("th",{class:"actions"},"Actions",-1)),t[33]||(t[33]=l("th",{class:"status-cell"},"Status",-1)),(d(!0),i(G,null,M(s.filteredHeaders,(n,g)=>(d(),i("th",{key:"letter-"+g},f(s.getExcelColumnLetter(g)),1))),128))]),l("tr",null,[t[35]||(t[35]=l("th",{class:"actions"},null,-1)),t[36]||(t[36]=l("th",{class:"status-cell"},null,-1)),(d(!0),i(G,null,M(s.filteredHeaders,(n,g)=>(d(),i("th",{key:"header-"+g},[z(l("select",{"onUpdate:modelValue":c=>s.filteredMappings[g].type=c,class:"table-select",onChange:c=>s.updateMapping(s.filteredMappings[g].originalIndex,"type",c.target.value)},[t[34]||(t[34]=l("option",{value:null},"Select Field",-1)),(d(!0),i(G,null,M(s.options,(c,E)=>(d(),i("option",{key:E,value:c},f(c),9,kt))),128))],40,St),[[$,s.filteredMappings[g].type]]),l("span",wt,f(n),1)]))),128))])]),l("tbody",null,[(d(!0),i(G,null,M(s.previewData,(n,g)=>(d(),i("tr",{key:g,class:_e(s.getRowStatusClass(n))},[l("td",Rt,[l("button",{onClick:c=>s.deleteRow(g),class:"trash-icon"}," Delete ",8,Nt)]),l("td",Et,[n._status==="success"?(d(),i("span",Ct,"Success")):n._status==="error"?(d(),i("span",Dt,"Error")):s.isRowValid(n)?(d(),i("span",Bt,"Pending")):(d(),i("span",Ft,"Warning")),n._error?(d(),i("div",Gt,f(n._error),1)):k("",!0)]),(d(!0),i(G,null,M(s.filteredHeaders,(c,E)=>(d(),i("td",{key:E},[z(l("input",{"onUpdate:modelValue":T=>n[c]=T,class:"table-input",onInput:T=>s.handleCellEdit(g,c,T.target.value),onBlur:T=>s.markRowAsTouched(g),placeholder:n[c]||"-"},null,40,Mt),[[es,n[c]]])]))),128))],2))),128))])])])])])])):k("",!0)])])}const Yt=Ze(ns,[["render",Vt]]);export{Yt as default};
