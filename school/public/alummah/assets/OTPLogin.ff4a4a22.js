var p=(d,_,f)=>new Promise((g,n)=>{var u=o=>{try{l(f.next(o))}catch(s){n(s)}},a=o=>{try{l(f.throw(o))}catch(s){n(s)}},l=o=>o.done?g(o.value):Promise.resolve(o.value).then(u,a);l((f=f.apply(d,_)).next())});import{_ as E}from"./index.6f74e26c.js";import{_ as N,r as m,x as L,o as B,b as U,e as b,f as t,C as k,D as V,n as w,t as F,g as O,p as q,h as z,L as A,I as G,d as y}from"./vendor.206e735d.js";const h=d=>(q("data-v-32b7d3f1"),d=d(),z(),d),H={class:"min-h-screen bg-white flex items-center justify-center p-4"},J={class:"w-full max-w-md text-center"},K=h(()=>t("div",{class:"text-center mb-8"},[t("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"OTP Login"),t("p",{class:"text-gray-600"},"Enter your phone number to receive OTP")],-1)),Q={class:"mb-6 text-left"},W=h(()=>t("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 mb-2"}," Phone Number ",-1)),X=["disabled"],Y=["disabled"],Z={key:0,class:"mb-6 text-left"},$=h(()=>t("label",{for:"otp",class:"block text-sm font-medium text-gray-700 mb-2"}," Enter OTP ",-1)),ee=["disabled"],oe={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},te=h(()=>t("div",{class:"bg-white rounded-lg p-6 flex items-center space-x-3"},[t("div",{class:"spinner"}),t("span",{class:"text-gray-700"},"Processing...")],-1)),se=[te],re={setup(d){const _=A(),f=G(),g=m(f.query.role||"teacher"),n=m(""),u=m(""),a=m(!1),l=m(!1),o=m(!1);let s=null,P=null;const S=()=>p(this,null,function*(){try{const e=yield E(()=>import("./session.f44a4ef8.js"),["assets/session.f44a4ef8.js","assets/vendor.206e735d.js","assets/vendor.1f7d581e.css","assets/index.6f74e26c.js","assets/index.fe0020ca.css"]);s=e.session,P=e.setSelectedLoginRole,P&&P(g.value)}catch(e){console.error("Error loading modules:",e),r("info","Error","Failed to load required modules. Please refresh the page.")}});function r(e,i,v){window.dispatchEvent(new CustomEvent("show-api-message-popup",{detail:{type:e,title:i,message:v}}))}const x=e=>{console.log("OTP verification success from session:",e.detail),o.value=!1},T=e=>{console.log("OTP verification error from session:",e.detail),o.value=!1,r("info","Verification Failed","Failed to verify OTP. Please try again.")},I=()=>{window.addEventListener("otp-verification-success",x),window.addEventListener("otp-verification-error",T)},R=()=>{window.removeEventListener("otp-verification-success",x),window.removeEventListener("otp-verification-error",T)},C={submit:e=>p(this,null,function*(){const{createResource:i}=yield E(()=>import("./vendor.206e735d.js").then(function(c){return c.a0}),["assets/vendor.206e735d.js","assets/vendor.1f7d581e.css"]);return i({url:"school.al_ummah.api2.send_otp_web",onSuccess(c){console.log("OTP sent successfully:",c),l.value=!1,c.success?(r("info","OTP Sent","OTP sent successfully! Check your phone."),a.value=!0):r("info","OTP Failed",c.message||"Failed to send OTP. Please try again.")},onError(c){console.error("Error sending OTP:",c),l.value=!1,r("info","OTP Failed","Failed to send OTP. Please try again.")}}).submit(e)})},j=()=>p(this,null,function*(){if(!n.value){r("info","Missing Information","Please enter a valid phone number.");return}l.value=!0;try{yield C.submit({phone:n.value,role:g.value==="parent"?"Guardian":"Instructor"})}catch(e){console.error("Error in send OTP:",e),l.value=!1,r("info","OTP Failed","Failed to send OTP. Please try again.")}}),D=()=>p(this,null,function*(){if(!u.value){r("info","Missing Information","Please enter the OTP.");return}o.value=!0;try{if(s&&s.verifyOtp)yield s.verifyOtp.submit({phone:n.value,otp:u.value,role:g.value==="parent"?"Guardian":"Instructor"});else throw new Error("Session module not loaded")}catch(e){console.error("Error in verify OTP:",e),o.value=!1,r("info","Verification Failed","Failed to verify OTP. Please try again.")}});L(()=>{if(s)return s.verifyOtp.error},e=>{e&&(o.value=!1,r("info","Verification Failed","Failed to verify OTP. Please check the code and try again."))}),L(()=>{if(s)return s.verifyOtp.data},e=>{if(e&&e.status!=="success"){o.value=!1;const i=e.message||"OTP verification failed. Please try again.";r("info","Verification Failed",i)}});const M=()=>{_.push({name:"Login"})};return B(()=>p(this,null,function*(){yield S(),I()})),U(()=>{R()}),(e,i)=>(y(),b("div",H,[t("div",J,[K,t("div",Q,[W,k(t("input",{id:"phoneNumber",type:"tel","onUpdate:modelValue":i[0]||(i[0]=v=>n.value=v),placeholder:"Enter your phone number",disabled:a.value,class:w(["w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",a.value?"bg-gray-100 cursor-not-allowed":"bg-white"])},null,10,X),[[V,n.value]])]),t("button",{onClick:j,disabled:a.value||!n.value,class:w(["w-full py-3 px-4 rounded-full font-medium transition-colors mb-6",a.value||!n.value?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"])},F(a.value?"OTP Sent":"Send OTP"),11,Y),a.value?(y(),b("div",Z,[$,k(t("input",{id:"otp",type:"text","onUpdate:modelValue":i[1]||(i[1]=v=>u.value=v),placeholder:"Enter OTP",class:"w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[V,u.value]])])):O("",!0),a.value?(y(),b("button",{key:1,onClick:D,disabled:!u.value||o.value,class:w(["w-full py-3 px-4 rounded-full font-medium transition-colors mb-4",!u.value||o.value?"bg-gray-400 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"])},F(o.value?"Verifying...":"Verify OTP"),11,ee)):O("",!0),t("button",{onClick:M,class:"w-full py-3 px-4 border border-gray-300 text-gray-700 rounded-full font-medium hover:bg-gray-50 transition-colors"}," Back to Login "),l.value?(y(),b("div",oe,se)):O("",!0)])]))}};var le=N(re,[["__scopeId","data-v-32b7d3f1"]]);export{le as default};
