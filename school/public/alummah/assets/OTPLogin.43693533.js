var v=(u,f,i)=>new Promise((l,t)=>{var c=s=>{try{a(i.next(s))}catch(p){t(p)}},r=s=>{try{a(i.throw(s))}catch(p){t(p)}},a=s=>s.done?l(s.value):Promise.resolve(s.value).then(c,r);a((i=i.apply(u,f)).next())});import{_ as R,l as d,c as x,x as V,e as m,m as o,A as P,C as O,y,t as T,n as _,p as C,q as L,K as B,H as j,o as g}from"./vendor.e48cf2aa.js";import{a as F,s as w}from"./index.5fee7170.js";const b=u=>(C("data-v-40fc7fe5"),u=u(),L(),u),D={class:"min-h-screen bg-white flex items-center justify-center p-4"},q={class:"w-full max-w-md text-center"},z=b(()=>o("div",{class:"text-center mb-8"},[o("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"OTP Login"),o("p",{class:"text-gray-600"},"Enter your phone number to receive OTP")],-1)),G={class:"mb-6 text-left"},M=b(()=>o("label",{for:"phoneNumber",class:"block text-sm font-medium text-gray-700 mb-2"}," Phone Number ",-1)),U=["disabled"],A=["disabled"],H={key:0,class:"mb-6 text-left"},J=b(()=>o("label",{for:"otp",class:"block text-sm font-medium text-gray-700 mb-2"}," Enter OTP ",-1)),K=["disabled"],Q={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},W=b(()=>o("div",{class:"bg-white rounded-lg p-6 flex items-center space-x-3"},[o("div",{class:"spinner"}),o("span",{class:"text-gray-700"},"Processing...")],-1)),X=[W],Y={setup(u){const f=B(),i=j(),l=d(i.query.role||"teacher");F(l.value);const t=d(""),c=d(""),r=d(!1),a=d(!1),s=d(!1),p=x({url:"school.al_ummah.api2.send_otp_web",onSuccess(e){console.log("OTP sent successfully:",e),a.value=!1,e.success?(alert("OTP sent successfully! Check your phone."),r.value=!0):alert(e.message||"Failed to send OTP. Please try again.")},onError(e){console.error("Error sending OTP:",e),a.value=!1,alert("Failed to send OTP. Please try again.")}}),k=x({url:"school.al_ummah.api2.verify_otp_and_create_session",onSuccess(e){console.log("OTP verified successfully:",e),N(e)},onError(e){console.error("Error verifying OTP:",e),s.value=!1,alert("Failed to verify OTP. Please check the code and try again.")}}),S=()=>v(this,null,function*(){if(!t.value){alert("Please enter a valid phone number.");return}a.value=!0;try{yield p.submit({phone:t.value,role:l.value==="parent"?"Guardian":"Instructor"})}catch(e){console.error("Error in send OTP:",e),a.value=!1}}),E=()=>v(this,null,function*(){if(!c.value){alert("Please enter the OTP.");return}s.value=!0;try{yield k.submit({phone:t.value,otp:c.value,role:l.value==="parent"?"Guardian":"Instructor"})}catch(e){console.error("Error in verify OTP:",e),s.value=!1}}),N=e=>v(this,null,function*(){try{if(e.status==="success"){console.log("OTP login successful, session created on backend"),localStorage.setItem("user",JSON.stringify({username:e.user,role:l.value,roles:e.roles})),w.user=e.user;const n=l.value==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting based on selected role:",l.value,"\u2192",n),f.replace({name:n})}else alert("OTP verification failed. Please try again."),s.value=!1}catch(n){console.error("Error in OTP verification process:",n),alert("Failed to complete login process. Please try again."),s.value=!1}}),I=()=>{f.push({name:"Login"})};return V(()=>{if(w.isLoggedIn){const e=l.value==="parent"?"Parenthome":"Teacherhome";f.replace({name:e})}}),(e,n)=>(g(),m("div",D,[o("div",q,[z,o("div",G,[M,P(o("input",{id:"phoneNumber",type:"tel","onUpdate:modelValue":n[0]||(n[0]=h=>t.value=h),placeholder:"Enter your phone number",disabled:r.value,class:y(["w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",r.value?"bg-gray-100 cursor-not-allowed":"bg-white"])},null,10,U),[[O,t.value]])]),o("button",{onClick:S,disabled:r.value||!t.value,class:y(["w-full py-3 px-4 rounded-full font-medium transition-colors mb-6",r.value||!t.value?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 hover:bg-blue-700 text-white"])},T(r.value?"OTP Sent":"Send OTP"),11,A),r.value?(g(),m("div",H,[J,P(o("input",{id:"otp",type:"text","onUpdate:modelValue":n[1]||(n[1]=h=>c.value=h),placeholder:"Enter OTP",class:"w-full px-4 py-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[O,c.value]])])):_("",!0),r.value?(g(),m("button",{key:1,onClick:E,disabled:!c.value||s.value,class:y(["w-full py-3 px-4 rounded-full font-medium transition-colors mb-4",!c.value||s.value?"bg-gray-400 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-700 text-white"])},T(s.value?"Verifying...":"Verify OTP"),11,K)):_("",!0),o("button",{onClick:I,class:"w-full py-3 px-4 border border-gray-300 text-gray-700 rounded-full font-medium hover:bg-gray-50 transition-colors"}," Back to Login "),a.value?(g(),m("div",Q,X)):_("",!0)])]))}};var se=R(Y,[["__scopeId","data-v-40fc7fe5"]]);export{se as default};
