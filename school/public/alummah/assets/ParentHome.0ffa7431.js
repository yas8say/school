var A=($,s,l)=>new Promise((d,i)=>{var p=v=>{try{h(l.next(v))}catch(x){i(x)}},k=v=>{try{h(l.throw(v))}catch(x){i(x)}},h=v=>v.done?d(v.value):Promise.resolve(v.value).then(p,k);h((l=l.apply($,s)).next())});import{_ as B,r as w,I as P,i as V,o as F,d as a,e as n,f as e,M as K,g as b,u as o,t as u,p as U,h as R,w as T,F as X,E as Y,H as ce,L as Z,K as O,C as z,D as J,n as L,b as ue,j as C,G as me,J as _e,Q as ge,k as he}from"./vendor.1f5cccb6.js";import{session as ee}from"./session.60eb9438.js";import{a as te,b as se,r as oe}from"./XMarkIcon.ffec483e.js";import{r as pe,a as ve,b as xe,c as le,d as be,e as ae,f as fe,g as ye}from"./InboxIcon.0cab84ff.js";import"./index.fb2b3e70.js";const I=$=>(U("data-v-3a3b9ecb"),$=$(),R(),$),we={class:"min-h-screen bg-gray-50 p-4"},$e={class:"max-w-4xl max-h-full w-full h-full flex items-center justify-center"},ke=["src"],Se=I(()=>e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Ce=[Se],Ie={key:1,class:"flex justify-center items-center py-8"},je=I(()=>e("div",{class:"spinner"},null,-1)),Ne=I(()=>e("span",{class:"ml-2 text-gray-600"},"Loading student details...",-1)),De=[je,Ne],Le={key:2,class:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6"},Ee=I(()=>e("p",{class:"text-red-800 font-medium mb-2"},"Failed to load student details",-1)),Me={class:"text-red-700 text-sm"},Ae={key:3,class:"bg-white rounded-lg shadow-sm"},Pe={class:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-t-lg p-6"},Fe={class:"flex items-center space-x-4"},ze=["src"],Be={class:"flex-1 text-white"},Ve={class:"text-2xl font-bold"},Ue={class:"text-blue-100"},Re={key:0,class:"text-blue-100"},Te={class:"text-blue-100"},Oe={class:"text-blue-100"},Je={class:"p-6"},Ge={class:"space-y-4 mb-6"},He=I(()=>e("div",{class:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center"},[e("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})])],-1)),qe=I(()=>e("p",{class:"text-sm text-gray-600"},"Phone",-1)),We={class:"font-medium text-gray-800"},Qe={key:1,class:"flex items-start space-x-3 p-3 bg-gray-50 rounded-lg"},Ke=I(()=>e("div",{class:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),Xe={class:"flex-1"},Ye=I(()=>e("p",{class:"text-sm text-gray-600"},"Address",-1)),Ze={class:"font-medium text-gray-800"},et={class:"bg-gray-50 rounded-lg p-6"},tt=I(()=>e("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Attendance Summary",-1)),st={class:"grid grid-cols-3 gap-4"},ot={class:"text-center bg-green-50 rounded-lg p-4 border border-green-200"},lt={class:"text-2xl font-bold text-green-600"},at=I(()=>e("p",{class:"text-sm text-green-700 font-medium"},"Present",-1)),nt={class:"text-center bg-red-50 rounded-lg p-4 border border-red-200"},rt={class:"text-2xl font-bold text-red-600"},dt=I(()=>e("p",{class:"text-sm text-red-700 font-medium"},"Absent",-1)),it={class:"text-center bg-yellow-50 rounded-lg p-4 border border-yellow-200"},ct={class:"text-2xl font-bold text-yellow-600"},ut=I(()=>e("p",{class:"text-sm text-yellow-700 font-medium"},"Leave",-1)),mt={key:4,class:"text-center py-8"},_t=I(()=>e("h3",{class:"text-lg font-medium text-gray-800 mb-2"},"No Student Data",-1)),gt=I(()=>e("p",{class:"text-gray-600 mb-4"},"Unable to load student information.",-1)),ht={setup($){const s=w({}),l=w(!1),d=w(""),i=P({url:"school.al_ummah.api2.get_student_app_data",auto:!1,onSuccess(g){if(g&&g.student)s.value=g;else throw g&&g.error?new Error(g.error):new Error("No student data received")},onError(g){console.error("Error fetching student details:",g),s.value={}}}),p=V(()=>s.value.img_url?s.value.img_url:"https://via.placeholder.com/150?text=Student"),k=g=>{g&&(d.value=g,l.value=!0)},h=g=>{g.target.src="https://via.placeholder.com/150?text=Student"},v=()=>{s.value.mobile&&window.open(`tel:${s.value.mobile}`,"_self")},x=()=>A(this,null,function*(){try{let g=localStorage.getItem("selected_student");if(g&&g.startsWith("{"))try{const t=JSON.parse(g);g=t.student||t.name}catch(t){console.error("Error parsing student data:",t)}if(!g)throw new Error("No student ID found");yield i.fetch({studentID:g})}catch(g){console.error("Error loading student details:",g)}});return F(()=>{x()}),(g,t)=>(a(),n("div",we,[l.value?(a(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",onClick:t[2]||(t[2]=_=>l.value=!1)},[e("div",$e,[e("img",{src:d.value,alt:"Full size profile photo",class:"max-w-full max-h-full object-contain",onClick:t[0]||(t[0]=K(()=>{},["stop"]))},null,8,ke),e("button",{onClick:t[1]||(t[1]=_=>l.value=!1),class:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors"},Ce)])])):b("",!0),o(i).loading?(a(),n("div",Ie,De)):o(i).error?(a(),n("div",Le,[Ee,e("p",Me,u(o(i).error.message),1),e("button",{onClick:x,class:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-sm"}," Retry ")])):s.value&&s.value.student?(a(),n("div",Ae,[e("div",Pe,[e("div",Fe,[e("div",{class:"flex-shrink-0 cursor-pointer",onClick:t[3]||(t[3]=_=>k(s.value.img_url))},[e("img",{src:o(p),alt:"Student",class:"w-20 h-20 rounded-full border-4 border-white object-cover hover:opacity-90 transition-opacity",onError:h},null,40,ze)]),e("div",Be,[e("h1",Ve,u(s.value.student_name||s.value.name||"Unknown Student"),1),e("p",Ue,"Student ID: "+u(s.value.student),1),s.value.group_roll_no?(a(),n("p",Re,"Roll No: "+u(s.value.group_roll_no),1)):b("",!0),e("p",Te,"Class: "+u(s.value.student_group),1),e("p",Oe,"Today: "+u(s.value.status||"No Record"),1)])])]),e("div",Je,[e("div",Ge,[s.value.mobile?(a(),n("div",{key:0,class:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors",onClick:v},[He,e("div",null,[qe,e("p",We,u(s.value.mobile),1)])])):b("",!0),s.value.address?(a(),n("div",Qe,[Ke,e("div",Xe,[Ye,e("p",Ze,u(s.value.address),1)])])):b("",!0)]),e("div",et,[tt,e("div",st,[e("div",ot,[e("p",lt,u(s.value.present_count||0),1),at]),e("div",nt,[e("p",rt,u(s.value.absent_count||0),1),dt]),e("div",it,[e("p",ct,u(s.value.leave_count||0),1),ut])])])])])):(a(),n("div",mt,[e("div",{class:"bg-white rounded-lg shadow-sm p-8"},[_t,gt,e("button",{onClick:x,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Try Again ")])]))]))}};var pt=B(ht,[["__scopeId","data-v-3a3b9ecb"]]);const M=$=>(U("data-v-5403aa4c"),$=$(),R(),$),vt={class:"min-h-screen bg-gray-50 p-4"},xt={class:"mb-6"},bt=M(()=>e("h1",{class:"text-2xl font-bold text-gray-800"},"Notices",-1)),ft=M(()=>e("p",{class:"text-gray-600"},"View all published notices",-1)),yt={key:0,class:"text-sm text-gray-500 mt-1"},wt={key:0,class:"flex justify-center items-center py-8"},$t=M(()=>e("div",{class:"spinner"},null,-1)),kt=M(()=>e("span",{class:"ml-2 text-gray-600"},"Loading notices...",-1)),St=[$t,kt],Ct={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6"},It=M(()=>e("p",{class:"text-red-800"},"Failed to load notices.",-1)),jt={key:2,class:"space-y-4"},Nt=["onClick"],Dt={class:"p-6"},Lt={class:"flex items-start justify-between mb-3"},Et={class:"text-lg font-semibold text-gray-800 flex-1 pr-4"},Mt={class:"text-sm text-gray-500 whitespace-nowrap"},At={class:"text-gray-600 line-clamp-2 mb-2"},Pt={class:"text-sm text-gray-500"},Ft={key:0,class:"text-center py-12"},zt=ce('<div class="bg-white rounded-lg shadow-sm p-8" data-v-5403aa4c><svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-5403aa4c><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-5403aa4c></path></svg><h3 class="text-lg font-medium text-gray-800 mb-2" data-v-5403aa4c>No Notices Found</h3><p class="text-gray-600" data-v-5403aa4c>No notices have been published for this class yet.</p></div>',1),Bt=[zt],Vt={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},Ut={class:"bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto"},Rt={class:"p-6"},Tt={class:"flex items-center justify-between mb-4"},Ot={class:"text-xl font-bold text-gray-800"},Jt=M(()=>e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)),Gt=[Jt],Ht={class:"mb-4 text-sm text-gray-500"},qt={class:"prose max-w-none mb-6"},Wt={class:"text-gray-700 whitespace-pre-wrap"},Qt={setup($){const s=w([]),l=w(""),d=w(null),i=w(!1),p=P({url:"school.al_ummah.api2.get_notice_list",auto:!1,onSuccess(t){console.log("Notices loaded:",t),s.value=Array.isArray(t)?t:[]},onError(t){console.error("Error fetching notices:",t),s.value=[]}}),k=()=>{try{const t=localStorage.getItem("selected_student_group");t&&(l.value=t)}catch(t){console.error("Failed to load selected student group:",t)}},h=()=>{if(!l.value)return;const t={student_group:l.value};p.fetch(t)},v=t=>{if(!t)return"No date";try{return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(_){return t}},x=t=>{d.value=t,i.value=!0},g=()=>{i.value=!1,d.value=null};return F(()=>{k(),l.value&&h()}),T(l,t=>{t&&h()}),(t,_)=>(a(),n("div",vt,[e("div",xt,[bt,ft,l.value?(a(),n("p",yt,"Class: "+u(l.value),1)):b("",!0)]),o(p).loading?(a(),n("div",wt,St)):o(p).error?(a(),n("div",Ct,[It,e("button",{onClick:h,class:"mt-2 px-3 py-1 bg-red-600 text-white rounded text-sm"}," Retry ")])):(a(),n("div",jt,[(a(!0),n(X,null,Y(s.value,(m,S)=>(a(),n("div",{key:S,class:"bg-white rounded-lg shadow-sm border border-gray-200 hover:border-blue-300 transition-colors cursor-pointer",onClick:E=>x(m)},[e("div",Dt,[e("div",Lt,[e("h3",Et,u(m.notice_heading||"No Title"),1),e("span",Mt,u(v(m.date)),1)]),e("p",At,u(m.notice_message||"No message content"),1),e("div",Pt,[e("span",null,"By: "+u(m.owner||"System"),1)])])],8,Nt))),128)),s.value.length===0?(a(),n("div",Ft,Bt)):b("",!0)])),d.value&&i.value?(a(),n("div",Vt,[e("div",Ut,[e("div",Rt,[e("div",Tt,[e("h2",Ot,u(d.value.notice_heading),1),e("button",{onClick:g,class:"text-gray-400 hover:text-gray-600"},Gt)]),e("div",Ht,[e("p",null,"Published on: "+u(v(d.value.date)),1),e("p",null,"By: "+u(d.value.owner||"System"),1)]),e("div",qt,[e("p",Wt,u(d.value.notice_message),1)]),e("div",{class:"flex justify-end pt-4 border-t"},[e("button",{onClick:g,class:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"}," Close ")])])])])):b("",!0)]))}};var Kt=B(Qt,[["__scopeId","data-v-5403aa4c"]]);const Xt={class:"max-w-md mx-auto bg-white rounded-lg shadow-md p-6"},Yt={class:"mb-4 p-4 bg-blue-50 rounded-lg"},Zt=e("h3",{class:"text-lg font-semibold text-blue-800 mb-2"},"Student Information",-1),es={key:0,class:"text-sm text-blue-700"},ts=e("strong",null,"Student:",-1),ss={key:1,class:"text-sm text-blue-700"},os=e("strong",null,"Group:",-1),ls={key:2,class:"text-sm text-red-600"},as={class:"mb-4"},ns=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"From Date *",-1),rs={class:"mb-4"},ds=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"To Date *",-1),is={key:0,class:"mb-4"},cs=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Total Days",-1),us=["value"],ms={class:"mb-4"},_s=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Reason *",-1),gs={class:"mb-6"},hs=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Upload Image (Optional)",-1),ps={key:0,class:"text-xs text-gray-500 mt-1"},vs=["disabled"],xs={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},bs=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"},null,-1),fs=[bs],ys={key:1,class:"w-4 h-4 mr-2 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ws=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1),$s=[ws],ks={key:1,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md"},Ss={class:"flex items-start"},Cs=e("svg",{class:"w-5 h-5 text-red-600 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Is=e("p",{class:"text-red-700 text-sm font-medium"},"Unable to submit leave application",-1),js={class:"text-red-600 text-sm mt-1"},Ns={key:2,class:"mt-4 p-3 bg-green-50 border border-green-200 rounded-md"},Ds={class:"flex items-start"},Ls=e("svg",{class:"w-5 h-5 text-green-600 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),Es=e("p",{class:"text-green-700 text-sm font-medium"},"Success!",-1),Ms={class:"text-green-600 text-sm mt-1"},As={setup($){const s=Z({from_date:"",to_date:"",reason:"",total_days:"",image:null}),l=Z({student:"",student_name:"",student_group:""}),d=w(""),i=w(""),p=V(()=>l.student&&s.from_date&&s.to_date&&s.reason&&l.student_group),k=()=>{try{const t=localStorage.getItem("selected_student"),_=localStorage.getItem("selected_student_group");if(t){let m;try{m=JSON.parse(t)}catch(S){m=t}if(typeof m=="object"&&m!==null?(l.student=m.student||m.name||"",l.student_name=m.student_name||m.name||""):(l.student=m,l.student_name=m),_)try{const S=JSON.parse(_);l.student_group=S.student_group||S.name||S}catch(S){l.student_group=_}}else d.value="Student data not found in storage. Please select a student first."}catch(t){console.error("Error loading student info:",t),d.value="Failed to load student info."}},h=t=>new Promise((_,m)=>{const S=new FileReader;S.onload=()=>{const E=S.result.split(",")[1];_(E)},S.onerror=E=>m(E),S.readAsDataURL(t)}),v=t=>{const _=t.target.files[0];_?s.image=_:s.image=null},x=P({url:"school.al_ummah.api2.submit_leave_application",method:"POST",auto:!1,onSuccess(t){if(console.log("API response:",t),t.status==="success"){const _=t.message||"Leave application submitted successfully!";i.value=_,d.value="",Object.assign(s,{from_date:"",to_date:"",reason:"",total_days:"",image:null}),setTimeout(()=>{i.value=""},5e3)}else d.value=t.message||"Failed to submit leave application."},onError(t){if(console.error("API error details:",{response:t.response,exc_type:t.exc_type,exc_message:t.exc_message,_server_messages:t._server_messages,message:t.message}),t.response&&t.response.includes("already exists against the student"))d.value="Leave already submitted for this student. You cannot submit multiple applications.";else if(t._server_messages&&t._server_messages.includes("already exists against the student"))d.value="Leave already submitted for this student.";else if(t.exc_message&&t.exc_message.includes("already exists against the student"))d.value="Leave already submitted for this student.";else if(t.exc_type==="ValidationError")t.exc_message?d.value=t.exc_message.replace("frappe.exceptions.ValidationError: ",""):d.value="Validation error occurred. Please check your input.";else if(t._server_messages)try{const _=JSON.parse(t._server_messages||"[]");if(_.length>0){const m=_[_.length-1],S=JSON.parse(m);d.value=S.message||"An error occurred while submitting the leave application."}}catch(_){d.value=t.message||"An error occurred while submitting the leave application."}else d.value=t.message||"An error occurred while submitting the leave application.";i.value=""}}),g=()=>A(this,null,function*(){if(!p.value){d.value="Please fill in all required fields.";return}d.value="",i.value="";try{let t=null;s.image&&s.image instanceof File&&(t=yield h(s.image));const _={student:l.student,from_date:s.from_date,to_date:s.to_date,student_group:l.student_group,reason:s.reason,image:t};console.log("Submitting leave application with data:",_),yield x.submit(_)}catch(t){console.error("Submission error:",t),d.value="An error occurred while processing your request."}});return F(()=>{k()}),(t,_)=>(a(),n("div",Xt,[e("div",Yt,[Zt,o(l).student_name?(a(),n("p",es,[ts,O(" "+u(o(l).student_name),1)])):b("",!0),o(l).student_group?(a(),n("p",ss,[os,O(" "+u(o(l).student_group),1)])):b("",!0),o(l).student_name?b("",!0):(a(),n("p",ls," No student information found. Please select a student first. "))]),e("div",as,[ns,z(e("input",{type:"date","onUpdate:modelValue":_[0]||(_[0]=m=>o(s).from_date=m),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[J,o(s).from_date]])]),e("div",rs,[ds,z(e("input",{type:"date","onUpdate:modelValue":_[1]||(_[1]=m=>o(s).to_date=m),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[J,o(s).to_date]])]),o(s).total_days?(a(),n("div",is,[cs,e("input",{type:"text",value:o(s).total_days,readonly:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500"},null,8,us)])):b("",!0),e("div",ms,[_s,z(e("textarea",{"onUpdate:modelValue":_[2]||(_[2]=m=>o(s).reason=m),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter reason for leave...",required:""},null,512),[[J,o(s).reason]])]),e("div",gs,[hs,e("input",{type:"file",onChange:v,accept:"image/*",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,32),o(s).image?(a(),n("p",ps," Image selected: "+u(o(s).image.name),1)):b("",!0)]),e("button",{onClick:g,disabled:o(x).loading||!o(p),class:L(["w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",o(x).loading||!o(p)?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"])},[o(x).loading?(a(),n("svg",ys,$s)):(a(),n("svg",xs,fs)),O(" "+u(o(x).loading?"Submitting...":"Appeal Leave"),1)],10,vs),d.value?(a(),n("div",ks,[e("div",Ss,[Cs,e("div",null,[Is,e("p",js,u(d.value),1)])])])):b("",!0),i.value?(a(),n("div",Ns,[e("div",Ds,[Ls,e("div",null,[Es,e("p",Ms,u(i.value),1)])])])):b("",!0)]))}};const f=$=>(U("data-v-3451befd"),$=$(),R(),$),Ps={class:"flex min-h-screen bg-gray-50 flex-col md:flex-row"},Fs={class:"max-w-4xl max-h-full w-full h-full flex items-center justify-center"},zs=["src"],Bs={key:1,class:"fixed inset-0 bg-red-50 bg-opacity-90 flex items-center justify-center z-50 p-4"},Vs={class:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full"},Us={class:"flex items-center mb-4"},Rs={class:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3"},Ts=f(()=>e("h3",{class:"text-lg font-semibold text-red-800"},"Something went wrong",-1)),Os={class:"text-gray-600 mb-4"},Js={key:2,class:"fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50"},Gs=f(()=>e("div",{class:"text-center"},[e("div",{class:"spinner mb-4 mx-auto"}),e("p",{class:"text-gray-600"},"Loading your dashboard...")],-1)),Hs=[Gs],qs={key:3,class:"flex flex-col md:flex-row w-full min-h-screen"},Ws={class:"md:hidden bg-white shadow-sm border-b border-gray-200 p-4 flex items-center justify-between"},Qs={class:"flex items-center space-x-3"},Ks=["src"],Xs={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},Ys={class:"min-w-0 flex-1"},Zs={class:"text-sm font-semibold text-gray-800 truncate"},eo=f(()=>e("p",{class:"text-xs text-gray-500"},"Parent",-1)),to={class:"flex items-center justify-between md:hidden pb-4 border-b border-gray-200"},so=f(()=>e("h3",{class:"text-lg font-semibold text-gray-800"},"Menu",-1)),oo={class:"flex-1 overflow-y-auto space-y-6 md:space-y-8"},lo={class:"hidden md:flex items-start space-x-4 border-b pb-4"},ao=["src"],no={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},ro={class:"min-w-0 flex-1"},io={class:"text-xl font-semibold text-gray-800 break-words"},co=f(()=>e("p",{class:"text-sm text-gray-500 mt-1"},"Parent",-1)),uo={key:0,class:"text-xs text-gray-600 mt-1 truncate"},mo={class:"space-y-2"},_o=f(()=>e("label",{class:"block text-sm font-medium text-gray-700"},"Select Child:",-1)),go=["disabled"],ho=f(()=>e("option",{value:"",disabled:""},"Select a child",-1)),po=["value"],vo={key:0,class:"text-sm text-yellow-600"},xo={class:"space-y-3"},bo=f(()=>e("h3",{class:"text-sm font-medium text-gray-700"},"Navigation",-1)),fo={class:"space-y-2"},yo=["disabled"],wo=f(()=>e("span",{class:"truncate"},"Dashboard",-1)),$o=["disabled"],ko=f(()=>e("span",{class:"truncate"},"Attendance Record",-1)),So=["disabled"],Co=f(()=>e("span",{class:"truncate"},"Browse Notices",-1)),Io=["disabled"],jo=f(()=>e("span",{class:"truncate"},"Appeal Leave",-1)),No={class:"pt-4 border-t border-gray-200"},Do=f(()=>e("span",null,"Logout",-1)),Lo={key:0},Eo={class:"bg-white rounded-lg shadow-sm p-4 md:p-6 mb-4 md:mb-6"},Mo={class:"text-xl md:text-2xl font-bold text-gray-800 mb-2"},Ao=f(()=>e("p",{class:"text-gray-600 text-sm md:text-base"},"Monitor your child's activities and school records from here.",-1)),Po={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-4 md:mb-6"},Fo={class:"bg-white rounded-lg shadow-sm p-4 md:p-6 border-l-4 border-blue-500"},zo={class:"flex items-center justify-between"},Bo=f(()=>e("p",{class:"text-xs md:text-sm font-medium text-gray-600"},"Selected Child",-1)),Vo={class:"text-lg md:text-2xl font-bold text-gray-800 truncate"},Uo={key:0,class:"text-xs text-gray-500 mt-1"},Ro={class:"bg-white rounded-lg shadow-sm p-4 md:p-6 border-l-4 border-green-500"},To={class:"flex items-center justify-between"},Oo=f(()=>e("p",{class:"text-xs md:text-sm font-medium text-gray-600"},"Available Children",-1)),Jo={class:"text-lg md:text-2xl font-bold text-gray-800"},Go={class:"bg-white rounded-lg shadow-sm p-4 md:p-6 border-l-4 border-purple-500"},Ho={class:"flex items-center justify-between"},qo=f(()=>e("p",{class:"text-xs md:text-sm font-medium text-gray-600"},"Today's Date",-1)),Wo={class:"text-lg md:text-2xl font-bold text-gray-800"},Qo={class:"bg-white rounded-lg shadow-sm p-4 md:p-6"},Ko=f(()=>e("h2",{class:"text-lg font-semibold text-gray-800 mb-4"},"Quick Actions",-1)),Xo={class:"grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4"},Yo=["disabled"],Zo=f(()=>e("div",{class:"min-w-0 flex-1"},[e("h3",{class:"font-medium text-gray-800 text-sm md:text-base"},"View Attendance Record"),e("p",{class:"text-xs md:text-sm text-gray-600 truncate"},"Check your child's attendance history")],-1)),el=["disabled"],tl=f(()=>e("div",{class:"min-w-0 flex-1"},[e("h3",{class:"font-medium text-gray-800 text-sm md:text-base"},"Appeal for Leave"),e("p",{class:"text-xs md:text-sm text-gray-600 truncate"},"Submit leave appeal for your child")],-1)),sl={key:0,class:"text-sm text-yellow-600 mt-3"},ol={key:1,class:"h-full"},ll={setup($){const s=he(),l=w({}),d=w([]),i=w(null),p=w(!1),k=w("dashboard"),h=w(null),v=w(!1),x=w(!1),g=w(""),t={"attendance-info":pt,"browse-notices":Kt,"appeal-leave":As},_=()=>t[k.value]||null,m=c=>{j.loading||(k.value=c,window.innerWidth<768&&(p.value=!1))},S=c=>{c&&(g.value=c,x.value=!0)},E=ee.user,G=()=>{var c;try{const r=localStorage.getItem("user_details"),D=localStorage.getItem("selected_student");if(r){const N=JSON.parse(r);l.value={name:N.name,img_url:N.img_url,address:N.address},((c=N.student_list)==null?void 0:c.length)&&(d.value=N.student_list,D?i.value=JSON.parse(D):i.value=N.student_list[0],v.value=!0)}}catch(r){console.warn("Error loading from localStorage:",r)}},j=P({url:"school.al_ummah.api2.get_guardian_app_data",params:{guardian_id:E},auto:!1,onSuccess(c){var r,D;console.log("Guardian user details loaded:",c),h.value=null;try{c?(l.value={name:c.name,img_url:c.img_url,address:c.address},((r=c.student_list)==null?void 0:r.length)&&(d.value=c.student_list,i.value=c.student_list[0],localStorage.setItem("selected_student",JSON.stringify(c.student_list[0])),localStorage.setItem("selected_student_group",((D=c.student_list[0])==null?void 0:D.student_group)||"")),localStorage.setItem("user_details",JSON.stringify({name:c.name,img_url:c.img_url,address:c.address,student_list:c.student_list})),v.value=!0):h.value="No user data received from server"}catch(N){console.error("Error processing user data:",N),h.value="Error processing user data"}},onError(c){console.error("Error loading guardian user details:",c),h.value="Failed to load user data. Please try again.",v.value||re()}}),ne=V(()=>new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})),re=()=>{try{G(),(l.value.name||d.value.length)&&(v.value=!0,h.value=null)}catch(c){console.error("Error loading from localStorage:",c),h.value="Unable to load user data. Please refresh the page."}},de=()=>A(this,null,function*(){i.value&&(localStorage.setItem("selected_student",JSON.stringify(i.value)),localStorage.setItem("selected_student_group",i.value.student_group||""))}),H=c=>{c.target.style.display="none";const r=c.target.nextElementSibling;r&&(r.style.display="flex")},ie=()=>{h.value=null,v.value=!1,j.reload()},q=()=>A(this,null,function*(){try{localStorage.removeItem("user_details"),localStorage.removeItem("user"),localStorage.removeItem("selected_student"),localStorage.removeItem("selected_student_group"),yield ee.logout.submit(),s.push({name:"Login"})}catch(c){console.error("Logout error:",c),localStorage.clear(),s.push({name:"Login"})}}),W=()=>{window.innerWidth>=768&&(p.value=!1)};return F(()=>{G(),window.addEventListener("resize",W),setTimeout(()=>{j.reload().catch(c=>{console.error("Failed to reload user details:",c),h.value="Network error. Please check your connection."})},100)}),ue(()=>{window.removeEventListener("resize",W)}),T(()=>j.loading,c=>{!c&&j.data&&console.log("Parent data loaded successfully")}),T(()=>k.value,()=>{window.innerWidth<768&&(p.value=!1)}),(c,r)=>{var D,N,Q;return a(),n("div",Ps,[x.value?(a(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4",onClick:r[2]||(r[2]=y=>x.value=!1)},[e("div",Fs,[e("img",{src:g.value,alt:"Full size profile photo",class:"max-w-full max-h-full object-contain",onClick:r[0]||(r[0]=K(()=>{},["stop"]))},null,8,zs),e("button",{onClick:r[1]||(r[1]=y=>x.value=!1),class:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors"},[C(o(te),{class:"w-8 h-8"})])])])):b("",!0),h.value?(a(),n("div",Bs,[e("div",Vs,[e("div",Us,[e("div",Rs,[C(o(pe),{class:"w-6 h-6 text-red-600"})]),Ts]),e("p",Os,u(h.value),1),e("div",{class:"flex space-x-3"},[e("button",{onClick:ie,class:"flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition-colors"}," Try Again "),e("button",{onClick:q,class:"flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 transition-colors"}," Logout ")])])])):o(j).loading&&!v.value?(a(),n("div",Js,Hs)):(a(),n("div",qs,[e("header",Ws,[e("div",Qs,[e("div",{class:"w-10 h-10 rounded-full bg-gray-200 overflow-hidden flex-shrink-0 cursor-pointer",onClick:r[3]||(r[3]=y=>S(l.value.img_url))},[l.value.img_url?(a(),n("img",{key:0,src:l.value.img_url,alt:"Parent",class:"object-cover w-full h-full",onError:H},null,40,Ks)):(a(),n("div",Xs,[C(o(se),{class:"w-5 h-5 text-gray-400"})]))]),e("div",Ys,[e("h2",Zs,u(l.value.name||"Parent"),1),eo])]),e("button",{onClick:r[4]||(r[4]=y=>p.value=!p.value),class:"p-2 rounded-md text-gray-600 hover:bg-gray-100 transition-colors"},[C(o(ve),{class:"w-6 h-6"})])]),p.value?(a(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden",onClick:r[5]||(r[5]=y=>p.value=!1)})):b("",!0),e("aside",{class:L(["bg-white shadow-md p-4 md:p-6 space-y-6 md:space-y-8 z-50","fixed md:relative inset-y-0 left-0 transform transition-transform duration-300 ease-in-out","w-72 max-w-full",p.value?"translate-x-0":"-translate-x-full md:translate-x-0","flex flex-col h-screen md:h-auto"])},[e("div",to,[so,e("button",{onClick:r[6]||(r[6]=y=>p.value=!1),class:"p-2 rounded-md text-gray-600 hover:bg-gray-100 transition-colors"},[C(o(te),{class:"w-5 h-5"})])]),e("div",oo,[e("div",lo,[e("div",{class:"flex-shrink-0 w-16 h-16 rounded-full bg-gray-200 overflow-hidden cursor-pointer",onClick:r[7]||(r[7]=y=>S(l.value.img_url))},[l.value.img_url?(a(),n("img",{key:0,src:l.value.img_url,alt:"Parent",class:"object-cover w-full h-full",onError:H},null,40,ao)):(a(),n("div",no,[C(o(se),{class:"w-6 h-6 text-gray-400"})]))]),e("div",ro,[e("h2",io,u(l.value.name||"Loading..."),1),co,l.value.address?(a(),n("p",uo,u(l.value.address),1)):b("",!0)])]),e("div",mo,[_o,z(e("select",{"onUpdate:modelValue":r[8]||(r[8]=y=>i.value=y),onChange:de,class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm md:text-base",disabled:o(j).loading||!d.value.length},[ho,(a(!0),n(X,null,Y(d.value,y=>(a(),n("option",{key:y.student,value:y},u(y.student_name||"Unnamed Student"),9,po))),128))],40,go),[[me,i.value]]),d.value.length?b("",!0):(a(),n("p",vo," No children available "))]),e("div",xo,[bo,e("nav",fo,[e("button",{onClick:r[9]||(r[9]=y=>m("dashboard")),class:L(["w-full text-left px-4 py-3 rounded font-medium flex items-center space-x-3 transition-colors text-sm md:text-base",k.value==="dashboard"?"bg-blue-100 border border-blue-200 text-blue-800":"bg-blue-50 text-blue-800 hover:bg-blue-100"]),disabled:o(j).loading},[C(o(xe),{class:"w-5 h-5 flex-shrink-0"}),wo],10,yo),e("button",{onClick:r[10]||(r[10]=y=>m("attendance-info")),class:L(["w-full text-left px-4 py-3 rounded font-medium flex items-center space-x-3 transition-colors text-sm md:text-base",k.value==="attendance-info"?"bg-blue-100 border border-blue-200 text-blue-800":"bg-blue-50 text-blue-800 hover:bg-blue-100"]),disabled:!i.value||o(j).loading},[C(o(le),{class:"w-5 h-5 flex-shrink-0"}),ko],10,$o),e("button",{onClick:r[11]||(r[11]=y=>m("browse-notices")),class:L(["w-full text-left px-4 py-3 rounded font-medium flex items-center space-x-3 transition-colors text-sm md:text-base",k.value==="browse-notices"?"bg-green-100 border border-green-200 text-green-800":"bg-green-50 text-green-800 hover:bg-green-100"]),disabled:!i.value||o(j).loading},[C(o(be),{class:"w-5 h-5 flex-shrink-0"}),Co],10,So),e("button",{onClick:r[12]||(r[12]=y=>m("appeal-leave")),class:L(["w-full text-left px-4 py-3 rounded font-medium flex items-center space-x-3 transition-colors text-sm md:text-base",k.value==="appeal-leave"?"bg-yellow-100 border border-yellow-200 text-yellow-800":"bg-yellow-50 text-yellow-800 hover:bg-yellow-100"]),disabled:!i.value||o(j).loading},[C(o(ae),{class:"w-5 h-5 flex-shrink-0"}),jo],10,Io)])]),e("div",No,[e("button",{onClick:q,class:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors font-medium"},[C(o(fe),{class:"w-5 h-5"}),Do])])])],2),e("main",{class:L(["flex-1 min-h-screen md:min-h-0 p-4 md:p-6 lg:p-8 bg-gray-50",{"opacity-50 pointer-events-none":o(j).loading}])},[k.value==="dashboard"?(a(),n("div",Lo,[e("div",Eo,[e("h1",Mo,"Welcome, "+u(l.value.name||"Parent")+"!",1),Ao]),e("div",Po,[e("div",Fo,[e("div",zo,[e("div",null,[Bo,e("p",Vo,u(((D=i.value)==null?void 0:D.student_name)||"None"),1),((N=i.value)==null?void 0:N.student_group)?(a(),n("p",Uo,"Class: "+u(i.value.student_group),1)):b("",!0)]),C(o(oe),{class:"w-6 h-6 md:w-8 md:h-8 text-blue-500 flex-shrink-0"})])]),e("div",Ro,[e("div",To,[e("div",null,[Oo,e("p",Jo,u(d.value.length),1)]),C(o(oe),{class:"w-6 h-6 md:w-8 md:h-8 text-green-500 flex-shrink-0"})])]),e("div",Go,[e("div",Ho,[e("div",null,[qo,e("p",Wo,u(o(ne)),1)]),C(o(ye),{class:"w-6 h-6 md:w-8 md:h-8 text-purple-500 flex-shrink-0"})])])]),e("div",Qo,[Ko,e("div",Xo,[e("button",{onClick:r[13]||(r[13]=y=>m("attendance-info")),disabled:!i.value,class:"flex items-center p-3 md:p-4 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed text-left"},[C(o(le),{class:"w-5 h-5 md:w-6 md:h-6 text-blue-600 mr-3 flex-shrink-0"}),Zo],8,Yo),e("button",{onClick:r[14]||(r[14]=y=>m("appeal-leave")),disabled:!i.value,class:"flex items-center p-3 md:p-4 border border-gray-200 rounded-lg hover:border-yellow-500 hover:bg-yellow-50 transition-colors cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed text-left"},[C(o(ae),{class:"w-5 h-5 md:w-6 md:h-6 text-yellow-600 mr-3 flex-shrink-0"}),tl],8,el)]),i.value?b("",!0):(a(),n("p",sl," Please select a child to access these features "))])])):(a(),n("div",ol,[(a(),_e(ge(_()),{"selected-student":i.value,onBackToDashboard:r[15]||(r[15]=y=>m("dashboard")),key:((Q=i.value)==null?void 0:Q.student)+k.value},null,8,["selected-student"]))]))],2)]))])}}};var ul=B(ll,[["__scopeId","data-v-3451befd"]]);export{ul as default};
