var L=(o,r,n)=>new Promise((s,e)=>{var i=a=>{try{l(n.next(a))}catch(f){e(f)}},t=a=>{try{l(n.throw(a))}catch(f){e(f)}},l=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,t);l((n=n.apply(o,r)).next())});import{c as h,r as E,a as S,b as v,d as R,_ as y,e as b,f as T,g as I,o as O,h as A,s as j,i as w,B as U,j as k}from"./vendor.e48cf2aa.js";const V=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const t of i.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function n(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerpolicy&&(i.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?i.credentials="include":e.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(e){if(e.ep)return;e.ep=!0;const i=n(e);fetch(e.href,i)}};V();const D="modulepreload",P={},N="/assets/school/alummah/",c=function(r,n){return!n||n.length===0?r():Promise.all(n.map(s=>{if(s=`${N}${s}`,s in P)return;P[s]=!0;const e=s.endsWith(".css"),i=e?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${i}`))return;const t=document.createElement("link");if(t.rel=e?"stylesheet":D,e||(t.as="script",t.crossOrigin=""),t.href=s,document.head.appendChild(t),e)return new Promise((l,a)=>{t.addEventListener("load",l),t.addEventListener("error",a)})})).then(()=>r())},d=h({url:"frappe.auth.get_logged_user",cache:"User",onError(o){o&&o.exc_type==="AuthenticationError"&&m.push({name:"LoginPage"})}});function p(){let r=new URLSearchParams(document.cookie.split("; ").join("&")).get("user_id");return r==="Guest"&&(r=null),r}let u="";const g=E({login:h({url:"school.al_ummah.api2.login",makeParams({email:o,password:r,role:n}){return{usr:o,pwd:r,role:n||"System User"}},onSuccess(o){if(console.log("Login successful:",o),o&&o.status==="success"){d.reload(),g.user=p(),g.login.reset();const r=u==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting based on selected role:",u,"\u2192",r),m.replace({name:r})}else m.replace(o.default_route||"/")},onError(o){console.error("Login failed:",o),alert("Login failed. Please check your credentials and try again.")}}),logout:h({url:"logout",onSuccess(){d.reset(),g.user=p(),u="",m.replace({name:"Login"})},onError(o){console.error("Logout failed:",o),g.user=null,u="",m.replace({name:"Login"})}}),user:p(),isLoggedIn:S(()=>!!g.user)});function B(o){u=o}var x=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sessionUser:p,get selectedLoginRole(){return u},session:g,setSelectedLoginRole:B});const F=[{path:"/",name:"EditStudent",component:()=>c(()=>import("./EditStudent.6145d2b1.js"),["assets/EditStudent.6145d2b1.js","assets/EditStudent.59bd3729.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"Login",path:"/account/login",component:()=>c(()=>import("./Login.df844c70.js"),["assets/Login.df844c70.js","assets/Login.897882ce.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"Teacherhome",path:"/teacher-home",component:()=>c(()=>import("./TeacherHome.b5a7eab1.js"),["assets/TeacherHome.b5a7eab1.js","assets/TeacherHome.0d3a7cee.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css","assets/UserGroupIcon.1e609207.js"])},{name:"Parenthome",path:"/parent-home",component:()=>c(()=>import("./ParentHome.eae4b86f.js"),["assets/ParentHome.eae4b86f.js","assets/ParentHome.b29ec978.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css","assets/UserGroupIcon.1e609207.js"])},{name:"ForgotPassword",path:"/forgot-password",component:()=>c(()=>import("./ForgotPassword.2c8f8a60.js"),["assets/ForgotPassword.2c8f8a60.js","assets/ForgotPassword.407b63ac.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"OTPLogin",path:"/otp-login",component:()=>c(()=>import("./OTPLogin.c84ea965.js"),["assets/OTPLogin.c84ea965.js","assets/OTPLogin.2dd55d80.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"SignInScreen",path:"/google-signin",component:()=>c(()=>import("./SignInScreen.7ee2f2be.js"),["assets/SignInScreen.7ee2f2be.js","assets/SignInScreen.8683290f.css","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"TeacherSignup",path:"/teacher/signup",component:()=>c(()=>import("./TeacherSignup.abc8773d.js"),["assets/TeacherSignup.abc8773d.js","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])},{name:"ParentSignup",path:"/parent/signup",component:()=>c(()=>import("./ParentSignup.9ffeb6b8.js"),["assets/ParentSignup.9ffeb6b8.js","assets/vendor.e48cf2aa.js","assets/vendor.1f7d581e.css"])}],m=v({history:R("/alummah"),routes:F});m.beforeEach((o,r,n)=>L(void 0,null,function*(){console.log("Route guard: from",r.name,"to",o.name);let s=g.isLoggedIn,e=null;try{yield d.promise,e=d.data}catch(t){s=!1}console.log("User is logged in:",s),console.log("User data:",e);const i=["Login","ForgotPassword","OTPLogin","SignInScreen","TeacherSignup","ParentSignup"];if(o.name==="Login"&&s){const t=(e==null?void 0:e.role)||"";if(console.log("User role:",t),t==="Instructor"||t==="Guardian"){const l=u==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting to:",l,"based on role:",t),n({name:l})}else console.log("User role not Instructor or Guardian, allowing Login page"),n()}else!i.includes(o.name)&&!s?(console.log("User not logged in, redirecting to Login"),n({name:"Login"})):(console.log("Allowing navigation to:",o.name),n())}));const $={};function C(o,r){const n=I("router-view");return O(),b("div",null,[T(n)])}var q=y($,[["render",C]]);let _=A(q);j("resourceFetcher",k);_.use(m);_.use(w);_.component("Button",U);_.mount("#app");export{c as _,B as a,x as b,g as s};
