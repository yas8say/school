var d=(l,a,c)=>new Promise((s,r)=>{var g=n=>{try{i(c.next(n))}catch(u){r(u)}},_=n=>{try{i(c.throw(n))}catch(u){r(u)}},i=n=>n.done?s(n.value):Promise.resolve(n.value).then(g,_);i((c=c.apply(l,a)).next())});import{_ as y}from"./index.056dd90f.js";import{_ as I,k as m,c as S,p as w,e as E,J as k,G,o as x,D as P,E as j,l as p}from"./vendor.0121fc29.js";const B=l=>(P("data-v-3e3f4f97"),l=l(),j(),l),T={class:"min-h-screen bg-white flex items-center justify-center p-4"},b=B(()=>p("div",{class:"w-full max-w-md text-center"},[p("h1",{class:"text-3xl font-bold text-blue-600 mb-6"},"Login"),p("div",{id:"googleSignInButton",class:"flex justify-center"})],-1)),R=[b],N={setup(l){var f;const a=k(),c=G(),s=m(((f=c.query)==null?void 0:f.role)||"teacher"),r=m(!1),g="619580422153-9o7kvuuocsjfqejuv2jrud3h986t5prc.apps.googleusercontent.com",_=S({url:"school.al_ummah.api2.verify_google_token_and_create_session",onSuccess(e){console.log("Token verified successfully:",e),u(e)},onError(e){console.error("Error verifying token:",e),r.value=!1,alert((e==null?void 0:e.message)||"Failed to verify Google token. Please try again.")}}),i=()=>{if(typeof window=="undefined"||!window.google){console.log("Google API not loaded yet");return}try{window.google.accounts.id.initialize({client_id:g,callback:n,auto_select:!1,cancel_on_tap_outside:!0,ux_mode:"popup"}),window.google.accounts.id.renderButton(document.getElementById("googleSignInButton"),{theme:"outline",size:"large",width:280,text:"signin_with",shape:"pill",logo_alignment:"center"}),console.log("Google Sign-In initialized successfully")}catch(e){console.error("Error initializing Google Sign-In:",e)}},n=e=>d(this,null,function*(){try{r.value=!0,console.log("Google credential response received",e),console.log("Current role:",s.value);const o=s.value==="parent"?"Guardian":"Instructor";console.log("Sending role to API:",o),yield _.submit({id_token:e.credential,role:o})}catch(o){console.error("Error handling credential response:",o),r.value=!1,alert("Failed to process Google sign in.")}}),u=e=>d(this,null,function*(){try{if(e.success){console.log("Google authentication successful:",e),localStorage.setItem("user",JSON.stringify({username:e.user,email:e.email,role:s.value,roles:e.roles})),e.sid&&localStorage.setItem("session_id",e.sid);try{const{session:o}=yield y(()=>import("./index.056dd90f.js").then(function(v){return v.b}),["assets/index.056dd90f.js","assets/index.606b6082.css","assets/vendor.0121fc29.js","assets/vendor.1f7d581e.css"]);o.user=e.user,o.isLoggedIn=!0;const t=s.value==="parent"?"Parenthome":"Teacherhome";console.log("Navigating to:",t),a.replace({name:t})}catch(o){console.error("Error updating session:",o);const t=s.value==="parent"?"Parenthome":"Teacherhome";a.replace({name:t})}}else alert(e.error||"Authentication failed. Please try again."),r.value=!1}catch(o){console.error("Error in token verification process:",o),alert("Failed to complete login process. Please try again."),r.value=!1}}),h=()=>new Promise((e,o)=>{if(document.getElementById("google-js-sdk")){e();return}const t=document.createElement("script");t.id="google-js-sdk",t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.onload=()=>{setTimeout(()=>{i(),e()},100)},t.onerror=()=>{console.error("Failed to load Google Sign-In script"),o(new Error("Failed to load Google Sign-In"))},document.head.appendChild(t)});return w(()=>d(this,null,function*(){const e=localStorage.getItem("user");if(e){const o=JSON.parse(e);if(o.role){a.replace({name:o.role==="parent"?"Parenthome":"Teacherhome"});return}}try{yield h()}catch(o){console.error("Failed to load Google Sign-In:",o)}})),(e,o)=>(x(),E("div",T,R))}};var O=I(N,[["__scopeId","data-v-3e3f4f97"]]);export{O as default};
