var d=(a,u,i)=>new Promise((s,l)=>{var t=o=>{try{g(i.next(o))}catch(r){l(r)}},c=o=>{try{g(i.throw(o))}catch(r){l(r)}},g=o=>o.done?s(o.value):Promise.resolve(o.value).then(t,c);g((i=i.apply(a,u)).next())});import{_ as y}from"./index.05f6a9b3.js";import{_ as I,r as h,w as f,o as v,b as S,e as G,k as x,l as E,d as k,p as P,h as b,f as _}from"./vendor.1f5cccb6.js";const z=a=>(P("data-v-63d7f496"),a=a(),b(),a),B={class:"min-h-screen bg-white flex items-center justify-center p-4"},F=z(()=>_("div",{class:"w-full max-w-md text-center"},[_("h1",{class:"text-3xl font-bold text-blue-600 mb-6"},"Login"),_("div",{id:"googleSignInButton",class:"flex justify-center"})],-1)),R=[F],L={setup(a){var p;x();const u=E(),i=h(((p=u.query)==null?void 0:p.role)||"teacher"),s=h(!1);let l=null,t=null,c=null;const g=()=>d(this,null,function*(){try{const e=yield y(()=>import("./session.2746675e.js"),["assets/session.2746675e.js","assets/vendor.1f5cccb6.js","assets/vendor.1f7d581e.css","assets/index.05f6a9b3.js","assets/index.03b0e4ce.css"]);l=e.googleAuth,t=e.session,c=e.setSelectedLoginRole,c&&c(i.value)}catch(e){console.error("Error loading modules:",e),o("info","Error","Failed to load required modules. Please refresh the page.")}});function o(e,n,m){window.dispatchEvent(new CustomEvent("show-api-message-popup",{detail:{type:e,title:n,message:m}}))}const r=e=>d(this,null,function*(){try{s.value=!0,console.log("Google credential response received",e),console.log("Current role:",i.value);const n=i.value==="parent"?"Guardian":"Instructor";console.log("Sending role to API:",n),yield t.verifyGoogleToken.submit({id_token:e.credential,role:n})}catch(n){console.error("Error handling credential response:",n),s.value=!1,o("info","Sign-In Failed","Failed to process Google sign in. Please try again.")}});f(()=>{if(t)return t.verifyGoogleToken.error},e=>{if(e)if(s.value=!1,console.log("Google auth error from session:",e),e.message&&(e.message.includes("CSRF")||e.message.includes("session")))o("csrf","Session Conflict","It seems you're already logged in. Please logout from other sessions to continue.");else{const n=e.message||"Failed to verify Google token. Please try again.";o("info","Google Sign-In Failed",n)}}),f(()=>{if(t)return t.verifyGoogleToken.data},e=>{if(e&&!e.success){s.value=!1,console.log("Google auth failed with data:",e);const n=e.error||"Google authentication failed. Please try again.";o("info","Authentication Failed",n)}}),f(()=>{if(t)return t.verifyGoogleToken.loading},e=>{s.value=e});const w=()=>d(this,null,function*(){if(yield g(),l&&window.google)try{window.google.accounts.id.initialize({client_id:l.CLIENT_ID,callback:r,auto_select:!1,cancel_on_tap_outside:!0,ux_mode:"popup"}),window.google.accounts.id.renderButton(document.getElementById("googleSignInButton"),{theme:"outline",size:"large",width:280,text:"signin_with",shape:"pill",logo_alignment:"center"}),console.log("Google Sign-In initialized successfully")}catch(e){console.error("Error initializing Google Sign-In:",e),o("info","Initialization Error","Failed to initialize Google Sign-In. Please refresh the page.")}else try{yield l.loadScript(),setTimeout(()=>{window.google?(window.google.accounts.id.initialize({client_id:l.CLIENT_ID,callback:r,auto_select:!1,cancel_on_tap_outside:!0,ux_mode:"popup"}),window.google.accounts.id.renderButton(document.getElementById("googleSignInButton"),{theme:"outline",size:"large",width:280,text:"signin_with",shape:"pill",logo_alignment:"center"}),console.log("Google Sign-In initialized successfully")):o("info","Load Error","Google Sign-In failed to load. Please check your connection.")},500)}catch(e){console.error("Failed to load Google Sign-In:",e),o("info","Load Error","Failed to load Google Sign-In. Please check your connection.")}});return v(()=>d(this,null,function*(){yield w()})),S(()=>{window.google&&window.google.accounts&&window.google.accounts.id&&window.google.accounts.id.cancel()}),(e,n)=>(k(),G("div",B,R))}};var A=I(L,[["__scopeId","data-v-63d7f496"]]);export{A as default};
