var L=(e,r,t)=>new Promise((s,o)=>{var n=c=>{try{g(t.next(c))}catch(_){o(_)}},i=c=>{try{g(t.throw(c))}catch(_){o(_)}},g=c=>c.done?s(c.value):Promise.resolve(c.value).then(n,i);g((t=t.apply(e,r)).next())});import{c as f,r as E,a as v,b as R,d as S,_ as y,e as T,f as b,g as O,o as I,h as A,s as j,i as w,B as k,j as V}from"./vendor.c889c268.js";const D=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}};D();const U="modulepreload",P={},N="/assets/school/alummah/",a=function(r,t){return!t||t.length===0?r():Promise.all(t.map(s=>{if(s=`${N}${s}`,s in P)return;P[s]=!0;const o=s.endsWith(".css"),n=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${n}`))return;const i=document.createElement("link");if(i.rel=o?"stylesheet":U,o||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),o)return new Promise((g,c)=>{i.addEventListener("load",g),i.addEventListener("error",c)})})).then(()=>r())},h=f({url:"frappe.auth.get_logged_user",cache:"User",onError(e){e&&e.exc_type==="AuthenticationError"&&m.push({name:"LoginPage"})}});function p(){let r=new URLSearchParams(document.cookie.split("; ").join("&")).get("user_id");return r==="Guest"&&(r=null),r}let l="";const u=E({login:f({url:"school.al_ummah.api2.login",makeParams({email:e,password:r,role:t}){return{usr:e,pwd:r,role:t||"System User"}},onSuccess(e){if(console.log("Login successful:",e),e&&e.status==="success"){h.reload(),u.user=p(),u.login.reset();const r=l==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting based on selected role:",l,"\u2192",r),m.replace({name:r})}else m.replace(e.default_route||"/")},onError(e){console.error("Login failed:",e),alert("Login failed. Please check your credentials and try again.")}}),logout:f({url:"logout",onSuccess(){h.reset(),u.user=p(),l="",m.replace({name:"Login"})},onError(e){console.error("Logout failed:",e),u.user=null,l="",m.replace({name:"Login"})}}),user:p(),isLoggedIn:v(()=>!!u.user)});function H(e){l=e}var W=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sessionUser:p,get selectedLoginRole(){return l},session:u,setSelectedLoginRole:H});const B=[{path:"/",name:"Home",component:()=>a(()=>import("./Home.f1b79683.js"),["assets/Home.f1b79683.js","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"Login",path:"/account/login",component:()=>a(()=>import("./Login.9bdb6b3c.js"),["assets/Login.9bdb6b3c.js","assets/Login.897882ce.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"Teacherhome",path:"/teacher-home",component:()=>a(()=>import("./TeacherHome.bb500f6d.js"),["assets/TeacherHome.bb500f6d.js","assets/TeacherHome.ea9ab1b1.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css","assets/AttendanceRecord.7904d7b9.js","assets/AttendanceRecord.80fb3c14.css"])},{name:"Parenthome",path:"/parent-home",component:()=>a(()=>import("./ParentHome.8d0d2630.js"),["assets/ParentHome.8d0d2630.js","assets/ParentHome.d49a39bb.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css","assets/AttendanceRecord.7904d7b9.js","assets/AttendanceRecord.80fb3c14.css"])},{name:"ForgotPassword",path:"/forgot-password",component:()=>a(()=>import("./ForgotPassword.c7c6b66d.js"),["assets/ForgotPassword.c7c6b66d.js","assets/ForgotPassword.407b63ac.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"OTPLogin",path:"/otp-login",component:()=>a(()=>import("./OTPLogin.87bc73d6.js"),["assets/OTPLogin.87bc73d6.js","assets/OTPLogin.2dd55d80.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"SignInScreen",path:"/google-signin",component:()=>a(()=>import("./SignInScreen.373cf909.js"),["assets/SignInScreen.373cf909.js","assets/SignInScreen.8683290f.css","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"TeacherSignup",path:"/teacher/signup",component:()=>a(()=>import("./TeacherSignup.98ddf336.js"),["assets/TeacherSignup.98ddf336.js","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])},{name:"ParentSignup",path:"/parent/signup",component:()=>a(()=>import("./ParentSignup.73a3f603.js"),["assets/ParentSignup.73a3f603.js","assets/vendor.c889c268.js","assets/vendor.1f7d581e.css"])}],m=R({history:S("/alummah"),routes:B});m.beforeEach((e,r,t)=>L(void 0,null,function*(){console.log("Route guard: from",r.name,"to",e.name);let s=u.isLoggedIn;try{yield h.promise}catch(n){s=!1}console.log("User is logged in:",s);const o=["Login","ForgotPassword","OTPLogin","SignInScreen","TeacherSignup","ParentSignup"];if(e.name==="Login"&&s){const n=l==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting to:",n),t({name:n})}else if(!o.includes(e.name)&&!s)console.log("User not logged in, redirecting to Login"),t({name:"Login"});else if(e.name==="Home"&&s){const n=l==="parent"?"Parenthome":"Teacherhome";console.log("Redirecting home to:",n),t({name:n})}else console.log("Allowing navigation to:",e.name),t()}));const F={};function $(e,r){const t=O("router-view");return I(),T("div",null,[b(t)])}var C=y(F,[["render",$]]);let d=A(C);j("resourceFetcher",V);d.use(m);d.use(w);d.component("Button",k);d.mount("#app");export{a as _,H as a,W as b,u as s};
